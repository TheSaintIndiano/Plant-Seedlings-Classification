
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Seedlings}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \hypertarget{plant-seedlings-classification}{%
\section{Plant Seedlings
Classification}\label{plant-seedlings-classification}}

\hypertarget{determine-a-seedling-species-from-an-image}{%
\paragraph{Determine a seedling Species from an
image}\label{determine-a-seedling-species-from-an-image}}

    \hypertarget{tags}{%
\section{Tags}\label{tags}}

\texttt{\#Plant} \texttt{\#Seedlings} \texttt{\#Leaf} \texttt{\#OpenCV2}
\texttt{\#Matplotlib} \texttt{\#Seaborn} \texttt{\#LabelEncoder}
\texttt{\#PCA} \texttt{\#t-SNE} \texttt{\#EigenVector} \texttt{\#CNN}
\texttt{\#TransferLearning} \texttt{\#Xception} \texttt{\#VGG}
\texttt{\#Keras} \texttt{\#Sklearn} \texttt{\#ClassifierComparison}
\texttt{\#XGB}

    \begin{itemize}
\tightlist
\item
  \texttt{Author\ :\ Indiano}
\item
  \texttt{September\ 2018}
\end{itemize}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

\hypertarget{content}{%
\subsection{Content}\label{content}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Introduction (5 min)

  \begin{itemize}
  \tightlist
  \item
    Objective
  \item
    Description
  \item
    Evaluation
  \item
    Imports Libraries
  \end{itemize}
\item
  Data Understanding (15 min)

  \begin{itemize}
  \tightlist
  \item
    Helper Functions
  \item
    Load data
  \item
    Basic Statistical summaries and visualisations
  \end{itemize}
\item
  Data Preparation (25 min)

  \begin{itemize}
  \tightlist
  \item
    Sanitize Data
  \item
    Categorize Class Labels
  \item
    Advanced Statistical Summaries \& Visualisations
  \item
    PCA Visualization
  \item
    t-SNE Visualization (2D \& 3D)
  \item
    Normalization
  \end{itemize}
\item
  Modeling, Evaluation \& Submission (25 min)

  \begin{itemize}
  \tightlist
  \item
    CNN
  \item
    Transfer Learning using Xception, VGG, ImageNet
  \item
    XGB using only countour features
  \end{itemize}
\item
  Deployment (5 min)

  \begin{itemize}
  \tightlist
  \item
    Submit result to Kaggle leaderboard\\
  \end{itemize}
\item
  Further Improvements

  \begin{itemize}
  \tightlist
  \item
    Some ideas for increasing the accuracy
  \end{itemize}
\end{enumerate}

\href{http://www.sv-europe.com/crisp-dm-methodology/}{Adopted from Cross
Industry Standard Process for Data Mining (CRISP-DM)}

\begin{figure}
\centering
\includegraphics{https://i.pinimg.com/originals/d3/fe/6d/d3fe6d904580fa4e642225ae6d18f0da.jpg}
\caption{CripsDM}
\end{figure}

    \hypertarget{introduction}{%
\section{1. Introduction}\label{introduction}}

    \href{https://www.kaggle.com/c/plant-seedlings-classification}{Based on
Kaggle Plant Seedlings Classification}

    \hypertarget{objective}{%
\subsection{1.1 Objective}\label{objective}}

    Classify \texttt{an\ image} of \texttt{seedling} into one the following
\texttt{12\ different} seedling \texttt{classes}.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Black-grass}
\item
  \textbf{Charlock}
\item
  \textbf{Cleavers}
\item
  \textbf{Common Chickweed}
\item
  \textbf{Common wheat}
\item
  \textbf{Fat Hen}
\item
  \textbf{Loose Silky-bent}
\item
  \textbf{Maize}
\item
  \textbf{Scentless Mayweed}
\item
  \textbf{Shepherds Purse}
\item
  \textbf{Small-flowered Cranesbill}
\item
  \textbf{Sugar beet}
\end{enumerate}

    \hypertarget{description}{%
\subsection{1.2 Description}\label{description}}

    Can you differentiate a \texttt{weed} from a crop \texttt{seedling}?

The ability to do so effectively can mean \texttt{better\ crop\ yields}
and \texttt{better\ stewardship\ of\ the\ environment}.

The Aarhus University Signal Processing group, in collaboration with
University of Southern Denmark, has recently released a dataset
containing images of approximately 960 unique plants belonging to 12
species at several growth stages.

We're hosting this dataset as a Kaggle competition in order to give it
wider exposure, to give the community an opportunity to experiment with
different image recognition techniques, as well to provide a place to
cross-pollenate ideas.

    \hypertarget{citation}{%
\subsubsection{Citation}\label{citation}}

\href{https://arxiv.org/abs/1711.05458v1}{A Public Image Database for
Benchmark of Plant Seedling Classification Algorithms}

    \hypertarget{evaluation}{%
\subsection{1.3 Evaluation}\label{evaluation}}

    Submissions are evaluated on MeanFScore, which at Kaggle is actually a
micro-averaged F1-score.

Given positive/negative rates for each class k, the resulting score is
computed this way:

\(Precisionmicro=∑k∈CTPk∑k∈CTPk+FPk\)

\(Recallmicro=∑k∈CTPk∑k∈CTPk+FNk\)

F1-score is the harmonic mean of precision and recall

\$MeanFScore=F1micro=
\(\Frac{2PrecisionmicroRecallmicro}{Precisionmicro+Recallmicro}\)

    \hypertarget{imports}{%
\subsection{1.4 Imports}\label{imports}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}119}]:} \PY{c+c1}{\PYZsh{} Ignore warnings}
          \PY{k+kn}{import} \PY{n+nn}{warnings}
          \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ignore}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Theano MKL Problem}
          \PY{k+kn}{import} \PY{n+nn}{os}
          \PY{n}{os}\PY{o}{.}\PY{n}{environ}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{MKL\PYZus{}THREADING\PYZus{}LAYER}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{GNU}\PY{l+s+s2}{\PYZdq{}}
          
          \PY{c+c1}{\PYZsh{} Formatting}
          \PY{k+kn}{import} \PY{n+nn}{pprint} \PY{k}{as} \PY{n+nn}{pretty}
          \PY{k+kn}{from} \PY{n+nn}{tabulate} \PY{k}{import} \PY{n}{tabulate}
          
          \PY{c+c1}{\PYZsh{} Memory usage}
          \PY{k+kn}{import} \PY{n+nn}{ipython\PYZus{}memory\PYZus{}usage}\PY{n+nn}{.}\PY{n+nn}{ipython\PYZus{}memory\PYZus{}usage} \PY{k}{as} \PY{n+nn}{imu}
          
          \PY{c+c1}{\PYZsh{} System related libraries}
          \PY{k+kn}{import} \PY{n+nn}{os}
          \PY{k+kn}{import} \PY{n+nn}{importlib}
          \PY{k+kn}{from} \PY{n+nn}{joblib} \PY{k}{import} \PY{n}{Parallel}\PY{p}{,} \PY{n}{delayed}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{externals} \PY{k}{import} \PY{n}{joblib}
          \PY{k+kn}{from} \PY{n+nn}{time} \PY{k}{import} \PY{n}{time}
          
          \PY{c+c1}{\PYZsh{} Handle table\PYZhy{}like data and matrices}
          \PY{k+kn}{import} \PY{n+nn}{pickle}
          \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
          \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
          
          \PY{c+c1}{\PYZsh{} Collections}
          \PY{k+kn}{from} \PY{n+nn}{itertools} \PY{k}{import} \PY{n}{product}\PY{p}{,} \PY{n}{compress}
          \PY{k+kn}{from} \PY{n+nn}{functools} \PY{k}{import} \PY{n}{reduce}
          \PY{k+kn}{from} \PY{n+nn}{operator} \PY{k}{import} \PY{n}{itemgetter}
          \PY{k+kn}{from} \PY{n+nn}{collections} \PY{k}{import} \PY{n}{defaultdict}
          \PY{k+kn}{from} \PY{n+nn}{glob} \PY{k}{import} \PY{n}{glob}
          
          \PY{c+c1}{\PYZsh{} Image}
          \PY{k+kn}{import} \PY{n+nn}{imageio}
          \PY{k+kn}{import} \PY{n+nn}{cv2}
          
          \PY{c+c1}{\PYZsh{} Sklearn}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{decomposition} \PY{k}{import} \PY{n}{PCA}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{manifold} \PY{k}{import} \PY{n}{TSNE}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k}{import} \PY{n}{StandardScaler}\PY{p}{,} \PY{n}{LabelEncoder}\PY{p}{,} \PY{n}{MinMaxScaler}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
          \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{decomposition}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neighbors} \PY{k}{import} \PY{n}{KernelDensity}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k}{import} \PY{n}{accuracy\PYZus{}score}\PY{p}{,} \PY{n}{confusion\PYZus{}matrix}\PY{p}{,} \PY{n}{classification\PYZus{}report}
          \PY{k+kn}{from} \PY{n+nn}{skimage}\PY{n+nn}{.}\PY{n+nn}{transform} \PY{k}{import} \PY{n}{resize} \PY{k}{as} \PY{n}{imresize}
          
          \PY{c+c1}{\PYZsh{} Modelling Algorithms}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neural\PYZus{}network} \PY{k}{import} \PY{n}{MLPClassifier}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neighbors} \PY{k}{import} \PY{n}{KNeighborsClassifier}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{gaussian\PYZus{}process} \PY{k}{import} \PY{n}{GaussianProcessClassifier}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{gaussian\PYZus{}process}\PY{n+nn}{.}\PY{n+nn}{kernels} \PY{k}{import} \PY{n}{RBF}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{tree} \PY{k}{import} \PY{n}{DecisionTreeClassifier}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{RandomForestClassifier}\PY{p}{,} \PY{n}{AdaBoostClassifier}\PY{p}{,} \PY{n}{GradientBoostingClassifier}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{naive\PYZus{}bayes} \PY{k}{import} \PY{n}{GaussianNB}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{discriminant\PYZus{}analysis} \PY{k}{import} \PY{n}{LinearDiscriminantAnalysis}\PY{p}{,} \PY{n}{QuadraticDiscriminantAnalysis}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k}{import} \PY{n}{LogisticRegression}\PY{p}{,} \PY{n}{Ridge}\PY{p}{,} \PY{n}{Lasso}\PY{p}{,} \PY{n}{RandomizedLasso}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{svm} \PY{k}{import} \PY{n}{SVC}\PY{p}{,} \PY{n}{LinearSVC}
          \PY{k+kn}{from} \PY{n+nn}{xgboost} \PY{k}{import} \PY{n}{XGBClassifier}
          
          \PY{c+c1}{\PYZsh{} Modelling Helpers}
          \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{,} \PY{n}{StratifiedKFold}
          
          \PY{c+c1}{\PYZsh{} Keras}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{utils} \PY{k}{import} \PY{n}{plot\PYZus{}model}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{Model}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{Input}\PY{p}{,} \PY{n}{Dense}\PY{p}{,} \PY{n}{Flatten}\PY{p}{,} \PY{n}{Activation}\PY{p}{,} \PY{n}{Dropout}\PY{p}{,} \PY{n}{Maximum}\PY{p}{,} \PY{n}{ZeroPadding2D}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers}\PY{n+nn}{.}\PY{n+nn}{convolutional} \PY{k}{import} \PY{n}{Conv2D}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers}\PY{n+nn}{.}\PY{n+nn}{pooling} \PY{k}{import} \PY{n}{MaxPooling2D}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers}\PY{n+nn}{.}\PY{n+nn}{merge} \PY{k}{import} \PY{n}{concatenate}
          \PY{k+kn}{from} \PY{n+nn}{keras} \PY{k}{import} \PY{n}{regularizers}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{BatchNormalization}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{optimizers} \PY{k}{import} \PY{n}{Adam}\PY{p}{,} \PY{n}{SGD}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{preprocessing}\PY{n+nn}{.}\PY{n+nn}{image} \PY{k}{import} \PY{n}{ImageDataGenerator}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{callbacks} \PY{k}{import} \PY{n}{ModelCheckpoint}\PY{p}{,} \PY{n}{ReduceLROnPlateau}\PY{p}{,} \PY{n}{EarlyStopping}\PY{p}{,} \PY{n}{TensorBoard}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers}\PY{n+nn}{.}\PY{n+nn}{advanced\PYZus{}activations} \PY{k}{import} \PY{n}{LeakyReLU}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{utils} \PY{k}{import} \PY{n}{to\PYZus{}categorical}
          \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{applications} \PY{k}{import} \PY{n}{xception}\PY{p}{,} \PY{n}{vgg16}
          
          \PY{c+c1}{\PYZsh{} Auto\PYZhy{}ML}
          \PY{k+kn}{import} \PY{n+nn}{autosklearn}\PY{n+nn}{.}\PY{n+nn}{classification}
          \PY{k+kn}{from} \PY{n+nn}{tpot} \PY{k}{import} \PY{n}{TPOTClassifier}
          
          \PY{c+c1}{\PYZsh{} Visualization}
          \PY{k+kn}{import} \PY{n+nn}{matplotlib}
          \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
          \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{cm} \PY{k}{as} \PY{n+nn}{cm}
          \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{gridspec} \PY{k}{as} \PY{n+nn}{gridspec}
          
          \PY{k+kn}{from} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{offsetbox} \PY{k}{import} \PY{n}{OffsetImage}\PY{p}{,} \PY{n}{AnnotationBbox}
          \PY{k+kn}{from} \PY{n+nn}{mpl\PYZus{}toolkits}\PY{n+nn}{.}\PY{n+nn}{axes\PYZus{}grid1} \PY{k}{import} \PY{n}{ImageGrid}
          \PY{k+kn}{from} \PY{n+nn}{mpl\PYZus{}toolkits}\PY{n+nn}{.}\PY{n+nn}{mplot3d} \PY{k}{import} \PY{n}{Axes3D}
          \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k}{import} \PY{n}{animation}
          \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
          
          \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{display}\PY{p}{,} \PY{n}{HTML}
          \PY{k+kn}{from} \PY{n+nn}{tqdm} \PY{k}{import} \PY{n}{tqdm}
          
          \PY{c+c1}{\PYZsh{} Configure visualisations}
          \PY{n}{plt}\PY{o}{.}\PY{n}{style}\PY{o}{.}\PY{n}{use}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ggplot}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{sns}\PY{o}{.}\PY{n}{set\PYZus{}style}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{white}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{c+c1}{\PYZsh{} pylab.rcParams[ \PYZsq{}figure.figsize\PYZsq{} ] = 8 , 6}
          \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
          
          \PY{c+c1}{\PYZsh{} Monitoring memory usage in jupyter notebooks; mprof run test.py \PYZam{} mprof plot}
          \PY{c+c1}{\PYZsh{} \PYZpc{}memit}
          \PY{o}{\PYZpc{}}\PY{k}{load\PYZus{}ext} memory\PYZus{}profiler
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
The memory\_profiler extension is already loaded. To reload it, use:
  \%reload\_ext memory\_profiler

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{from} \PY{n+nn}{subprocess} \PY{k}{import} \PY{n}{check\PYZus{}output}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{check\PYZus{}output}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ls}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{./}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{decode}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{utf8}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
checkpoint
checkpoint (copy)
data
logs
logs1536318716.4047165
save
seedlings
Seedlings.ipynb
visualization


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{o}{\PYZpc{}}\PY{k}{ls} data/all/train
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
 \textcolor{ansi-blue-intense}{\textbf{Black-grass}}/        \textcolor{ansi-blue-intense}{\textbf{'Common wheat'}}/      \textcolor{ansi-blue-intense}{\textbf{'Scentless Mayweed'}}/
 \textcolor{ansi-blue-intense}{\textbf{Charlock}}/           \textcolor{ansi-blue-intense}{\textbf{'Fat Hen'}}/           \textcolor{ansi-blue-intense}{\textbf{'Shepherds Purse'}}/
 \textcolor{ansi-blue-intense}{\textbf{Cleavers}}/           \textcolor{ansi-blue-intense}{\textbf{'Loose Silky-bent'}}/  \textcolor{ansi-blue-intense}{\textbf{'Small-flowered Cranesbill'}}/
\textcolor{ansi-blue-intense}{\textbf{'Common Chickweed'}}/   \textcolor{ansi-blue-intense}{\textbf{Maize}}/              \textcolor{ansi-blue-intense}{\textbf{'Sugar beet'}}/

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{o}{\PYZpc{}}\PY{k}{memit}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
peak memory: 312.84 MiB, increment: 0.03 MiB

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{} Same as label\PYZus{}to\PYZus{}id\PYZus{}dict}
        
        \PY{n}{CLASS} \PY{o}{=} \PY{p}{\PYZob{}}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{0}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Charlock}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{1}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cleavers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{2}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common Chickweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{3}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common wheat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{4}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fat Hen}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{5}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loose Silky\PYZhy{}bent}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{6}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Maize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{7}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scentless Mayweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{8}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shepherds Purse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{9}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{10}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sugar beet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{11}
        \PY{p}{\PYZcb{}}
        
        \PY{c+c1}{\PYZsh{} Same as id\PYZus{}to\PYZus{}label\PYZus{}dict}
        
        \PY{n}{INV\PYZus{}CLASS} \PY{o}{=} \PY{p}{\PYZob{}}
            \PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Charlock}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{2}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cleavers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{3}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common Chickweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{4}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common wheat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{5}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fat Hen}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{6}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loose Silky\PYZhy{}bent}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{7}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Maize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{8}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scentless Mayweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{9}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shepherds Purse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{10}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{11}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sugar beet}\PY{l+s+s1}{\PYZsq{}}
        \PY{p}{\PYZcb{}}
\end{Verbatim}


    \hypertarget{data-understanding}{%
\section{2. Data Understanding}\label{data-understanding}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{c+c1}{\PYZsh{} Data directory}
        
        \PY{n}{root\PYZus{}dir} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./data/all}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{train\PYZus{}dir} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{test\PYZus{}dir} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \hypertarget{helper-functions}{%
\subsection{2.1 Helper Functions}\label{helper-functions}}

    \hypertarget{mask-segment-sharpen-functions}{%
\subsubsection{2.1.1 Mask, Segment \& Sharpen
Functions}\label{mask-segment-sharpen-functions}}

    The \texttt{create\_mask\_for\_plant} function returns an image
\texttt{mask\ matrix} of image\_height * image\_width shape. The mask
matrix contains only boolean values of 0 \& 1 indicating seedlings
background and foreground region.

At the end, we will do \texttt{morphological\ close\ operation} to keep
the original shape of the foreground (1 blob on the mask image) but
\texttt{close\ the\ spurious\ small\ holes}.

\begin{figure}
\centering
\includegraphics{https://www.cs.auckland.ac.nz/courses/compsci773s1c/lectures/ImageProcessing-html/mor-pri-erosion.gif}
\caption{alt text}
\end{figure}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{c+c1}{\PYZsh{} Segment Mask \PYZam{} Sharpen for the plant}
         
         
         \PY{k}{def} \PY{n+nf}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}\PY{p}{:}
         
             \PY{c+c1}{\PYZsh{} Convert to HSV image}
             \PY{n}{image\PYZus{}hsv} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{cvtColor}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{COLOR\PYZus{}BGR2HSV}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Create mask}
             \PY{n}{sensitivity} \PY{o}{=} \PY{l+m+mi}{35}
             \PY{n}{lower\PYZus{}hsv} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{60} \PY{o}{\PYZhy{}} \PY{n}{sensitivity}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{]}\PY{p}{)}
             \PY{n}{upper\PYZus{}hsv} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{60} \PY{o}{+} \PY{n}{sensitivity}\PY{p}{,} \PY{l+m+mi}{255}\PY{p}{,} \PY{l+m+mi}{255}\PY{p}{]}\PY{p}{)}
         
             \PY{n}{mask} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{inRange}\PY{p}{(}\PY{n}{image\PYZus{}hsv}\PY{p}{,} \PY{n}{lower\PYZus{}hsv}\PY{p}{,} \PY{n}{upper\PYZus{}hsv}\PY{p}{)}
             \PY{n}{kernel} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{getStructuringElement}\PY{p}{(}\PY{n}{cv2}\PY{o}{.}\PY{n}{MORPH\PYZus{}ELLIPSE}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{11}\PY{p}{,} \PY{l+m+mi}{11}\PY{p}{)}\PY{p}{)}
             \PY{n}{mask} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{morphologyEx}\PY{p}{(}\PY{n}{mask}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{MORPH\PYZus{}CLOSE}\PY{p}{,} \PY{n}{kernel}\PY{p}{)}
         
             \PY{k}{return} \PY{n}{mask}
         
         
         \PY{k}{def} \PY{n+nf}{segment\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}\PY{p}{:}
             \PY{n}{mask} \PY{o}{=} \PY{n}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
             \PY{n}{output} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{bitwise\PYZus{}and}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{image}\PY{p}{,} \PY{n}{mask}\PY{o}{=}\PY{n}{mask}\PY{p}{)}
             \PY{k}{return} \PY{n}{output}
         
         
         \PY{k}{def} \PY{n+nf}{sharpen\PYZus{}image}\PY{p}{(}\PY{n}{image}\PY{p}{)}\PY{p}{:}
             \PY{n}{image\PYZus{}blurred} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{GaussianBlur}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}
             \PY{n}{image\PYZus{}sharp} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{addWeighted}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{l+m+mf}{1.5}\PY{p}{,} \PY{n}{image\PYZus{}blurred}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
             \PY{k}{return} \PY{n}{image\PYZus{}sharp}
         
         
         \PY{c+c1}{\PYZsh{} Mask, Segment \PYZam{} Sharpen an Image}
         
         
         \PY{k}{def} \PY{n+nf}{mark\PYZus{}segment\PYZus{}sharpen\PYZus{}image}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{45}\PY{p}{,} \PY{l+m+mi}{45}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} Resize image}
             \PY{n}{img} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{img}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
         
             \PY{n}{image\PYZus{}mask} \PY{o}{=} \PY{n}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{img}\PY{p}{)}
             \PY{n}{image\PYZus{}segmented} \PY{o}{=} \PY{n}{segment\PYZus{}plant}\PY{p}{(}\PY{n}{img}\PY{p}{)}
             \PY{n}{image\PYZus{}sharpened} \PY{o}{=} \PY{n}{sharpen\PYZus{}image}\PY{p}{(}\PY{n}{image\PYZus{}segmented}\PY{p}{)}
         
             \PY{k}{return} \PY{n}{img}\PY{p}{,} \PY{n}{image\PYZus{}mask}\PY{p}{,} \PY{n}{image\PYZus{}segmented}\PY{p}{,} \PY{n}{image\PYZus{}sharpened}
\end{Verbatim}


    \hypertarget{contour-calculation-functions}{%
\subsubsection{2.1.2 Contour Calculation
Functions}\label{contour-calculation-functions}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}101}]:} \PY{c+c1}{\PYZsh{} Find contours and calculate the largest contour \PYZam{} total area}
          
          
          \PY{k}{def} \PY{n+nf}{find\PYZus{}contours}\PY{p}{(}\PY{n}{mask\PYZus{}image}\PY{p}{)}\PY{p}{:}
              \PY{k}{return} \PY{n}{cv2}\PY{o}{.}\PY{n}{findContours}\PY{p}{(}\PY{n}{mask\PYZus{}image}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{RETR\PYZus{}EXTERNAL}\PY{p}{,}
                                      \PY{n}{cv2}\PY{o}{.}\PY{n}{CHAIN\PYZus{}APPROX\PYZus{}SIMPLE}\PY{p}{)}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{]}
          
          
          \PY{k}{def} \PY{n+nf}{calculate\PYZus{}largest\PYZus{}contour\PYZus{}area}\PY{p}{(}\PY{n}{contours}\PY{p}{)}\PY{p}{:}
              \PY{k}{if} \PY{n+nb}{len}\PY{p}{(}\PY{n}{contours}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{:}
                  \PY{k}{return} \PY{l+m+mi}{0}
              \PY{n}{c} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{contours}\PY{p}{,} \PY{n}{key}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{contourArea}\PY{p}{)}
              \PY{k}{return} \PY{n}{cv2}\PY{o}{.}\PY{n}{contourArea}\PY{p}{(}\PY{n}{c}\PY{p}{)}
          
          
          \PY{k}{def} \PY{n+nf}{calculate\PYZus{}contours\PYZus{}area}\PY{p}{(}\PY{n}{contours}\PY{p}{,} \PY{n}{min\PYZus{}contour\PYZus{}area}\PY{o}{=}\PY{l+m+mi}{250}\PY{p}{)}\PY{p}{:}
              \PY{n}{area} \PY{o}{=} \PY{l+m+mi}{0}
              \PY{k}{for} \PY{n}{c} \PY{o+ow}{in} \PY{n}{contours}\PY{p}{:}
                  \PY{n}{c\PYZus{}area} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{contourArea}\PY{p}{(}\PY{n}{c}\PY{p}{)}
                  \PY{k}{if} \PY{n}{c\PYZus{}area} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{min\PYZus{}contour\PYZus{}area}\PY{p}{:}
                      \PY{n}{area} \PY{o}{+}\PY{o}{=} \PY{n}{c\PYZus{}area}
              \PY{k}{return} \PY{n}{area}
\end{Verbatim}


    \hypertarget{visualize-images-functions}{%
\subsubsection{2.1.3 Visualize Images
Functions}\label{visualize-images-functions}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{} Plot the plant images on a grid according to each class label}
        
        
        \PY{k}{def} \PY{n+nf}{image\PYZus{}grid\PYZus{}plot\PYZus{}for\PYZus{}classes}\PY{p}{(}\PY{n}{labels}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}\PY{p}{:}
        
            \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{n}{nb\PYZus{}cols}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{)}\PY{p}{)}
            \PY{n}{grid} \PY{o}{=} \PY{n}{ImageGrid}\PY{p}{(}
                \PY{n}{fig}\PY{p}{,} \PY{l+m+mi}{111}\PY{p}{,} \PY{n}{nrows\PYZus{}ncols}\PY{o}{=}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{)}\PY{p}{,} \PY{n}{axes\PYZus{}pad}\PY{o}{=}\PY{l+m+mf}{0.05}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Iterating over different class labels}
            \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{label} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{)}\PY{p}{:}
                    \PY{n}{axs} \PY{o}{=} \PY{n}{grid}\PY{p}{[}\PY{n}{i} \PY{o}{*} \PY{n}{nb\PYZus{}cols} \PY{o}{+} \PY{n}{j}\PY{p}{]}
                    \PY{n}{axs}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{label}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                    \PY{n}{axs}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
                \PY{c+c1}{\PYZsh{} Class label text}
                \PY{n}{axs}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{l+m+mi}{170}\PY{p}{,} \PY{l+m+mi}{75}\PY{p}{,} \PY{n}{label}\PY{p}{,} \PY{n}{verticalalignment}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{center}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} Plot the plant images on a grid according to each class label}
        
        
        \PY{k}{def} \PY{n+nf}{grid\PYZus{}plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{n}{labels}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}\PY{p}{:}
        
            \PY{n}{nb\PYZus{}rows}\PY{p}{,} \PY{n}{nb\PYZus{}cols} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{p}{,} \PY{n}{nb\PYZus{}cols}
        
            \PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{nb\PYZus{}rows}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Iterating over different class labels}
            \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{label} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{)}\PY{p}{:}
                    \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}
                        \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{label}\PY{p}{]}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                        \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{auto}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                    \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
                \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{text}\PY{p}{(}\PY{l+m+mi}{170}\PY{p}{,} \PY{l+m+mi}{75}\PY{p}{,} \PY{n}{label}\PY{p}{,} \PY{n}{verticalalignment}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{center}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} Plot the plant images according to each class label}
        
        
        \PY{k}{def} \PY{n+nf}{plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{n}{label}\PY{p}{,} \PY{n}{nb\PYZus{}rows}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
        
            \PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{nb\PYZus{}rows}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
        
            \PY{n}{n} \PY{o}{=} \PY{l+m+mi}{0}
            \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{nb\PYZus{}rows}\PY{p}{)}\PY{p}{:}
                \PY{k}{for} \PY{n}{j} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{)}\PY{p}{:}
                    \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                    \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                    \PY{n}{axs}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{label}\PY{p}{]}\PY{p}{[}\PY{n}{n}\PY{p}{]}\PY{p}{)}
                    \PY{n}{n} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
        
        
        \PY{c+c1}{\PYZsh{} visualize\PYZus{}scatter\PYZus{}with\PYZus{}images}
        
        
        \PY{k}{def} \PY{n+nf}{visualize\PYZus{}scatter\PYZus{}with\PYZus{}images}\PY{p}{(}\PY{n}{X\PYZus{}2d\PYZus{}data}\PY{p}{,}
                                          \PY{n}{images}\PY{p}{,}
                                          \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{45}\PY{p}{,} \PY{l+m+mi}{45}\PY{p}{)}\PY{p}{,}
                                          \PY{n}{image\PYZus{}zoom}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
            \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{n}{figsize}\PY{p}{)}
            \PY{n}{artists} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{xy}\PY{p}{,} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{n}{X\PYZus{}2d\PYZus{}data}\PY{p}{,} \PY{n}{images}\PY{p}{)}\PY{p}{:}
                \PY{n}{x0}\PY{p}{,} \PY{n}{y0} \PY{o}{=} \PY{n}{xy}
                \PY{n}{img} \PY{o}{=} \PY{n}{OffsetImage}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{zoom}\PY{o}{=}\PY{n}{image\PYZus{}zoom}\PY{p}{)}
                \PY{n}{ab} \PY{o}{=} \PY{n}{AnnotationBbox}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{p}{(}\PY{n}{x0}\PY{p}{,} \PY{n}{y0}\PY{p}{)}\PY{p}{,} \PY{n}{xycoords}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{frameon}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
                \PY{n}{artists}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{ax}\PY{o}{.}\PY{n}{add\PYZus{}artist}\PY{p}{(}\PY{n}{ab}\PY{p}{)}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{update\PYZus{}datalim}\PY{p}{(}\PY{n}{X\PYZus{}2d\PYZus{}data}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{autoscale}\PY{p}{(}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} visualize\PYZus{}scatter}
        
        
        \PY{k}{def} \PY{n+nf}{visualize\PYZus{}scatter}\PY{p}{(}\PY{n}{data\PYZus{}2d}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{n}{figsize}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
        
            \PY{n}{nb\PYZus{}classes} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{label\PYZus{}ids}\PY{p}{)}\PY{p}{)}
        
            \PY{k}{for} \PY{n}{label\PYZus{}id} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{label\PYZus{}ids}\PY{p}{)}\PY{p}{:}
                \PY{n}{plt}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}
                    \PY{n}{data\PYZus{}2d}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{label\PYZus{}ids} \PY{o}{==} \PY{n}{label\PYZus{}id}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                    \PY{n}{data\PYZus{}2d}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{label\PYZus{}ids} \PY{o}{==} \PY{n}{label\PYZus{}id}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                    \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                    \PY{n}{color}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{cm}\PY{o}{.}\PY{n}{Set1}\PY{p}{(}\PY{n}{label\PYZus{}id} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{nb\PYZus{}classes}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                    \PY{n}{linewidth}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                    \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,}
                    \PY{n}{label}\PY{o}{=}\PY{n}{id\PYZus{}to\PYZus{}label\PYZus{}dict}\PY{p}{[}\PY{n}{label\PYZus{}id}\PY{p}{]}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{best}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} visualize\PYZus{}scatter with 3D animation}
        
        
        \PY{k}{def} \PY{n+nf}{visualize\PYZus{}scatter\PYZus{}3D}\PY{p}{(}\PY{n}{data\PYZus{}3d}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{p}{)}\PY{p}{:}
        
            \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{25}\PY{p}{)}\PY{p}{)}
            \PY{n}{ax} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{,} \PY{n}{projection}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
        
            \PY{n}{nb\PYZus{}classes} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{label\PYZus{}ids}\PY{p}{)}\PY{p}{)}
        
            \PY{k}{for} \PY{n}{label\PYZus{}id} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{label\PYZus{}ids}\PY{p}{)}\PY{p}{:}
                \PY{n}{ax}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}
                    \PY{n}{data\PYZus{}3d}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{label\PYZus{}ids} \PY{o}{==} \PY{n}{label\PYZus{}id}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                    \PY{n}{data\PYZus{}3d}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{label\PYZus{}ids} \PY{o}{==} \PY{n}{label\PYZus{}id}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                    \PY{n}{data\PYZus{}3d}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{where}\PY{p}{(}\PY{n}{label\PYZus{}ids} \PY{o}{==} \PY{n}{label\PYZus{}id}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{p}{,}
                    \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,}
                    \PY{n}{color}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{cm}\PY{o}{.}\PY{n}{Set1}\PY{p}{(}\PY{n}{label\PYZus{}id} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{nb\PYZus{}classes}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                    \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                    \PY{n}{label}\PY{o}{=}\PY{n}{id\PYZus{}to\PYZus{}label\PYZus{}dict}\PY{p}{[}\PY{n}{label\PYZus{}id}\PY{p}{]}\PY{p}{)}
        
            \PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{best}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{view\PYZus{}init}\PY{p}{(}\PY{l+m+mi}{25}\PY{p}{,} \PY{l+m+mi}{45}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{2.5}\PY{p}{,} \PY{l+m+mf}{2.5}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{2.5}\PY{p}{,} \PY{l+m+mf}{2.5}\PY{p}{)}
            \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}zlim}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mf}{2.5}\PY{p}{,} \PY{l+m+mf}{2.5}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Create GIF}
            \PY{n}{anima} \PY{o}{=} \PY{n}{animation}\PY{o}{.}\PY{n}{FuncAnimation}\PY{p}{(}
                \PY{n}{fig}\PY{p}{,}
                \PY{k}{lambda} \PY{n}{frame\PYZus{}number}\PY{p}{:} \PY{n}{ax}\PY{o}{.}\PY{n}{view\PYZus{}init}\PY{p}{(}\PY{l+m+mi}{30}\PY{p}{,} \PY{l+m+mi}{4} \PY{o}{*} \PY{n}{frame\PYZus{}number}\PY{p}{)}\PY{p}{,}
                \PY{n}{interval}\PY{o}{=}\PY{l+m+mi}{175}\PY{p}{,}
                \PY{n}{frames}\PY{o}{=}\PY{l+m+mi}{90}\PY{p}{)}
            \PY{n}{anima}\PY{o}{.}\PY{n}{save}\PY{p}{(}
                \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./visualization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{seedlings\PYZus{}3D.gif}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                \PY{n}{writer}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{imagemagick}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \hypertarget{plot-the-missclassified-plant-images-on-a-grid-confusion-matrix}{%
\subsubsection{2.1.4 Plot the missclassified plant images on a grid \&
Confusion
Matrix}\label{plot-the-missclassified-plant-images-on-a-grid-confusion-matrix}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}85}]:} \PY{c+c1}{\PYZsh{} Plot the missclassified plant images on a grid}
         
         
         \PY{k}{def} \PY{n+nf}{grid\PYZus{}plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{n}{missclassified}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
         
             \PY{n}{nb\PYZus{}rows} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{missclassified}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{/} \PY{n}{nb\PYZus{}cols}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}
         
             \PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{15}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Iterating over different missclassified images}
             \PY{k}{for} \PY{n}{index}\PY{p}{,} \PY{p}{(}\PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{image}\PY{p}{)} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{missclassified}\PY{o}{.}\PY{n}{iterrows}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{:}
         
                 \PY{c+c1}{\PYZsh{} Add a subplot. Either a 3\PYZhy{}digit integer or three separate integers describing the position of the subplot.}
                 \PY{c+c1}{\PYZsh{} If the three integers are R, C, and P in order, the subplot will take the Pth position on}
                 \PY{c+c1}{\PYZsh{} a grid with R rows and C columns.}
                 \PY{n}{axs} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{n}{nb\PYZus{}rows}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{p}{,} \PY{n}{index} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
         
                 \PY{n}{axs}\PY{o}{.}\PY{n}{text}\PY{p}{(}
                     \PY{l+m+mi}{0}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{15}\PY{p}{,} \PY{n}{INV\PYZus{}CLASS}\PY{p}{[}\PY{n}{image}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{,} \PY{n}{horizontalalignment}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{left}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{axs}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{image}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{auto}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{axs}\PY{o}{.}\PY{n}{text}\PY{p}{(}
                     \PY{l+m+mi}{75}\PY{p}{,}
                     \PY{o}{\PYZhy{}}\PY{l+m+mi}{15}\PY{p}{,}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{INV\PYZus{}CLASS}\PY{p}{[}\PY{n}{image}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{,}
                     \PY{n}{horizontalalignment}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{left}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{axs}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         
         
         \PY{c+c1}{\PYZsh{} Plot the confusion matrix}
         
         
         \PY{k}{def} \PY{n+nf}{plot\PYZus{}confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{cm}\PY{p}{,}
                                   \PY{n}{target\PYZus{}names}\PY{p}{,}
                                   \PY{n}{plt\PYZus{}name}\PY{p}{,}
                                   \PY{n}{rootdir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                   \PY{n}{save\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{save/}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                   \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Confusion matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                   \PY{n}{cmap}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,}
                                   \PY{n}{normalize}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
             \PY{l+s+sd}{\PYZdq{}\PYZdq{}\PYZdq{}}
         \PY{l+s+sd}{        plot\PYZus{}confusion\PYZus{}matrix function prints \PYZam{} plots the confusion matrix.}
         \PY{l+s+sd}{        Normalization can be applied by setting `normalize=True`.}
         \PY{l+s+sd}{        :param cm:confusion matrix from sklearn.metrics.confusion\PYZus{}matrix}
         \PY{l+s+sd}{        :param target\PYZus{}names:classification classes list eg. [0, 1] [\PYZsq{}high\PYZsq{}, \PYZsq{}medium\PYZsq{}, \PYZsq{}low\PYZsq{}]}
         \PY{l+s+sd}{        :param rootdir:str}
         \PY{l+s+sd}{        :param save\PYZus{}dir:str}
         \PY{l+s+sd}{        :param plt\PYZus{}name:str}
         \PY{l+s+sd}{        :param title:str}
         \PY{l+s+sd}{        :param cmap:color map list}
         \PY{l+s+sd}{        :param normalize:bool}
         \PY{l+s+sd}{        :return:}
         \PY{l+s+sd}{        \PYZdq{}\PYZdq{}\PYZdq{}}
         
             \PY{n}{plt\PYZus{}name} \PY{o}{+}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}ConfusionMatrix}\PY{l+s+s1}{\PYZsq{}}
             \PY{k}{if} \PY{n}{normalize}\PY{p}{:}
                 \PY{n}{plt\PYZus{}name} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZus{}Normalized}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{plt\PYZus{}name}\PY{p}{)}
         
             \PY{n}{accuracy} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{trace}\PY{p}{(}\PY{n}{cm}\PY{p}{)} \PY{o}{/} \PY{n+nb}{float}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{cm}\PY{p}{)}\PY{p}{)}
             \PY{n}{misclass} \PY{o}{=} \PY{l+m+mi}{1} \PY{o}{\PYZhy{}} \PY{n}{accuracy}
         
             \PY{k}{if} \PY{n}{cmap} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                 \PY{n}{cmap} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{get\PYZus{}cmap}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Blues}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{cm}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nearest}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{n}{cmap}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{n}{title}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{colorbar}\PY{p}{(}\PY{p}{)}
         
             \PY{k}{if} \PY{n}{target\PYZus{}names} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
                 \PY{n}{tick\PYZus{}marks} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{target\PYZus{}names}\PY{p}{)}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{tick\PYZus{}marks}\PY{p}{,} \PY{n}{target\PYZus{}names}\PY{p}{,} \PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{yticks}\PY{p}{(}\PY{n}{tick\PYZus{}marks}\PY{p}{,} \PY{n}{target\PYZus{}names}\PY{p}{)}
         
             \PY{k}{if} \PY{n}{normalize}\PY{p}{:}
                 \PY{n}{cm} \PY{o}{=} \PY{n}{cm}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o}{/} \PY{n}{cm}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{newaxis}\PY{p}{]}
         
             \PY{n}{thresh} \PY{o}{=} \PY{n}{cm}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)} \PY{o}{/} \PY{l+m+mf}{1.5} \PY{k}{if} \PY{n}{normalize} \PY{k}{else} \PY{n}{cm}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)} \PY{o}{/} \PY{l+m+mi}{2}
             \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{j} \PY{o+ow}{in} \PY{n}{product}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n}{cm}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n+nb}{range}\PY{p}{(}\PY{n}{cm}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                 \PY{k}{if} \PY{n}{normalize}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}
                         \PY{n}{j}\PY{p}{,}
                         \PY{n}{i}\PY{p}{,}
                         \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:0.4f\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{cm}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{p}{,}
                         \PY{n}{horizontalalignment}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{center}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                         \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{white}\PY{l+s+s2}{\PYZdq{}} \PY{k}{if} \PY{n}{cm}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{thresh} \PY{k}{else} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{black}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{text}\PY{p}{(}
                         \PY{n}{j}\PY{p}{,}
                         \PY{n}{i}\PY{p}{,}
                         \PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{cm}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]}\PY{p}{)}\PY{p}{,}
                         \PY{n}{horizontalalignment}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{center}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                         \PY{n}{color}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{white}\PY{l+s+s2}{\PYZdq{}} \PY{k}{if} \PY{n}{cm}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{thresh} \PY{k}{else} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{black}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Predicted label}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Accuracy=}\PY{l+s+si}{\PYZob{}:0.4f\PYZcb{}}\PY{l+s+s1}{; Misclassified=}\PY{l+s+si}{\PYZob{}:0.4f\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}
                        \PY{n+nb}{format}\PY{p}{(}\PY{n}{accuracy}\PY{p}{,} \PY{n}{misclass}\PY{p}{)}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Saving Confusion Matrices in the }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ directory}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{rootdir} \PY{o}{+}
                                                                              \PY{n}{save\PYZus{}dir}\PY{p}{)}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}
                 \PY{n}{rootdir} \PY{o}{+} \PY{n}{save\PYZus{}dir} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{.png}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{plt\PYZus{}name}\PY{p}{)}\PY{p}{,}
                 \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{200}\PY{p}{,}
                 \PY{n+nb}{format}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{png}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{n}{bbox\PYZus{}inches}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tight}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
             \PY{n}{plt}\PY{o}{.}\PY{n}{close}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \hypertarget{load-data}{%
\subsection{2.2 Load Data}\label{load-data}}

    Let's read the seedlings images in \texttt{BGR} (Blue/Green/Red)
OpenCV's default format. It won't affect the segmentation in-case if
you'd like to use \texttt{RGB} format. Anyhow, \texttt{HSV}
(Hue/Saturation/Value) color space will be used for the processing of
images.

    \hypertarget{first-approach-using-simple-dictionary}{%
\subsubsection{First Approach: Using Simple
dictionary}\label{first-approach-using-simple-dictionary}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{} Flatten the plant images data after Segmentation \PYZam{} Masking}
        
        
        \PY{k}{def} \PY{n+nf}{load\PYZus{}seedlings}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                           \PY{n}{init\PYZus{}img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{,}
                           \PY{n}{final\PYZus{}img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{45}\PY{p}{,} \PY{l+m+mi}{45}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{images} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{defaultdict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{)}
        
            \PY{k}{for} \PY{n}{class\PYZus{}folder\PYZus{}name} \PY{o+ow}{in} \PY{n}{os}\PY{o}{.}\PY{n}{listdir}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{p}{)}\PY{p}{:}
                \PY{n}{class\PYZus{}folder\PYZus{}path} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{p}{,} \PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
        
                \PY{k}{for} \PY{n}{image\PYZus{}path} \PY{o+ow}{in} \PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}path}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{*.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                    \PY{c+c1}{\PYZsh{} Read an image}
                    \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{IMREAD\PYZus{}COLOR}\PY{p}{)}
        
                    \PY{c+c1}{\PYZsh{} Stats for each seedlings class}
                    \PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
        
                    \PY{c+c1}{\PYZsh{} Resize image to default init\PYZus{}img\PYZus{}size pixels 150*150}
                    \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}
                        \PY{n}{image}\PY{p}{,} \PY{n}{init\PYZus{}img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
        
                    \PY{c+c1}{\PYZsh{} Segementation}
                    \PY{n}{image} \PY{o}{=} \PY{n}{segment\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
        
                    \PY{c+c1}{\PYZsh{} BGR2GRAY conversion}
                    \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{cvtColor}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{COLOR\PYZus{}BGR2GRAY}\PY{p}{)}
        
                    \PY{c+c1}{\PYZsh{} Resize image to default final\PYZus{}img\PYZus{}size pixels 45*45}
                    \PY{k}{if} \PY{p}{(}\PY{n}{init\PYZus{}img\PYZus{}size} \PY{o}{!=} \PY{n}{final\PYZus{}img\PYZus{}size}\PY{p}{)}\PY{p}{:}
                        \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}
                            \PY{n}{image}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
        
                    \PY{n}{image} \PY{o}{=} \PY{n}{image}\PY{o}{.}\PY{n}{flatten}\PY{p}{(}\PY{p}{)}
        
                    \PY{n}{images}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                    \PY{n}{labels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
        
            \PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{images}\PY{p}{)}
            \PY{n}{labels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
        
            \PY{k}{return} \PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{images\PYZus{}per\PYZus{}class}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{c+c1}{\PYZsh{} Load Images, Labels \PYZam{} images\PYZus{}per\PYZus{}class dict}
         
         \PY{k}{try}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Images, Labels \PYZam{} images\PYZus{}per\PYZus{}class dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{images} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{labels} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                 \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}per\PYZus{}class.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images, Labels or images\PYZus{}per\PYZus{}class dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{k}{if} \PY{o+ow}{not} \PY{p}{(}\PY{n}{images}\PY{o}{.}\PY{n}{size} \PY{o+ow}{or} \PY{n}{labels}\PY{o}{.}\PY{n}{size}\PY{p}{)} \PY{o+ow}{or} \PY{p}{(}\PY{o+ow}{not} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{)}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Running load\PYZus{}seedlings method ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{load\PYZus{}seedlings}\PY{p}{(}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping Images, Labels \PYZam{} images\PYZus{}per\PYZus{}class dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} Dumping dicts}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{labels}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{,}
                         \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}per\PYZus{}class.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images, Labels or images\PYZus{}per\PYZus{}class dict dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading Images, Labels \& images\_per\_class dict {\ldots}
Loading done.

    \end{Verbatim}

    \hypertarget{number-of-images-per-class}{%
\paragraph{Number of images per
class}\label{number-of-images-per-class}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}42}]:} \PY{k}{for} \PY{n}{key}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+si}{\PYZob{}0\PYZcb{}}\PY{l+s+s2}{ \PYZhy{}\PYZgt{} }\PY{l+s+si}{\PYZob{}1\PYZcb{}}\PY{l+s+s2}{\PYZdq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{key}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{value}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Charlock -> 390
Common Chickweed -> 611
Shepherds Purse -> 231
Small-flowered Cranesbill -> 496
Common wheat -> 221
Fat Hen -> 475
Cleavers -> 287
Sugar beet -> 385
Maize -> 221
Loose Silky-bent -> 654
Scentless Mayweed -> 516
Black-grass -> 263

    \end{Verbatim}

    \hypertarget{second-approach-using-train-test-dictionary}{%
\subsubsection{Second Approach: Using Train \& Test
dictionary}\label{second-approach-using-train-test-dictionary}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{c+c1}{\PYZsh{} Resize all image to 51x51}
        \PY{k}{def} \PY{n+nf}{img\PYZus{}reshape}\PY{p}{(}\PY{n}{img}\PY{p}{)}\PY{p}{:}
            \PY{n}{img} \PY{o}{=} \PY{n}{imresize}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{51}\PY{p}{,} \PY{l+m+mi}{51}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
            \PY{k}{return} \PY{n}{img}
        
        
        \PY{c+c1}{\PYZsh{} get image tag}
        \PY{k}{def} \PY{n+nf}{img\PYZus{}label}\PY{p}{(}\PY{n}{path}\PY{p}{)}\PY{p}{:}
            \PY{k}{return} \PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{str}\PY{p}{(}\PY{n}{path}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} get plant class on image}
        \PY{k}{def} \PY{n+nf}{img\PYZus{}class}\PY{p}{(}\PY{n}{path}\PY{p}{)}\PY{p}{:}
            \PY{k}{return} \PY{n+nb}{str}\PY{p}{(}\PY{n}{path}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} fill train and test dict}
        \PY{k}{def} \PY{n+nf}{fill\PYZus{}dict}\PY{p}{(}\PY{n}{paths}\PY{p}{,} \PY{n}{some\PYZus{}dict}\PY{p}{)}\PY{p}{:}
            \PY{n}{text} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}
            \PY{k}{if} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{paths}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}
                \PY{n}{text} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Start fill train\PYZus{}dict}\PY{l+s+s1}{\PYZsq{}}
            \PY{k}{elif} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{paths}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}
                \PY{n}{text} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Start fill test\PYZus{}dict}\PY{l+s+s1}{\PYZsq{}}
        
            \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{tqdm}\PY{p}{(}\PY{n}{paths}\PY{p}{,} \PY{n}{ascii}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ncols}\PY{o}{=}\PY{l+m+mi}{85}\PY{p}{,} \PY{n}{desc}\PY{o}{=}\PY{n}{text}\PY{p}{)}\PY{p}{:}
                \PY{n}{img} \PY{o}{=} \PY{n}{imageio}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{p}\PY{p}{)}
                \PY{n}{img} \PY{o}{=} \PY{n}{img\PYZus{}reshape}\PY{p}{(}\PY{n}{img}\PY{p}{)}
                \PY{n}{some\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{img}\PY{p}{)}
                \PY{n}{some\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{img\PYZus{}label}\PY{p}{(}\PY{n}{p}\PY{p}{)}\PY{p}{)}
                \PY{k}{if} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{paths}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{:}
                    \PY{n}{some\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{img\PYZus{}class}\PY{p}{(}\PY{n}{p}\PY{p}{)}\PY{p}{)}
        
            \PY{k}{return} \PY{n}{some\PYZus{}dict}
        
        
        \PY{c+c1}{\PYZsh{} read image from dir. and fill train and test dict}
        \PY{k}{def} \PY{n+nf}{reader}\PY{p}{(}\PY{p}{)}\PY{p}{:}
            \PY{n}{file\PYZus{}ext} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{n}{train\PYZus{}path} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{n}{test\PYZus{}path} \PY{o}{=} \PY{p}{[}\PY{p}{]}
        
            \PY{k}{for} \PY{n}{root}\PY{p}{,} \PY{n}{dirs}\PY{p}{,} \PY{n}{files} \PY{o+ow}{in} \PY{n}{os}\PY{o}{.}\PY{n}{walk}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./data/all}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
                \PY{k}{if} \PY{n}{dirs} \PY{o}{!=} \PY{p}{[}\PY{p}{]}\PY{p}{:}
                    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Root:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{root}\PY{p}{)}\PY{p}{)}
                    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dirs:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{dirs}\PY{p}{)}\PY{p}{)}
                \PY{k}{else}\PY{p}{:}
                    \PY{k}{for} \PY{n}{f} \PY{o+ow}{in} \PY{n}{files}\PY{p}{:}
                        \PY{n}{ext} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{splitext}\PY{p}{(}\PY{n+nb}{str}\PY{p}{(}\PY{n}{f}\PY{p}{)}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}
        
                        \PY{k}{if} \PY{n}{ext} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{file\PYZus{}ext}\PY{p}{:}
                            \PY{n}{file\PYZus{}ext}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{ext}\PY{p}{)}
        
                        \PY{k}{if} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{root}\PY{p}{:}
                            \PY{n}{path} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root}\PY{p}{,} \PY{n}{f}\PY{p}{)}
                            \PY{n}{train\PYZus{}path}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{path}\PY{p}{)}
                        \PY{k}{elif} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{in} \PY{n}{root}\PY{p}{:}
                            \PY{n}{path} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root}\PY{p}{,} \PY{n}{f}\PY{p}{)}
                            \PY{n}{test\PYZus{}path}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{path}\PY{p}{)}
            \PY{n}{train\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{p}{]}\PY{p}{\PYZcb{}}
            \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{p}{]}\PY{p}{\PYZcb{}}
        
            \PY{n}{train\PYZus{}dict} \PY{o}{=} \PY{n}{fill\PYZus{}dict}\PY{p}{(}\PY{n}{train\PYZus{}path}\PY{p}{,} \PY{n}{train\PYZus{}dict}\PY{p}{)}
            \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{fill\PYZus{}dict}\PY{p}{(}\PY{n}{test\PYZus{}path}\PY{p}{,} \PY{n}{test\PYZus{}dict}\PY{p}{)}
        
            \PY{k}{return} \PY{n}{train\PYZus{}dict}\PY{p}{,} \PY{n}{test\PYZus{}dict}
\end{Verbatim}


    \hypertarget{basic-statistical-summaries-visualisations}{%
\subsection{2.3 Basic Statistical Summaries \&
Visualisations¶}\label{basic-statistical-summaries-visualisations}}

    To understand the data we are now going to consider some key facts about
seedlings \texttt{class} and \texttt{count}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{c+c1}{\PYZsh{} Dataframe containing seedlings class and count}
         
         \PY{n}{images\PYZus{}per\PYZus{}class\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n+nb}{list}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{n+nb}{len}\PY{p}{(}\PY{n}{value}\PY{p}{)} \PY{k}{for} \PY{n}{value} \PY{o+ow}{in} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{]}
         \PY{p}{\PYZcb{}}\PY{p}{)}
         \PY{n}{images\PYZus{}per\PYZus{}class\PYZus{}df}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}39}]:}                        Class  Count
         0                   Charlock    390
         1           Common Chickweed    611
         2            Shepherds Purse    231
         3  Small-flowered Cranesbill    496
         4               Common wheat    221
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}38}]:} \PY{c+c1}{\PYZsh{} Plot seedlings by class and count}
         
         \PY{n}{seaborn} \PY{o}{=} \PY{n}{sns}\PY{o}{.}\PY{n}{FacetGrid}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class\PYZus{}df}\PY{p}{,} \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{aspect}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{n}{seaborn}\PY{o}{.}\PY{n}{map}\PY{p}{(}\PY{n}{sns}\PY{o}{.}\PY{n}{barplot}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Count}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{palette}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{deep}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{seaborn}\PY{o}{.}\PY{n}{set\PYZus{}xticklabels}\PY{p}{(}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{30}\PY{p}{)}
         \PY{n}{seaborn}\PY{o}{.}\PY{n}{add\PYZus{}legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_42_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Plot an \texttt{image\ grid} of \texttt{Small-flowered\ Cranesbill}
plant seedlings

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{n}{plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{nb\PYZus{}rows}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_44_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Plot an \texttt{image\ grid} of \texttt{Maize} plant seedlings

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}49}]:} \PY{n}{plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Maize}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{nb\PYZus{}rows}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_46_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Plot an \texttt{image\ grid} of \texttt{All} seedling

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}137}]:} \PY{n}{image\PYZus{}grid\PYZus{}plot\PYZus{}for\PYZus{}classes}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_48_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}182}]:} \PY{n}{grid\PYZus{}plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_49_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{data-preparation}{%
\section{3. Data Preparation}\label{data-preparation}}

After statistics analysis \& visualizing the different aspects of
images, we will \texttt{sanitize} or clean the training data for our
model.

    \hypertarget{sanitize-data}{%
\subsection{3.1 Sanitize Data}\label{sanitize-data}}

    As we can see that each image has a background which makes contour of
plant leaves obscure or unclear. Hence we will segregate background from
foreground and hope it might help us achieve better accuracy.

For removing the background, we'll use the fact that all plant leaves
are green and we can create a mask to remove background.

    \hypertarget{masking-segmenting-sharpening-green}{%
\subsubsection{Masking, Segmenting \& Sharpening
Green}\label{masking-segmenting-sharpening-green}}

For creating mask, which will remove background, we need to convert
BGR/RGB image to HSV. HSV is alternative of the BGR/RGB color model. In
HSV, it is easier to represent a color range than in BGR/RGB color
space.

Being a simple object detection problem, we will use the color of the
object for background segregation. The HSV color-space is suitable for
color detection because we can define a color with \texttt{Hue} and it's
variations or spectrum using \texttt{Saturation} \& \texttt{Value}. eg.
Red, Darker Red, Lighter Red.

The following figure illustrates the HSV color space.

\begin{figure}
\centering
\includegraphics{https://www.mathworks.com/help/images/hsvcone.gif}
\caption{alt text}
\end{figure}

As hue varies from 0 to 1.0, the corresponding colors vary from red
through yellow, green, cyan, blue, magenta, and back to red, so that
there are actually red values both at 0 and 1.0. As saturation varies
from 0 to 1.0, the corresponding colors (hues) vary from unsaturated
(shades of gray) to fully saturated (no white component). As value, or
brightness, varies from 0 to 1.0, the corresponding colors become
increasingly brighter.

\href{https://www.mathworks.com/help/images/convert-from-hsv-to-rgb-color-space.html}{HSV
to RGB Color Space}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}60}]:} \PY{c+c1}{\PYZsh{} Plot the plant images according to each class label}
         
         
         \PY{k}{def} \PY{n+nf}{plot\PYZus{}masked\PYZus{}image}\PY{p}{(}\PY{n}{images}\PY{p}{,} \PY{n}{nb\PYZus{}cols}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{:}
         
             \PY{c+c1}{\PYZsh{} Generate figure, axes}
             \PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}
                 \PY{n}{nrows}\PY{o}{=}\PY{n+nb}{len}\PY{p}{(}\PY{n}{images}\PY{p}{)}\PY{p}{,} \PY{n}{ncols}\PY{o}{=}\PY{n}{nb\PYZus{}cols}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Iterating over different trials \PYZam{} parameters}
             \PY{k}{for} \PY{n}{index}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{images}\PY{p}{)}\PY{p}{:}
         
                 \PY{c+c1}{\PYZsh{} Mask, Segment \PYZam{} Sharpen}
                 \PY{n}{image\PYZus{}mask} \PY{o}{=} \PY{n}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                 \PY{n}{image\PYZus{}segmented} \PY{o}{=} \PY{n}{segment\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                 \PY{n}{image\PYZus{}sharpen} \PY{o}{=} \PY{n}{sharpen\PYZus{}image}\PY{p}{(}\PY{n}{image\PYZus{}segmented}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} Show images}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}mask}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}segmented}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}sharpen}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} Set x, y tick labels}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
                 \PY{n}{axes}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{yaxis}\PY{o}{.}\PY{n}{set\PYZus{}ticklabels}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
         
             \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}61}]:} \PY{n}{plot\PYZus{}masked\PYZus{}image}\PY{p}{(}\PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{97}\PY{p}{:}\PY{l+m+mi}{101}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_55_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{} Test image to see the changes}
         
         \PY{n}{image} \PY{o}{=} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{97}\PY{p}{]}
         
         \PY{n}{image\PYZus{}mask} \PY{o}{=} \PY{n}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
         \PY{n}{image\PYZus{}segmented} \PY{o}{=} \PY{n}{segment\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
         \PY{n}{image\PYZus{}sharpened} \PY{o}{=} \PY{n}{sharpen\PYZus{}image}\PY{p}{(}\PY{n}{image\PYZus{}segmented}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Segment Mask \PYZam{} Sharpen for the plant using mark\PYZus{}segment\PYZus{}sharpen\PYZus{}image method}
         \PY{c+c1}{\PYZsh{} image, image\PYZus{}mask, image\PYZus{}segmented, image\PYZus{}sharpened = mark\PYZus{}segment\PYZus{}sharpen\PYZus{}image(image, img\PYZus{}size=(150, 150))}
         
         \PY{n}{fig}\PY{p}{,} \PY{n}{axs} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{)}\PY{p}{)}
         \PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image}\PY{p}{)}
         \PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}mask}\PY{p}{)}
         \PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}segmented}\PY{p}{)}
         \PY{n}{axs}\PY{p}{[}\PY{l+m+mi}{3}\PY{p}{]}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{image\PYZus{}sharpened}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}19}]:} <matplotlib.image.AxesImage at 0x7fd869bc4438>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_56_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{categorize-class-labels}{%
\subsection{3.2 Categorize Class Labels}\label{categorize-class-labels}}

    Let's create a dictionary and reverse dictionary containing mapping from
label to id \& vice-versa.

    \hypertarget{first-approach-using-simple-dictionary-with-for-loop}{%
\subsubsection{First Approach: Using Simple dictionary with for
loop}\label{first-approach-using-simple-dictionary-with-for-loop}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}124}]:} \PY{c+c1}{\PYZsh{} Create a mapping from a flower class to an unique integer id \PYZam{} vice\PYZhy{}versa}
          
          \PY{n}{label\PYZus{}to\PYZus{}id\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{v}\PY{p}{:} \PY{n}{i} \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
          \PY{n}{id\PYZus{}to\PYZus{}label\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{v}\PY{p}{:} \PY{n}{k} \PY{k}{for} \PY{n}{k}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n}{label\PYZus{}to\PYZus{}id\PYZus{}dict}\PY{o}{.}\PY{n}{items}\PY{p}{(}\PY{p}{)}\PY{p}{\PYZcb{}}
          
          \PY{c+c1}{\PYZsh{} Covert train images label into id}
          \PY{n}{label\PYZus{}ids} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{label\PYZus{}to\PYZus{}id\PYZus{}dict}\PY{p}{[}\PY{n}{x}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{labels}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \hypertarget{second-approach-using-labelencoder}{%
\subsubsection{Second Approach: Using
LabelEncoder}\label{second-approach-using-labelencoder}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}104}]:} \PY{c+c1}{\PYZsh{} Plot of label types numbers}
          \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{labels}\PY{p}{)}\PY{o}{.}\PY{n}{value\PYZus{}counts}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}
              \PY{n}{kind}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pie}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Labels Distribution}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Encode labels and create classes}
          \PY{n}{le} \PY{o}{=} \PY{n}{LabelEncoder}\PY{p}{(}\PY{p}{)}
          \PY{n}{le}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
          \PY{n}{labels\PYZus{}encoded} \PY{o}{=} \PY{n}{le}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Classes: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{le}\PY{o}{.}\PY{n}{classes\PYZus{}}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Convert labels into categorical values}
          \PY{n}{labels\PYZus{}onehot} \PY{o}{=} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{labels\PYZus{}encoded}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Number of One Hot encoded class labels: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{labels\PYZus{}onehot}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_62_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]


Classes:  ['Black-grass' 'Charlock' 'Cleavers' 'Common Chickweed' 'Common wheat'
 'Fat Hen' 'Loose Silky-bent' 'Maize' 'Scentless Mayweed'
 'Shepherds Purse' 'Small-flowered Cranesbill' 'Sugar beet']

Number of One Hot encoded class labels:  12

    \end{Verbatim}

    \hypertarget{advanced-statistical-summaries-visualisations}{%
\subsection{3.3 Advanced Statistical Summaries \&
Visualisations¶}\label{advanced-statistical-summaries-visualisations}}

    \hypertarget{contours-statistics}{%
\subsubsection{3.3.1 Contours Statistics}\label{contours-statistics}}

    From the mask image, we can extract some features like the contour area
and number of components etc. and understand how the area of a plant
changes according to each class.

We can extract much more interesting information from \texttt{contours}.
Please have a look below for further information.

Additional read: https://en.wikipedia.org/wiki/Image\_moment

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}99}]:} \PY{c+c1}{\PYZsh{} Load images\PYZus{}per\PYZus{}class dictionary}
         
         \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
             \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}per\PYZus{}class.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}102}]:} \PY{c+c1}{\PYZsh{} Let\PYZsq{}s find contours and calculate the largest contour \PYZam{} total area}
          
          \PY{n}{areas} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          \PY{n}{larges\PYZus{}contour\PYZus{}areas} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          \PY{n}{nb\PYZus{}of\PYZus{}contours} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          \PY{n}{images\PYZus{}height} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          \PY{n}{images\PYZus{}width} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          
          \PY{k}{for} \PY{n}{class\PYZus{}label} \PY{o+ow}{in} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
              \PY{k}{for} \PY{n}{image} \PY{o+ow}{in} \PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{class\PYZus{}label}\PY{p}{]}\PY{p}{:}
          
                  \PY{c+c1}{\PYZsh{} Mask for an image}
                  \PY{n}{mask} \PY{o}{=} \PY{n}{create\PYZus{}mask\PYZus{}for\PYZus{}plant}\PY{p}{(}\PY{n}{image}\PY{p}{)}
          
                  \PY{c+c1}{\PYZsh{} Find \PYZam{} calculate contour stats}
                  \PY{n}{contours} \PY{o}{=} \PY{n}{find\PYZus{}contours}\PY{p}{(}\PY{n}{mask}\PY{p}{)}
                  \PY{n}{area} \PY{o}{=} \PY{n}{calculate\PYZus{}contours\PYZus{}area}\PY{p}{(}\PY{n}{contours}\PY{p}{)}
                  \PY{n}{largest\PYZus{}area} \PY{o}{=} \PY{n}{calculate\PYZus{}largest\PYZus{}contour\PYZus{}area}\PY{p}{(}\PY{n}{contours}\PY{p}{)}
                  \PY{n}{height}\PY{p}{,} \PY{n}{width}\PY{p}{,} \PY{n}{channels} \PY{o}{=} \PY{n}{image}\PY{o}{.}\PY{n}{shape}
          
                  \PY{c+c1}{\PYZsh{} Save the stats in the lists}
                  \PY{n}{nb\PYZus{}of\PYZus{}contours}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{contours}\PY{p}{)}\PY{p}{)}
                  \PY{n}{areas}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{area}\PY{p}{)}
                  \PY{n}{larges\PYZus{}contour\PYZus{}areas}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{largest\PYZus{}area}\PY{p}{)}
                  \PY{n}{images\PYZus{}height}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{height}\PY{p}{)}
                  \PY{n}{images\PYZus{}width}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{width}\PY{p}{)}
          
                  \PY{n}{labels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{class\PYZus{}label}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}105}]:} \PY{c+c1}{\PYZsh{} Save the features in a dataframe}
          
          \PY{n}{features\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{data}\PY{o}{=}\PY{p}{\PYZob{}}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{labels}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{area}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{areas}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{largest\PYZus{}contour\PYZus{}area}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{larges\PYZus{}contour\PYZus{}areas}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{no\PYZus{}of\PYZus{}countours}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{nb\PYZus{}of\PYZus{}contours}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{height}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{images\PYZus{}height}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{width}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{images\PYZus{}width}
          \PY{p}{\PYZcb{}}\PY{p}{)}
          \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{to\PYZus{}hdf}\PY{p}{(}
              \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{contours\PYZus{}features\PYZus{}df.hdf}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
              \PY{n}{key}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{contours\PYZus{}features\PYZus{}df}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
              \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{w}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{label}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{o}{.}\PY{n}{describe}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}105}]:}                             area                                        \textbackslash{}
                                     count           mean            std     min   
          label                                                                    
          Black-grass                263.0   41793.982890  159636.952451     0.0   
          Charlock                   390.0   91669.094872  150626.968468  3177.5   
          Cleavers                   287.0   25619.073171   24726.375631   567.5   
          Common Chickweed           611.0   14935.878887   20172.494215     0.0   
          Common wheat               221.0    6949.357466    8161.181143     0.0   
          Fat Hen                    475.0   30623.629474   67760.225738   512.0   
          Loose Silky-bent           654.0   24618.366208  132431.879535     0.0   
          Maize                      221.0  115311.341629  206882.627747   851.5   
          Scentless Mayweed          516.0   15517.381783   27678.754205     0.0   
          Shepherds Purse            231.0   38187.586580   66440.811037   562.0   
          Small-flowered Cranesbill  496.0   38126.337702   48735.741208   678.5   
          Sugar beet                 385.0   79003.370130  112091.057669     0.0   
          
                                                                                height  \textbackslash{}
                                           25\%       50\%         75\%        max  count   
          label                                                                          
          Black-grass                 1559.750   7204.00   23556.250  2097133.5  263.0   
          Charlock                   12795.125  39382.25   80786.125  1193936.5  390.0   
          Cleavers                    8368.000  18717.50   34363.000   175187.0  287.0   
          Common Chickweed            1917.500   5026.00   25140.000   131654.5  611.0   
          Common wheat                1883.000   4044.50    8953.000    57880.0  221.0   
          Fat Hen                     2804.250   6153.50   28209.000   561161.5  475.0   
          Loose Silky-bent             718.500   1795.50    8252.500  1930040.5  654.0   
          Maize                       3885.500  52033.00  119356.000  1435536.5  221.0   
          Scentless Mayweed           1589.250   3314.25   14044.125   198328.5  516.0   
          Shepherds Purse             3303.500   7435.50   45623.250   415662.5  231.0   
          Small-flowered Cranesbill   7834.625  16201.50   42556.500   306815.5  496.0   
          Sugar beet                 16029.000  40748.50   81174.000   815699.0  385.0   
          
                                                  {\ldots}   no\_of\_countours         width  \textbackslash{}
                                           mean   {\ldots}               75\%    max  count   
          label                                   {\ldots}                                   
          Black-grass                661.307985   {\ldots}             22.00  195.0  263.0   
          Charlock                   431.976923   {\ldots}              2.75   61.0  390.0   
          Cleavers                   310.292683   {\ldots}              4.00   32.0  287.0   
          Common Chickweed           230.708674   {\ldots}              2.00   24.0  611.0   
          Common wheat               440.167421   {\ldots}             37.00  203.0  221.0   
          Fat Hen                    303.008421   {\ldots}              5.00   88.0  475.0   
          Loose Silky-bent           397.897554   {\ldots}             12.00  305.0  654.0   
          Maize                      483.239819   {\ldots}              4.00   87.0  221.0   
          Scentless Mayweed          226.003876   {\ldots}              2.00  123.0  516.0   
          Shepherds Purse            288.541126   {\ldots}              2.00   49.0  231.0   
          Small-flowered Cranesbill  342.316532   {\ldots}             10.00   92.0  496.0   
          Sugar beet                 590.309091   {\ldots}              4.00   19.0  385.0   
          
                                                                                   \textbackslash{}
                                           mean         std    min     25\%    50\%   
          label                                                                     
          Black-grass                668.638783  520.794148   73.0  290.00  586.0   
          Charlock                   431.982051  287.746036  121.0  188.00  375.5   
          Cleavers                   310.292683  151.918747   66.0  171.50  298.0   
          Common Chickweed           230.708674  160.842547   54.0  107.50  156.0   
          Common wheat               440.171946  303.226509   51.0  136.00  456.0   
          Fat Hen                    303.008421  210.947401   55.0  162.00  234.0   
          Loose Silky-bent           399.596330  420.449270   71.0  136.00  197.0   
          Maize                      483.253394  417.085743   54.0  114.00  415.0   
          Scentless Mayweed          226.003876  211.790279   49.0   87.00  123.0   
          Shepherds Purse            288.541126  248.176509   63.0  117.50  169.0   
          Small-flowered Cranesbill  342.316532  194.215528   62.0  173.75  286.0   
          Sugar beet                 591.477922  337.497855   49.0  373.00  551.0   
          
                                                     
                                        75\%     max  
          label                                      
          Black-grass                906.00  2840.0  
          Charlock                   514.75  1582.0  
          Cleavers                   423.00   866.0  
          Common Chickweed           376.50   718.0  
          Common wheat               651.00  1432.0  
          Fat Hen                    369.00  1273.0  
          Loose Silky-bent           535.75  3991.0  
          Maize                      706.00  1900.0  
          Scentless Mayweed          363.50  1227.0  
          Shepherds Purse            400.00  1317.0  
          Small-flowered Cranesbill  459.25  1006.0  
          Sugar beet                 744.00  1715.0  
          
          [12 rows x 40 columns]
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}106}]:} \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}106}]:}       area  height     label  largest\_contour\_area  no\_of\_countours  width
          0  24198.5     360  Cleavers               12418.0                3    360
          1   8176.0     149  Cleavers                8176.0                1    149
          2  12717.0     225  Cleavers               12717.0                1    225
          3  35139.0     404  Cleavers               21444.0                5    404
          4  20688.0     315  Cleavers                9436.0               12    315
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}107}]:} \PY{k}{del} \PY{n}{images\PYZus{}per\PYZus{}class}
\end{Verbatim}


    \hypertarget{pca-visualization}{%
\subsubsection{3.3.2 PCA Visualization}\label{pca-visualization}}

    Let's load the seedlings images \& corresponding helper function.

    \hypertarget{map-labels-function}{%
\paragraph{Map Labels function}\label{map-labels-function}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}92}]:} \PY{c+c1}{\PYZsh{} Create a mapping from a flower class to an unique integer id \PYZam{} vice\PYZhy{}versa}
         
         \PY{n}{label\PYZus{}grey\PYZus{}to\PYZus{}id\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{v}\PY{p}{:} \PY{n}{i} \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{v} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{n}{labels\PYZus{}grey}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
         
         \PY{c+c1}{\PYZsh{} Covert train images label into id}
         
         \PY{n}{labels\PYZus{}grey\PYZus{}ids} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{label\PYZus{}grey\PYZus{}to\PYZus{}id\PYZus{}dict}\PY{p}{[}\PY{n}{x}\PY{p}{]} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{labels\PYZus{}grey}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \hypertarget{load-seedlings-function}{%
\paragraph{Load Seedlings function}\label{load-seedlings-function}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}58}]:} \PY{c+c1}{\PYZsh{} Return Grey the plant images data}
         
         
         \PY{k}{def} \PY{n+nf}{load\PYZus{}seedlings\PYZus{}grey}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                                 \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{images} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{images\PYZus{}mask} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         
             \PY{k}{for} \PY{n}{class\PYZus{}folder\PYZus{}name} \PY{o+ow}{in} \PY{n}{os}\PY{o}{.}\PY{n}{listdir}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{p}{)}\PY{p}{:}
                 \PY{n}{class\PYZus{}folder\PYZus{}path} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{train\PYZus{}dir}\PY{p}{,} \PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
         
                 \PY{k}{for} \PY{n}{image\PYZus{}path} \PY{o+ow}{in} \PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}path}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{*.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                     \PY{c+c1}{\PYZsh{} Read an image}
                     \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{IMREAD\PYZus{}COLOR}\PY{p}{)}
         
                     \PY{c+c1}{\PYZsh{} Resize image to default init\PYZus{}img\PYZus{}size pixels 150*150}
                     \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
         
                     \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{image\PYZus{}mask}\PY{p}{,} \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{image} \PY{o}{=} \PY{n}{mark\PYZus{}segment\PYZus{}sharpen\PYZus{}image}\PY{p}{(}
                         \PY{n}{image}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}
         
                     \PY{c+c1}{\PYZsh{} BGR2GRAY conversion}
                     \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{cvtColor}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{COLOR\PYZus{}BGR2GRAY}\PY{p}{)}
         
                     \PY{n}{images}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                     \PY{n}{images\PYZus{}mask}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image\PYZus{}mask}\PY{p}{)}
                     \PY{n}{labels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
         
             \PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{images}\PY{p}{)}
             \PY{n}{images\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{images\PYZus{}mask}\PY{p}{)}
             \PY{n}{labels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
         
             \PY{k}{return} \PY{n}{images}\PY{p}{,} \PY{n}{images\PYZus{}mask}\PY{p}{,} \PY{n}{labels}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}59}]:} \PY{n}{images\PYZus{}grey} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
         \PY{n}{images\PYZus{}grey\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
         \PY{n}{labels\PYZus{}grey} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Load Grey images \PYZam{} labels}
         
         \PY{k}{try}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Grey Images, Images Mask \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{images\PYZus{}grey} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                 \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}grey.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{images\PYZus{}grey\PYZus{}mask} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                 \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}grey\PYZhy{}mask.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{labels\PYZus{}grey} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                 \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}grey.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Grey Images, Images Mask or Labels dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{images\PYZus{}grey}\PY{o}{.}\PY{n}{size} \PY{o+ow}{or} \PY{o+ow}{not} \PY{n}{images\PYZus{}grey\PYZus{}mask}\PY{o}{.}\PY{n}{size} \PY{o+ow}{or} \PY{o+ow}{not} \PY{n}{labels\PYZus{}grey}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{:}
             \PY{n}{img\PYZus{}size} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Running Grey load\PYZus{}seedlings method with img\PYZus{}size }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ ...}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{n}{img\PYZus{}size}\PY{p}{)}\PY{p}{)}
             \PY{n}{images\PYZus{}grey}\PY{p}{,} \PY{n}{images\PYZus{}grey\PYZus{}mask}\PY{p}{,} \PY{n}{labels\PYZus{}grey} \PY{o}{=} \PY{n}{load\PYZus{}seedlings\PYZus{}grey}\PY{p}{(}
                 \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{n}{img\PYZus{}size}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping Grey Images, Images Mask \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} Dumping dicts}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{,}
                         \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}grey.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}grey\PYZus{}mask}\PY{p}{,}
                         \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}grey\PYZhy{}mask.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{labels\PYZus{}grey}\PY{p}{,}
                         \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}grey.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Grey Images, Images Mask \PYZam{} Labels dict dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shape of images\PYZus{}grey: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}grey}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shape of images\PYZus{}grey\PYZus{}mask: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}grey\PYZus{}mask}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shape of labels\PYZus{}grey: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labels\PYZus{}grey}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading Grey Images \& Labels dict {\ldots}
Stacktrace [Errno 2] No such file or directory: './save/pickles/images-grey-mask.pickle'
Grey Images \& Labels dict does not exist.
Running Grey load\_seedlings method with img\_size (150, 150) {\ldots}
Dumping Grey Images \& Labels dict {\ldots}
Grey Images \& Labels dict dumping done.
Shape of images\_grey:  (4750, 150, 150)
Shape of images\_grey\_mask:  (4750, 150, 150)
Shape of labels\_grey:  (4750,)

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}75}]:} \PY{c+c1}{\PYZsh{} Sample image}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{[}\PY{l+m+mi}{2000}\PY{p}{]}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{150}\PY{p}{,} \PY{l+m+mi}{150}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}75}]:} <matplotlib.image.AxesImage at 0x7f88dcd3f3c8>
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_78_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{define-gaussianmodel-or-pca}{%
\paragraph{3.3.2.1 Define GaussianModel or
PCA}\label{define-gaussianmodel-or-pca}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}46}]:} \PY{c+c1}{\PYZsh{} \PYZpc{}\PYZpc{} define GaussianModel class}
         
         
         \PY{k}{class} \PY{n+nc}{GaussianModel}\PY{p}{:}
             \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{numBasisFunctions}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{objectPixels}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                 \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{        inputs: }
         \PY{l+s+sd}{            X                    \PYZhy{} numSamples x numDimentions matrix}
         \PY{l+s+sd}{            numBasisFunctions       \PYZhy{} number of basis function to use}
         \PY{l+s+sd}{            objectPixels (optional) \PYZhy{} an binnary mask image used for presentation}
         \PY{l+s+sd}{                                      will be used as Im[objectPixels] = dataSample}
         \PY{l+s+sd}{                                      must satisfy objectPixels.ravel().sum() = X.shape[1]}
         \PY{l+s+sd}{        \PYZsq{}\PYZsq{}\PYZsq{}}
         
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions} \PY{o}{=} \PY{n}{numBasisFunctions}
                 \PY{k}{if} \PY{n}{objectPixels} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                     \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{X}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n}{np}\PY{o}{.}\PY{n}{bool}\PY{p}{)}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels} \PY{o}{=} \PY{n}{objectPixels}
                 \PY{k}{assert} \PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)} \PY{o}{==} \PY{n}{X}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
         
                 \PY{n}{PCAModel} \PY{o}{=} \PY{n}{decomposition}\PY{o}{.}\PY{n}{PCA}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{n}{numBasisFunctions}\PY{p}{,}
                                              \PY{n}{whiten}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation} \PY{o}{=} \PY{n}{PCAModel}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X}\PY{p}{)}
                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel} \PY{o}{=} \PY{n}{PCAModel}
         
             \PY{k}{def} \PY{n+nf}{RepresentUsingModel}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{)}\PY{p}{:}
                 \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X}\PY{p}{)}
         
             \PY{k}{def} \PY{n+nf}{ReconstructUsingModel}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X\PYZus{}transformed}\PY{p}{)}\PY{p}{:}
                 \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{inverse\PYZus{}transform}\PY{p}{(}\PY{n}{X\PYZus{}transformed}\PY{p}{)}
         
             \PY{k}{def} \PY{n+nf}{InterpretUsingModel}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{)}\PY{p}{:}
                 \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{inverse\PYZus{}transform}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} shows the eigenvectors of the gaussian covariance matrix}
             \PY{k}{def} \PY{n+nf}{ShowVarianceDirections}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{numDirectionsToShow}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}\PY{p}{:}
                 \PY{n}{numDirectionsToShow} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{numDirectionsToShow}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions}\PY{p}{)}
         
                 \PY{n}{numFigRows} \PY{o}{=} \PY{l+m+mi}{4}
                 \PY{n}{numFigCols} \PY{o}{=} \PY{l+m+mi}{4}
                 \PY{n}{numDirectionsPerFigure} \PY{o}{=} \PY{n}{numFigRows} \PY{o}{*} \PY{n}{numFigCols}
                 \PY{n}{numFigures} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}
                     \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{numDirectionsToShow}\PY{p}{)} \PY{o}{/} \PY{n}{numDirectionsPerFigure}\PY{p}{)}\PY{p}{)}
         
                 \PY{k}{for} \PY{n}{figureInd} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numFigures}\PY{p}{)}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
                     \PY{k}{for} \PY{n}{plotInd} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numDirectionsPerFigure}\PY{p}{)}\PY{p}{:}
                         \PY{n}{eigVecInd} \PY{o}{=} \PY{n}{numDirectionsPerFigure} \PY{o}{*} \PY{n}{figureInd} \PY{o}{+} \PY{n}{plotInd}
                         \PY{k}{if} \PY{n}{eigVecInd} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions}\PY{p}{:}
                             \PY{k}{break}
                         \PY{n}{deltaImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                         \PY{n}{deltaImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{components\PYZus{}}\PY{p}{[}
                             \PY{n}{eigVecInd}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{numFigRows}\PY{p}{,} \PY{n}{numFigCols}\PY{p}{,} \PY{n}{plotInd} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{deltaImage}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{deltaImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{n}{titleStr} \PY{o}{=} \PY{n+nb}{str}\PY{p}{(}
                             \PY{l+m+mi}{100} \PY{o}{*}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{explained\PYZus{}variance\PYZus{}ratio\PYZus{}}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{n}{titleStr} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{} e}\PY{l+s+s1}{xplained}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} shows several random model reconstructions}
             \PY{k}{def} \PY{n+nf}{ShowReconstructions}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{numReconstructions}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{:}
                 \PY{k}{assert} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{==} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                 \PY{n}{numSamples} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
                 \PY{n}{numReconstructions} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{numReconstructions}\PY{p}{,} \PY{n}{numSamples}\PY{p}{)}
         
                 \PY{n}{originalImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                 \PY{n}{reconstructedImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
         
                 \PY{n}{numReconstructionsPerFigure} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numReconstructions}\PY{p}{)}
                 \PY{n}{numFigures} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}
                     \PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{numReconstructions}\PY{p}{)} \PY{o}{/} \PY{n}{numReconstructionsPerFigure}\PY{p}{)}\PY{p}{)}
         
                 \PY{k}{for} \PY{n}{figureInd} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numFigures}\PY{p}{)}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
                     \PY{k}{for} \PY{n}{plotCol} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numReconstructionsPerFigure}\PY{p}{)}\PY{p}{:}
                         \PY{n}{dataSampleInd} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randint}\PY{p}{(}\PY{n}{numSamples}\PY{p}{)}
                         \PY{n}{originalImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PY{n}{X}\PY{p}{[}\PY{n}{dataSampleInd}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                         \PY{n}{reconstructedImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{InterpretUsingModel}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}
                                 \PY{n}{X}\PY{p}{[}\PY{n}{dataSampleInd}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                         \PY{n}{diffImage} \PY{o}{=} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{originalImage} \PY{o}{\PYZhy{}} \PY{n}{reconstructedImage}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} original image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{numReconstructionsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{0} \PY{o}{*} \PY{n}{numReconstructionsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{originalImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{original signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{originalImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{original image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} reconstred image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{numReconstructionsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{1} \PY{o}{*} \PY{n}{numReconstructionsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{reconstructedImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{reconstructed signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{reconstructedImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{reconstructed image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} diff image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{numReconstructionsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{numReconstructionsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{diffImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{abs difference signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{diffImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{abs difference image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} shows distrbution along the variance directions and several images along that variance direction}
             \PY{k}{def} \PY{n+nf}{ShowModelVariations}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{numVariations}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{:}
         
                 \PY{n}{showAsTraces} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{numVariations} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{numVariations}\PY{p}{,} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions}\PY{p}{)}
         
                 \PY{n}{numVarsPerFigure} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVariations}\PY{p}{)}
                 \PY{n}{numFigures} \PY{o}{=} \PY{n+nb}{int}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{ceil}\PY{p}{(}\PY{n+nb}{float}\PY{p}{(}\PY{n}{numVariations}\PY{p}{)} \PY{o}{/} \PY{n}{numVarsPerFigure}\PY{p}{)}\PY{p}{)}
         
                 \PY{n}{lowRepVec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
                 \PY{n}{medianRepVec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
                 \PY{n}{highRepVec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{,} \PY{l+m+mi}{98}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
                 \PY{k}{for} \PY{n}{figureInd} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numFigures}\PY{p}{)}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
                     \PY{k}{for} \PY{n}{plotCol} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{numVarsPerFigure}\PY{p}{)}\PY{p}{:}
                         \PY{n}{eigVecInd} \PY{o}{=} \PY{n}{numVarsPerFigure} \PY{o}{*} \PY{n}{figureInd} \PY{o}{+} \PY{n}{plotCol}
                         \PY{k}{if} \PY{n}{eigVecInd} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions}\PY{p}{:}
                             \PY{k}{break}
         
                         \PY{c+c1}{\PYZsh{} create the low and high precentile representation activation vectors}
                         \PY{n}{currLowPrecentileRepVec} \PY{o}{=} \PY{n}{medianRepVec}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
                         \PY{n}{currLowPrecentileRepVec}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]} \PY{o}{=} \PY{n}{lowRepVec}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}
                         \PY{n}{currHighPrecentileRepVec} \PY{o}{=} \PY{n}{medianRepVec}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
                         \PY{n}{currHighPrecentileRepVec}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]} \PY{o}{=} \PY{n}{highRepVec}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}
         
                         \PY{c+c1}{\PYZsh{} create blank images}
                         \PY{n}{deltaImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                         \PY{n}{medianImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                         \PY{n}{lowPrecentileImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                         \PY{n}{highPrecentileImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} fill the object pixels with the relevant data}
                         \PY{n}{deltaImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{components\PYZus{}}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                         \PY{n}{lowPrecentileImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ReconstructUsingModel}\PY{p}{(}\PY{n}{currLowPrecentileRepVec}\PY{p}{)}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                         \PY{n}{medianImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ReconstructUsingModel}\PY{p}{(}\PY{n}{medianRepVec}\PY{p}{)}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
                         \PY{n}{highPrecentileImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ReconstructUsingModel}\PY{p}{(}
                                 \PY{n}{currHighPrecentileRepVec}\PY{p}{)}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} calculate the Gaussian smoothed distribution of values along the eignevector direction}
                         \PY{n}{sigmaOfKDE} \PY{o}{=} \PY{l+m+mf}{0.12}
                         \PY{n}{pdfStart} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{sigmaOfKDE}
                         \PY{n}{pdfStop} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{sigmaOfKDE}
                         \PY{n}{xAxis} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{pdfStart}\PY{p}{,} \PY{n}{pdfStop}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{)}
                         \PY{n}{PDF\PYZus{}Model} \PY{o}{=} \PY{n}{KernelDensity}\PY{p}{(}
                             \PY{n}{kernel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gaussian}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{bandwidth}\PY{o}{=}\PY{n}{sigmaOfKDE}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
                                 \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{eigVecInd}\PY{p}{]}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                         \PY{n}{logPDF} \PY{o}{=} \PY{n}{PDF\PYZus{}Model}\PY{o}{.}\PY{n}{score\PYZus{}samples}\PY{p}{(}\PY{n}{xAxis}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show distribution of current component}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVarsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{0} \PY{o}{*} \PY{n}{numVarsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{fill}\PY{p}{(}\PY{n}{xAxis}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logPDF}\PY{p}{)}\PY{p}{,} \PY{n}{fc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{n}{percentExplainedString} \PY{o}{=} \PY{n+nb}{str}\PY{p}{(}
                             \PY{l+m+mi}{100} \PY{o}{*}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{explained\PYZus{}variance\PYZus{}ratio\PYZus{}}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{n}{percentExplainedString} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{} e}\PY{l+s+s1}{xplained}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show variance direction (eigenvector)}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVarsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{1} \PY{o}{*} \PY{n}{numVarsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{deltaImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{eigenvector }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{eigVecInd}\PY{p}{)}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{deltaImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{jet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{eigenvector }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{eigVecInd}\PY{p}{)}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show 2nd precentile image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVarsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{2} \PY{o}{*} \PY{n}{numVarsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{lowPrecentileImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2nd precentile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{lowPrecentileImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2nd precentile image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show median image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVarsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{numVarsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{medianImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median signal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{medianImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{median Image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show 98th precentile image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{numVarsPerFigure}\PY{p}{,}
                                     \PY{l+m+mi}{4} \PY{o}{*} \PY{n}{numVarsPerFigure} \PY{o}{+} \PY{n}{plotCol} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
                         \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{highPrecentileImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{98th precentile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{highPrecentileImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{98th precentile image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} shows distrbution along the variance directions and several images along that variance direction}
             \PY{k}{def} \PY{n+nf}{ShowSingleComponentVariation}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,} \PY{n}{X}\PY{p}{,} \PY{n}{listOfComponents}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
         
                 \PY{n}{showAsTraces} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{)}
                 \PY{k}{assert} \PY{p}{(}\PY{n+nb}{all}\PY{p}{(}
                     \PY{p}{[}\PY{p}{(}\PY{n}{x} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{numBasisFunctions}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{listOfComponents}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         
                 \PY{n}{X\PYZus{}rep} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{RepresentUsingModel}\PY{p}{(}\PY{n}{X}\PY{p}{)}
         
                 \PY{n}{percentilesToShow} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{20}\PY{p}{,} \PY{l+m+mi}{40}\PY{p}{,} \PY{l+m+mi}{60}\PY{p}{,} \PY{l+m+mi}{80}\PY{p}{,} \PY{l+m+mi}{99}\PY{p}{]}
                 \PY{n}{numReadDataSamplePerPercentile} \PY{o}{=} \PY{l+m+mi}{4}
                 \PY{n}{representationPercentiles} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 \PY{k}{for} \PY{n}{percentile} \PY{o+ow}{in} \PY{n}{percentilesToShow}\PY{p}{:}
                     \PY{n}{representationPercentiles}\PY{o}{.}\PY{n}{append}\PY{p}{(}
                         \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{,} \PY{n}{percentile}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
                 \PY{n}{medianRepVec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{,} \PY{l+m+mi}{50}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
                 \PY{k}{for} \PY{n}{eigVecInd} \PY{o+ow}{in} \PY{n}{listOfComponents}\PY{p}{:}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
                     \PY{n}{gs} \PY{o}{=} \PY{n}{gridspec}\PY{o}{.}\PY{n}{GridSpec}\PY{p}{(}\PY{n}{numReadDataSamplePerPercentile} \PY{o}{+} \PY{l+m+mi}{2}\PY{p}{,}
                                            \PY{n+nb}{len}\PY{p}{(}\PY{n}{percentilesToShow}\PY{p}{)}\PY{p}{)}
         
                     \PY{c+c1}{\PYZsh{} calculate the Gaussian smoothed distribution of values along the eignevector direction}
                     \PY{n}{sigmaOfKDE} \PY{o}{=} \PY{l+m+mf}{0.12}
                     \PY{n}{pdfStart} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,}
                                                            \PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{sigmaOfKDE}
                     \PY{n}{pdfStop} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,}
                                                           \PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{3} \PY{o}{*} \PY{n}{sigmaOfKDE}
                     \PY{n}{xAxis} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{n}{pdfStart}\PY{p}{,} \PY{n}{pdfStop}\PY{p}{,} \PY{l+m+mi}{200}\PY{p}{)}
                     \PY{n}{PDF\PYZus{}Model} \PY{o}{=} \PY{n}{KernelDensity}\PY{p}{(}
                         \PY{n}{kernel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gaussian}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{bandwidth}\PY{o}{=}\PY{n}{sigmaOfKDE}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{eigVecInd}\PY{p}{]}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                     \PY{n}{logPDF} \PY{o}{=} \PY{n}{PDF\PYZus{}Model}\PY{o}{.}\PY{n}{score\PYZus{}samples}\PY{p}{(}\PY{n}{xAxis}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
                     \PY{n}{percentileValuesToShow} \PY{o}{=} \PYZbs{}
                         \PY{p}{[}\PY{n}{representationPercentiles}\PY{p}{[}\PY{n}{x}\PY{p}{]}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}
                             \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{representationPercentiles}\PY{p}{)}\PY{p}{)}\PY{p}{]}
                     \PY{n}{percentilesToShowLogPDF} \PY{o}{=} \PYZbs{}
                         \PY{n}{PDF\PYZus{}Model}\PY{o}{.}\PY{n}{score\PYZus{}samples}\PY{p}{(}
                             \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{percentileValuesToShow}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         
                     \PY{c+c1}{\PYZsh{} show distribution of current component and red dots at the list of precentiles to show}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{fill}\PY{p}{(}\PY{n}{xAxis}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{logPDF}\PY{p}{)}\PY{p}{,} \PY{n}{fc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}
                         \PY{n}{percentileValuesToShow}\PY{p}{,}
                         \PY{n}{np}\PY{o}{.}\PY{n}{exp}\PY{p}{(}\PY{n}{percentilesToShowLogPDF}\PY{p}{)}\PY{p}{,}
                         \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                         \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{40}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}
                         \PY{n+nb}{str}\PY{p}{(}\PY{l+m+mi}{100} \PY{o}{*} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{PCAModel}\PY{o}{.}\PY{n}{explained\PYZus{}variance\PYZus{}ratio\PYZus{}}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)} \PY{o}{+}
                         \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{} e}\PY{l+s+s1}{xplained}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                     \PY{k}{for} \PY{n}{plotCol}\PY{p}{,} \PY{n}{currPrecentile} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{percentilesToShow}\PY{p}{)}\PY{p}{:}
                         \PY{n}{currPrecentileRepVec} \PY{o}{=} \PY{n}{medianRepVec}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
                         \PY{n}{currPrecentileRepVec}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]} \PY{o}{=} \PY{n}{representationPercentiles}\PY{p}{[}
                             \PY{n}{plotCol}\PY{p}{]}\PY{p}{[}\PY{n}{eigVecInd}\PY{p}{]}
         
                         \PY{n}{currPrecentileImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                         \PY{n}{currPrecentileImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PYZbs{}
                             \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{ReconstructUsingModel}\PY{p}{(}\PY{n}{currPrecentileRepVec}\PY{p}{)}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} show the median image with current precentile as activation of the curr image}
                         \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{plotCol}\PY{p}{]}\PY{p}{)}
                         \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{currPrecentileImage}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{precentile: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{percentilesToShow}\PY{p}{[}\PY{n}{plotCol}\PY{p}{]}\PY{p}{)}
                                       \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                         \PY{k}{else}\PY{p}{:}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{currPrecentileImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{precentile: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n}{percentilesToShow}\PY{p}{[}\PY{n}{plotCol}\PY{p}{]}\PY{p}{)}
                                       \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
                         \PY{c+c1}{\PYZsh{} find the most suitible candidates in X for current precentile}
                         \PY{n}{distFromPercentile} \PY{o}{=} \PY{n+nb}{abs}\PY{p}{(}\PY{n}{X\PYZus{}rep}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{n}{eigVecInd}\PY{p}{]} \PY{o}{\PYZhy{}}
                                                  \PY{n}{representationPercentiles}\PY{p}{[}\PY{n}{plotCol}\PY{p}{]}\PY{p}{[}
                                                      \PY{n}{eigVecInd}\PY{p}{]}\PY{p}{)}
                         \PY{n}{X\PYZus{}inds} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{argpartition}\PY{p}{(}\PY{n}{distFromPercentile}\PY{p}{,}
                                                  \PY{n}{numReadDataSamplePerPercentile}
                                                  \PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{n}{numReadDataSamplePerPercentile}\PY{p}{]}
                         \PY{k}{for} \PY{n}{k}\PY{p}{,} \PY{n}{X\PYZus{}ind} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{X\PYZus{}inds}\PY{p}{)}\PY{p}{:}
                             \PY{n}{currNearestPrecentileImage} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}
                                 \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{)}\PY{p}{)}
                             \PY{n}{currNearestPrecentileImage}\PY{p}{[}\PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{objectPixels}\PY{p}{]} \PY{o}{=} \PY{n}{X}\PY{p}{[}
                                 \PY{n}{X\PYZus{}ind}\PY{p}{,} \PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{ravel}\PY{p}{(}\PY{p}{)}
         
                             \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{n}{gs}\PY{p}{[}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{k}\PY{p}{,} \PY{n}{plotCol}\PY{p}{]}\PY{p}{)}
                             \PY{k}{if} \PY{n}{showAsTraces}\PY{p}{:}
                                 \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{currNearestPrecentileImage}\PY{p}{)}
                                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NN with closest percentile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                             \PY{k}{else}\PY{p}{:}
                                 \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{currNearestPrecentileImage}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{NN with closest percentile}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                                 \PY{n}{plt}\PY{o}{.}\PY{n}{axis}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
         
             \PY{k}{def} \PY{n+nf}{ShowDataScatterPlotsWithTSNE}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}
                                              \PY{n}{X}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,}
                                              \PY{n}{y}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,}
                                              \PY{n}{tSNE\PYZus{}perplexity}\PY{o}{=}\PY{l+m+mf}{30.0}\PY{p}{,}
                                              \PY{n}{colorMap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Paired}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
         
                 \PY{k}{if} \PY{n}{X} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                     \PY{n}{X\PYZus{}rep} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{dataRepresentation}
                 \PY{k}{else}\PY{p}{:}
                     \PY{n}{X\PYZus{}rep} \PY{o}{=} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{RepresentUsingModel}\PY{p}{(}\PY{n}{X}\PY{p}{)}
         
                 \PY{k}{if} \PY{n}{y} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
                     \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{X\PYZus{}rep}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
         
                 \PY{n}{tSNE\PYZus{}PCAModel} \PY{o}{=} \PY{n}{TSNE}\PY{p}{(}
                     \PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{perplexity}\PY{o}{=}\PY{n}{tSNE\PYZus{}perplexity}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
                 \PY{n}{X\PYZus{}rep\PYZus{}tSNE} \PY{o}{=} \PY{n}{tSNE\PYZus{}PCAModel}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{X\PYZus{}rep}\PY{p}{)}
                 \PY{p}{(}\PY{n}{tSNE\PYZus{}xmin}\PY{p}{,} \PY{n}{tSNE\PYZus{}xmax}\PY{p}{)} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{l+m+mf}{0.3}\PY{p}{)}\PY{p}{,}
                                           \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{l+m+mf}{99.7}\PY{p}{)}\PY{p}{)}
                 \PY{p}{(}\PY{n}{tSNE\PYZus{}ymin}\PY{p}{,} \PY{n}{tSNE\PYZus{}ymax}\PY{p}{)} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mf}{0.3}\PY{p}{)}\PY{p}{,}
                                           \PY{n}{np}\PY{o}{.}\PY{n}{percentile}\PY{p}{(}\PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mf}{99.7}\PY{p}{)}\PY{p}{)}
         
                 \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}
                     \PY{n}{X\PYZus{}rep}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{X\PYZus{}rep}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{n}{y}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{n}{colorMap}\PY{p}{,} \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PCA representation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PC1 coeff}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PC2 coeff}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{scatter}\PY{p}{(}
                     \PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}
                     \PY{n}{X\PYZus{}rep\PYZus{}tSNE}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
                     \PY{n}{c}\PY{o}{=}\PY{n}{y}\PY{p}{,}
                     \PY{n}{cmap}\PY{o}{=}\PY{n}{colorMap}\PY{p}{,}
                     \PY{n}{s}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{,}
                     \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{n}{tSNE\PYZus{}xmin}\PY{p}{,} \PY{n}{tSNE\PYZus{}xmax}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{ylim}\PY{p}{(}\PY{n}{tSNE\PYZus{}ymin}\PY{p}{,} \PY{n}{tSNE\PYZus{}ymax}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZhy{}SNE representation}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZhy{}SNE axis1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZhy{}SNE axis2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \hypertarget{train-the-gaussianmodel}{%
\paragraph{3.3.2.2 Train the
GaussianModel}\label{train-the-gaussianmodel}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}74}]:} \PY{c+c1}{\PYZsh{} Reshape images to be compatible with GaussianModel dimesions}
         \PY{c+c1}{\PYZsh{} Number of images x Resize dimensions (150, 150)}
         
         \PY{n}{images\PYZus{}grey\PYZus{}reshaped} \PY{o}{=} \PY{n}{images\PYZus{}grey}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}
             \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}\PY{p}{,}
             \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{T}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shape of images\PYZus{}grey\PYZus{}reshaped: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Create a boolean mask \PYZam{} train the model`}
         \PY{c+c1}{\PYZsh{} Resize dimensions (150, 150)}
         
         \PY{n}{bool\PYZus{}mask} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{images\PYZus{}grey}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}\PY{p}{)} \PY{o}{==} \PY{l+m+mi}{1}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shape of bool\PYZus{}mask: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{bool\PYZus{}mask}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Fit the GaussianModel}
         \PY{n}{leaf\PYZus{}pca} \PY{o}{=} \PY{n}{GaussianModel}\PY{p}{(}
             \PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{,} \PY{n}{numBasisFunctions}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{objectPixels}\PY{o}{=}\PY{n}{bool\PYZus{}mask}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GaussianModel fitted on grey images.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Shape of images\_grey\_reshaped:  (4750, 22500)
Shape of bool\_mask:  (150, 150)
GaussianModel fitted on grey images.

    \end{Verbatim}

    \hypertarget{principal-components-analysis}{%
\paragraph{3.3.2.3 Principal Components
Analysis}\label{principal-components-analysis}}

    Now let's have a look at the \texttt{main\ variance} directions or
\texttt{vectors} which also are known as \texttt{Principal\ Components}.
The most varying directions explain the best
\texttt{discriminatory\ features} for the Seedlings classification task
in decreasing order. Each image can be thought as
\texttt{combination\ of\ different\ vectors} in a
\texttt{high\ dimensional\ space}.

    \textbf{Visualize the most Variance Directions}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}76}]:} \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font.size}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{10}
         \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{)}
         
         \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowVarianceDirections}\PY{p}{(}\PY{n}{numDirectionsToShow}\PY{o}{=}\PY{l+m+mi}{16}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_86_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We can see some interesting shapes arising from the data especially in
the first and second row.

But let's first look at some original images and how the low dimensional
PCA model reconstructs them.

    \textbf{Visualize images \& their Reconstructions}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}78}]:} \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowReconstructions}\PY{p}{(}\PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{,} \PY{n}{numReconstructions}\PY{o}{=}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_89_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_89_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Looking at the absolute difference between original and reconstructed
images, we notice the blurred leaf edges reconstruction using only 100
basis functions in GaussianModel.

    \textbf{Show Model Variations around the Mean Image}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}80}]:} \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowModelVariations}\PY{p}{(}\PY{n}{numVariations}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_92_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \textbf{Details about above plots}

\begin{itemize}
\tightlist
\item
  The upper most row contains the data distributions of each eigenvector
  (i.e.~the histogram along that ``direction'')
\item
  The second row contains what we already saw in a previous plot, what
  we called the variance directions.
\item
  The forth row contains the median image of leafs. notice that this row
  is identical for all eigenvectors
\item
  The third row holds the 2nd percentile images of each eigenvector.
  It's easier to think of this as the median image minus the eigenvector
  image multiplied by some constant.
\end{itemize}

\begin{quote}
The constant is chosen to show the varying degree of influence of this
specific eigenvector on the ``average'' image, so we can visualize what
type of variation this particular eigenvector tends to capture. The 2nd
percentile will subtract a relatively large absolute value from the
median image, showing us what images look like when this coefficient is
highly negative. The 98th percentile would be just the opposite, showing
us what images look like when this coefficient is at the upper end of
the range. The 50th percentile would give us a ``middle of the road''
effect of this coefficient.
\end{quote}

\begin{center}\rule{0.5\linewidth}{\linethickness}\end{center}

This plot helps us visualize what a direction in this high dimensional
image space means.

For example:

\begin{itemize}
\tightlist
\item
  \textbf{The first eigenvector} (leftmost column), we can see that it
  \textbf{controls the difference between large radius leafs and small
  radius leafs}. i.e we can say that some of the variance along the
  change of leaf radius is explained by this component.
\item
  The \textbf{second eigenvector} (second column from the left) controls
  the difference between an \textbf{upright vetrically oriented leaf}
  and a \textbf{horizontally oriented leaf}.
\end{itemize}

    \textbf{Eigen Vector I}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}86}]:} \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font.size}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{6}
         \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}
         
         \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowSingleComponentVariation}\PY{p}{(}
             \PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{,} \PY{n}{listOfComponents}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_95_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Lets explain what we see:

\begin{itemize}
\tightlist
\item
  The first row shows the data distribution of the coefficients along
  this main variance direction. the red dots correspond to 1st, 20th,
  40th, 60th, 80th and 99th percentiles of this distribution.
\item
  The second row is like the columns were in the previous plot. for
  example, we can see here in this particular case a gradual increase in
  leaf size from left to right.
\item
  The bottom 4 rows at each column hold real leaf images that have the
  first PCA coefficient be at the value of the corresponding percentile
  of that column. for example, the left most 4 bottom pictures are leafs
  with a PC1 coefficient to be approximately -1.6 and the right most 4
  bottom pictures are leafs with a PC1 coefficient to be approximately
  2.7
\end{itemize}

By examining the the leafs that have different coefficients \textbf{we
can see what this component coefficient represents}. from the point of
view of this particular component, the leaf images in the same column
are very similar. we can therefore see what this particular feature
``thinks'' about similar leafs.

In this particular case we can see that it's about \textbf{leaf size}
since we see \textbf{a gradual increase in leaf size from left to
right}.

    \textbf{Eigen Vector II}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}87}]:} \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font.size}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{6}
         \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}
         
         \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowSingleComponentVariation}\PY{p}{(}
             \PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{,} \PY{n}{listOfComponents}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_98_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Here we can see that the second principal component is about explaining
the difference between vertical and horizontal leafs.

    \textbf{PCA \& t-SNE Visualization}

    Let's visualize seedlings leaves using \texttt{scatter\ plot} as we have
some understanding about the eigen vectors \& their distributions.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Using the \textbf{first two principal component coeffients}.
\item
  Using \textbf{2D approximation with t-SNE}.
\end{enumerate}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}93}]:} \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{ShowDataScatterPlotsWithTSNE}\PY{p}{(}
             \PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{,} \PY{n}{labels\PYZus{}grey\PYZus{}ids}\PY{p}{,} \PY{n}{tSNE\PYZus{}perplexity}\PY{o}{=}\PY{l+m+mf}{10.0}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_102_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Similar leaves should be clustered in nearby regions.

    \hypertarget{fit-models-on-different-numbers-of-pca}{%
\paragraph{3.3.2.4 Fit models on different numbers of
PCA}\label{fit-models-on-different-numbers-of-pca}}

    Now let's see how the classifiation \texttt{accuracy} changes across
different models after \texttt{varying} number of
\texttt{Principal\ Components}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}97}]:} \PY{c+c1}{\PYZsh{} Plot CV classification accuracy as function of num components used for 3 very different type of classifiers}
         
         \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{font.size}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{12}
         \PY{n}{matplotlib}\PY{o}{.}\PY{n}{rcParams}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{figure.figsize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}
         
         \PY{n}{X\PYZus{}PCA} \PY{o}{=} \PY{n}{leaf\PYZus{}pca}\PY{o}{.}\PY{n}{RepresentUsingModel}\PY{p}{(}\PY{n}{images\PYZus{}grey\PYZus{}reshaped}\PY{p}{)}
         
         \PY{n}{X\PYZus{}PCA\PYZus{}train} \PY{o}{=} \PY{n}{X\PYZus{}PCA}
         \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{labels\PYZus{}grey\PYZus{}ids}
         
         \PY{n}{numPCsToUse} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{32}\PY{p}{,} \PY{l+m+mi}{64}\PY{p}{]}
         
         \PY{n}{logReg} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{C}\PY{o}{=}\PY{l+m+mf}{10.0}\PY{p}{)}
         \PY{n}{kNN} \PY{o}{=} \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{n}{n\PYZus{}neighbors}\PY{o}{=}\PY{l+m+mi}{7}\PY{p}{)}
         \PY{n}{RF} \PY{o}{=} \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{n}{n\PYZus{}estimators}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{)}
         
         \PY{n}{logRegMeanAccuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{kNN\PYZus{}MeanAccuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{RF\PYZus{}MeanAccuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{logRegAccuracyStd} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{kNN\PYZus{}AccuracyStd} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{n}{RF\PYZus{}AccuracyStd} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         
         \PY{k}{for} \PY{n}{numPCs} \PY{o+ow}{in} \PY{n}{numPCsToUse}\PY{p}{:}
         
             \PY{n}{stratifiedCV} \PY{o}{=} \PY{n}{StratifiedKFold}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{21}\PY{p}{)}
             \PY{n}{logRegAccuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{kNN\PYZus{}Accuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             \PY{n}{RF\PYZus{}Accuracy} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         
             \PY{k}{for} \PY{n}{trainInds}\PY{p}{,} \PY{n}{validInds} \PY{o+ow}{in} \PY{n}{stratifiedCV}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{X\PYZus{}PCA\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{:}
                 \PY{n}{X\PYZus{}train\PYZus{}cv} \PY{o}{=} \PY{n}{X\PYZus{}PCA\PYZus{}train}\PY{p}{[}\PY{n}{trainInds}\PY{p}{,} \PY{p}{:}\PY{n}{numPCs}\PY{p}{]}
                 \PY{n}{X\PYZus{}valid\PYZus{}cv} \PY{o}{=} \PY{n}{X\PYZus{}PCA\PYZus{}train}\PY{p}{[}\PY{n}{validInds}\PY{p}{,} \PY{p}{:}\PY{n}{numPCs}\PY{p}{]}
         
                 \PY{n}{y\PYZus{}train\PYZus{}cv} \PY{o}{=} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{trainInds}\PY{p}{]}
                 \PY{n}{y\PYZus{}valid\PYZus{}cv} \PY{o}{=} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{validInds}\PY{p}{]}
         
                 \PY{n}{logReg}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}cv}\PY{p}{)}
                 \PY{n}{kNN}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}cv}\PY{p}{)}
                 \PY{n}{RF}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train\PYZus{}cv}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}cv}\PY{p}{)}
         
                 \PY{n}{logRegAccuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}
                     \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}valid\PYZus{}cv}\PY{p}{,} \PY{n}{logReg}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}valid\PYZus{}cv}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 \PY{n}{kNN\PYZus{}Accuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}
                     \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}valid\PYZus{}cv}\PY{p}{,} \PY{n}{kNN}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}valid\PYZus{}cv}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                 \PY{n}{RF\PYZus{}Accuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}valid\PYZus{}cv}\PY{p}{,} \PY{n}{RF}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}valid\PYZus{}cv}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{logRegMeanAccuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{logRegAccuracy}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{logRegAccuracyStd}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{logRegAccuracy}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{kNN\PYZus{}MeanAccuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{kNN\PYZus{}Accuracy}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{kNN\PYZus{}AccuracyStd}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{kNN\PYZus{}Accuracy}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{RF\PYZus{}MeanAccuracy}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{RF\PYZus{}Accuracy}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{)}
             \PY{n}{RF\PYZus{}AccuracyStd}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{RF\PYZus{}Accuracy}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{numPCsToUse}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{logRegMeanAccuracy}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{logRegAccuracyStd}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{numPCsToUse}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{kNN\PYZus{}MeanAccuracy}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{kNN\PYZus{}AccuracyStd}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{errorbar}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{n}{numPCsToUse}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{RF\PYZus{}MeanAccuracy}\PY{p}{,} \PY{n}{yerr}\PY{o}{=}\PY{n}{RF\PYZus{}AccuracyStd}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlim}\PY{p}{(}\PY{n+nb}{min}\PY{p}{(}\PY{n}{numPCsToUse}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{numPCsToUse}\PY{p}{)} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}
             \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Logistic Regression}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k Nearest Neighbor}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Random Forest}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{num PCA Components}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Validation Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Accuracy as function of num PCs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}97}]:} Text(0.5,1,'Accuracy as function of num PCs')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_106_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Overall, it's evident that all the classifiers achieve similar
performance approximately.

But it's interesting to note different behaviors of the classifiers as a
function of number of Principal Components used.

    \hypertarget{t-sne-visualization}{%
\subsubsection{3.3.3 t-SNE Visualization}\label{t-sne-visualization}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}72}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images Shape}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Before Scaling:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Let\PYZsq{}s scale images using StandardScaler}
         
         \PY{n}{images\PYZus{}scaled} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{images}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{After Scaling:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}scaled}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Labels Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Images Shape
Before Scaling: (4750, 2025)
After Scaling: (4750, 2025)

Labels Shape: (4750,)

    \end{Verbatim}

    Now let's do PCA using the scaled images and reduce the
\texttt{dimesions} from \texttt{2025} to \texttt{180}.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{c+c1}{\PYZsh{} PCA Analysis}
         
         \PY{n}{pca} \PY{o}{=} \PY{n}{PCA}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{180}\PY{p}{)}
         \PY{n}{pca\PYZus{}result} \PY{o}{=} \PY{n}{pca}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{images\PYZus{}scaled}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{pca\PYZus{}result}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}22}]:} (4750, 180)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{c+c1}{\PYZsh{} TSNE Analysis}
         
         \PY{n}{tsne} \PY{o}{=} \PY{n}{TSNE}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{perplexity}\PY{o}{=}\PY{l+m+mf}{40.0}\PY{p}{)}
         \PY{n}{tsne\PYZus{}result} \PY{o}{=} \PY{n}{tsne}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{pca\PYZus{}result}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}39}]:} \PY{c+c1}{\PYZsh{} Visualize seedlings clusters in a scatter plot}
         
         \PY{n}{visualize\PYZus{}scatter}\PY{p}{(}\PY{n}{tsne\PYZus{}result}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_114_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{c+c1}{\PYZsh{} Let\PYZsq{}s scale images using StandardScaler}
         
         \PY{n}{tsne\PYZus{}result\PYZus{}scaled} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{tsne\PYZus{}result}\PY{p}{)}
         \PY{n}{tsne\PYZus{}result\PYZus{}scaled}\PY{o}{.}\PY{n}{shape}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}24}]:} (4750, 2)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{c+c1}{\PYZsh{} Visualize seedlings clusters in a scatter plot}
         
         \PY{n}{visualize\PYZus{}scatter}\PY{p}{(}\PY{n}{tsne\PYZus{}result\PYZus{}scaled}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_116_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{c+c1}{\PYZsh{} Visualize seedlings clusters in a scatter plot along with images}
         
         \PY{n}{visualize\PYZus{}scatter\PYZus{}with\PYZus{}images}\PY{p}{(}
             \PY{n}{tsne\PYZus{}result\PYZus{}scaled}\PY{p}{,}
             \PY{n}{images}\PY{o}{=}\PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{p}{(}\PY{l+m+mi}{45}\PY{p}{,} \PY{l+m+mi}{45}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{images}\PY{p}{]}\PY{p}{,}
             \PY{n}{image\PYZus{}zoom}\PY{o}{=}\PY{l+m+mf}{0.7}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_117_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{d-t-sne}{%
\subsubsection{3D t-SNE}\label{d-t-sne}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}27}]:} \PY{c+c1}{\PYZsh{} TSNE Analysis}
         
         \PY{n}{tsne} \PY{o}{=} \PY{n}{TSNE}\PY{p}{(}\PY{n}{n\PYZus{}components}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
         \PY{n}{tsne\PYZus{}result} \PY{o}{=} \PY{n}{tsne}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{pca\PYZus{}result}\PY{p}{)}
         \PY{n}{tsne\PYZus{}result\PYZus{}scaled} \PY{o}{=} \PY{n}{StandardScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{tsne\PYZus{}result}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{c+c1}{\PYZsh{} Visualize seedlings clusters in a 3D scatter plot}
         
         \PY{n}{visualize\PYZus{}scatter\PYZus{}3D}\PY{p}{(}\PY{n}{tsne\PYZus{}result\PYZus{}scaled}\PY{p}{,} \PY{n}{label\PYZus{}ids}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_120_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{c+c1}{\PYZsh{} Visualize seedlings clusters in a 3D scatter plot with animation GIF}
        
        \PY{k+kn}{import} \PY{n+nn}{io}
        \PY{k+kn}{import} \PY{n+nn}{base64}
        \PY{k+kn}{from} \PY{n+nn}{IPython}\PY{n+nn}{.}\PY{n+nn}{display} \PY{k}{import} \PY{n}{HTML}
        
        \PY{n}{video} \PY{o}{=} \PY{n}{io}\PY{o}{.}\PY{n}{open}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./visualization}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{seedlings\PYZus{}3D.gif}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                        \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r+b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{read}\PY{p}{(}\PY{p}{)}
        \PY{n}{HTML}\PY{p}{(}\PY{n}{data}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}\PYZsq{}\PYZsq{}}\PY{l+s+s1}{\PYZlt{}img src=}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{data:image/gif;base64,}\PY{l+s+si}{\PYZob{}0\PYZcb{}}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{ type=}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{gif}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{ /\PYZgt{}}\PY{l+s+s1}{\PYZsq{}\PYZsq{}\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
            \PY{n}{base64}\PY{o}{.}\PY{n}{b64encode}\PY{p}{(}\PY{n}{video}\PY{p}{)}\PY{o}{.}\PY{n}{decode}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ascii}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \hypertarget{normalization}{%
\subsection{3.4 Normalization}\label{normalization}}

    Now we can \texttt{normalize} an image RGB color space values raning
from {[}0\ldots{}255{]} to {[}0\ldots{}1{]}. It will
\texttt{loose\ some\ discrimantory\ features} but CNN being compute
intensive will train faster.

    \begin{Shaded}
\begin{Highlighting}[]
\NormalTok{image_norm }\OperatorTok{=}\NormalTok{ image}\OperatorTok{/}\DecValTok{255}
\end{Highlighting}
\end{Shaded}

    It seems that there isn't a big improvements from normalization.

    \hypertarget{modelling}{%
\section{4. Modelling}\label{modelling}}

    Now we are ready to train a model and predict. There are loads of
predictive modelling algorithms to choose from. We must understand the
type of problem and solution requirements to narrow down to a select few
baseline models which we can evaluate iteratively.

Our problem falls in the supervised classification category. We want to
identify the relationship between a seedling class and an input image.

With above two criteria - Supervised Learning plus Image Classification,
we can narrow down our choice of models to a few which are as follow:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  CNN
\item
  Transfer Learning using Xception, VGG, ImageNet
\item
  XGB using only countour features
\end{enumerate}

    \hypertarget{cnn}{%
\subsection{4.1 CNN}\label{cnn}}

    The convolutional Neural Networks has the following strutctures.

\begin{itemize}
\tightlist
\item
  Input eg. (51x51x3)
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  First 64 filters
\item
  Second 64 filters
\item
  Third 128 filters
\item
  Fourth 128 filters
\item
  Fifth 256 filters
\item
  Sixth 256 filters
\item
  Seventh 256 filters
\item
  Eigth Dense layer 128 neurons
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Output 12 Seedling classes
\end{itemize}

Each pair of convolution layers have a max pooling layer and uses batch
normalization to reduce overfitting. It also takes advantage of Leaky
ReLUs. In dense layers, we will use dropout to reduce overfitting.

In the end, the fully-connected layers will be used for classification
which the outputs probability distribution for each of 12 Seedling
classes.

\begin{quote}
Batch normalization is a technique to provide any layer in a neural
network with inputs that are zero mean/unit variance. It is used to
normalize the input layer by adjusting and scaling the activations.
\end{quote}

\begin{quote}
Leaky ReLUs allow a small, non-zero gradient when the unit is not
active.
\end{quote}

\begin{quote}
Parametric ReLUs take this idea further by making the coefficient of
leakage into a parameter that is learned along with the other neural
network parameters.
\end{quote}

    \hypertarget{fixed-variables-initialization}{%
\subsubsection{4.1.1 Fixed Variables
Initialization}\label{fixed-variables-initialization}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{BATCH\PYZus{}SIZE} \PY{o}{=} \PY{l+m+mi}{16}
        \PY{n}{EPOCHS} \PY{o}{=} \PY{l+m+mi}{16}
        \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
        
        \PY{c+c1}{\PYZsh{} Same as label\PYZus{}to\PYZus{}id\PYZus{}dict}
        
        \PY{n}{CLASS} \PY{o}{=} \PY{p}{\PYZob{}}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{0}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Charlock}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{1}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cleavers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{2}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common Chickweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{3}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common wheat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{4}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fat Hen}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{5}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loose Silky\PYZhy{}bent}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{6}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Maize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{7}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scentless Mayweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{8}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shepherds Purse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{9}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{10}\PY{p}{,}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sugar beet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{l+m+mi}{11}
        \PY{p}{\PYZcb{}}
        
        \PY{c+c1}{\PYZsh{} Same as id\PYZus{}to\PYZus{}label\PYZus{}dict}
        
        \PY{n}{INV\PYZus{}CLASS} \PY{o}{=} \PY{p}{\PYZob{}}
            \PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Black\PYZhy{}grass}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Charlock}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{2}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cleavers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{3}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common Chickweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{4}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Common wheat}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{5}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Fat Hen}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{6}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loose Silky\PYZhy{}bent}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{7}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Maize}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{8}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Scentless Mayweed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{9}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Shepherds Purse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{10}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Small\PYZhy{}flowered Cranesbill}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
            \PY{l+m+mi}{11}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sugar beet}\PY{l+s+s1}{\PYZsq{}}
        \PY{p}{\PYZcb{}}
\end{Verbatim}


    \hypertarget{define-model-network}{%
\subsubsection{4.1.2 Define Model Network}\label{define-model-network}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{c+c1}{\PYZsh{} Define Dense layers}
        
        
        \PY{k}{def} \PY{n+nf}{dense\PYZus{}layer}\PY{p}{(}\PY{n}{inputs}\PY{p}{,} \PY{n}{neurons}\PY{p}{,} \PY{n}{activation}\PY{p}{,} \PY{n}{drop\PYZus{}rate}\PY{o}{=}\PY{l+m+mf}{0.}\PY{p}{)}\PY{p}{:}
            \PY{n}{dropout} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{n}{drop\PYZus{}rate}\PY{p}{)}\PY{p}{(}\PY{n}{inputs}\PY{p}{)}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{neurons}\PY{p}{)}\PY{p}{(}\PY{n}{dropout}\PY{p}{)}
            \PY{n}{fc\PYZus{}norm} \PY{o}{=} \PY{n}{BatchNormalization}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
            \PY{n}{outputs} \PY{o}{=} \PY{n}{Activation}\PY{p}{(}\PY{n}{activation}\PY{o}{=}\PY{n}{activation}\PY{p}{)}\PY{p}{(}\PY{n}{fc\PYZus{}norm}\PY{p}{)}
            \PY{k}{return} \PY{n}{outputs}
        
        
        \PY{c+c1}{\PYZsh{} Define Convolution layers}
        
        
        \PY{k}{def} \PY{n+nf}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{feature\PYZus{}batch}\PY{p}{,}
                       \PY{n}{feature\PYZus{}map}\PY{p}{,}
                       \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,}
                       \PY{n}{strides}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,}
                       \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{padding}\PY{p}{:}
                \PY{n}{processed\PYZus{}feature\PYZus{}batch} \PY{o}{=} \PY{n}{ZeroPadding2D}\PY{p}{(}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{(}\PY{n}{feature\PYZus{}batch}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n}{processed\PYZus{}feature\PYZus{}batch} \PY{o}{=} \PY{n}{feature\PYZus{}batch}
        
            \PY{n}{conv} \PY{o}{=} \PY{n}{Conv2D}\PY{p}{(}
                \PY{n}{filters}\PY{o}{=}\PY{n}{feature\PYZus{}map}\PY{p}{,} \PY{n}{kernel\PYZus{}size}\PY{o}{=}\PY{n}{kernel\PYZus{}size}\PY{p}{,}
                \PY{n}{strides}\PY{o}{=}\PY{n}{strides}\PY{p}{)}\PY{p}{(}\PY{n}{processed\PYZus{}feature\PYZus{}batch}\PY{p}{)}
            \PY{n}{conv\PYZus{}norm} \PY{o}{=} \PY{n}{BatchNormalization}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{(}\PY{n}{conv}\PY{p}{)}
            \PY{n}{outputs} \PY{o}{=} \PY{n}{LeakyReLU}\PY{p}{(}\PY{l+m+mi}{1} \PY{o}{/} \PY{l+m+mi}{10}\PY{p}{)}\PY{p}{(}\PY{n}{conv\PYZus{}norm}\PY{p}{)}
            \PY{k}{return} \PY{n}{outputs}
        
        
        \PY{c+c1}{\PYZsh{} Define Model Neural Network}
        
        
        \PY{k}{def} \PY{n+nf}{model\PYZus{}neural\PYZus{}network}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        
            \PY{n}{inputs} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{51}\PY{p}{,} \PY{l+m+mi}{51}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} First, Second layer}
            \PY{n}{conv1} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{inputs}\PY{p}{,} \PY{l+m+mi}{64}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{conv2} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{conv1}\PY{p}{,} \PY{l+m+mi}{64}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{pool1} \PY{o}{=} \PY{n}{MaxPooling2D}\PY{p}{(}\PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{strides}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{(}\PY{n}{conv2}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Third, Fourth layer}
            \PY{n}{conv3} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{pool1}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{conv4} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{conv3}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{pool2} \PY{o}{=} \PY{n}{MaxPooling2D}\PY{p}{(}\PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{strides}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{(}\PY{n}{conv4}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Sixth, Seventh, Ninth layer}
            \PY{n}{conv7} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{pool2}\PY{p}{,} \PY{l+m+mi}{256}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{conv8} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{conv7}\PY{p}{,} \PY{l+m+mi}{256}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{conv9} \PY{o}{=} \PY{n}{conv\PYZus{}layer}\PY{p}{(}\PY{n}{conv8}\PY{p}{,} \PY{l+m+mi}{256}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{n}{pool3} \PY{o}{=} \PY{n}{MaxPooling2D}\PY{p}{(}\PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{strides}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{(}\PY{n}{conv9}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Two Dense layers}
            \PY{n}{flattened} \PY{o}{=} \PY{n}{Flatten}\PY{p}{(}\PY{p}{)}\PY{p}{(}\PY{n}{pool3}\PY{p}{)}
            \PY{n}{fc\PYZus{}output} \PY{o}{=} \PY{n}{dense\PYZus{}layer}\PY{p}{(}\PY{n}{flattened}\PY{p}{,} \PY{l+m+mi}{128}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{tanh}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{outputs} \PY{o}{=} \PY{n}{dense\PYZus{}layer}\PY{p}{(}\PY{n}{fc\PYZus{}output}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{softmax}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{n}{model} \PY{o}{=} \PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{n}{inputs}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{n}{outputs}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} The first 50 epochs with Adam opt \PYZam{} then 30 epochs with SGD opt.}
        
            \PY{c+c1}{\PYZsh{}mypotim = Adam(lr=2 * 1e\PYZhy{}3, beta\PYZus{}1=0.9, beta\PYZus{}2=0.999, epsilon=1e\PYZhy{}08)}
            \PY{n}{mypotim} \PY{o}{=} \PY{n}{SGD}\PY{p}{(}\PY{n}{lr}\PY{o}{=}\PY{l+m+mi}{1} \PY{o}{*} \PY{l+m+mf}{1e\PYZhy{}1}\PY{p}{,} \PY{n}{momentum}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{nesterov}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{compile}\PY{p}{(}
                \PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{categorical\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                \PY{n}{optimizer}\PY{o}{=}\PY{n}{mypotim}\PY{p}{,}
                \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
        
            \PY{k}{return} \PY{n}{model}
        
        
        \PY{c+c1}{\PYZsh{} Model Callbacks}
        
        
        \PY{k}{def} \PY{n+nf}{get\PYZus{}callbacks}\PY{p}{(}\PY{n}{checkpoint\PYZus{}path}\PY{p}{,} \PY{n}{patience}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{:}
        
            \PY{k}{if} \PY{o+ow}{not} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./logs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
                \PY{n}{os}\PY{o}{.}\PY{n}{makedirs}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./logs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{n}{lr\PYZus{}reduced} \PY{o}{=} \PY{n}{ReduceLROnPlateau}\PY{p}{(}
                \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                \PY{n}{factor}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,}
                \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}5}\PY{p}{,}
                \PY{n}{patience}\PY{o}{=}\PY{n}{patience}\PY{p}{,}
                \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{checkpoint} \PY{o}{=} \PY{n}{ModelCheckpoint}\PY{p}{(}
                \PY{n}{checkpoint\PYZus{}path}\PY{p}{,} \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{save\PYZus{}best\PYZus{}only}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{c+c1}{\PYZsh{}early\PYZus{}stop = EarlyStopping(monitor=\PYZsq{}val\PYZus{}acc\PYZsq{}, patience=patience, mode=\PYZsq{}max\PYZsq{})}
            \PY{n}{tensorboard} \PY{o}{=} \PY{n}{TensorBoard}\PY{p}{(}
                \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./logs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                \PY{n}{histogram\PYZus{}freq}\PY{o}{=}\PY{l+m+mi}{2000}\PY{p}{,}
                \PY{n}{write\PYZus{}graph}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                \PY{n}{write\PYZus{}images}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
            \PY{k}{return} \PY{p}{[}\PY{n}{lr\PYZus{}reduced}\PY{p}{,} \PY{n}{checkpoint}\PY{p}{,} \PY{n}{tensorboard}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{n}{train\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{5}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}8}]:} ['Sugar beet', 'Sugar beet', 'Sugar beet', 'Sugar beet', 'Sugar beet']
\end{Verbatim}
            
    \hypertarget{training-cnn-model}{%
\subsubsection{4.1.3 Training CNN Model}\label{training-cnn-model}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{c+c1}{\PYZsh{} Define Train method}
        
        
        \PY{k}{def} \PY{n+nf}{train}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{target}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{:}
        
            \PY{c+c1}{\PYZsh{} Setting checkpoint \PYZam{} early stopping}
            \PY{c+c1}{\PYZsh{} Load the last best checkpoint files}
            \PY{n}{callbacks\PYZus{}list} \PY{o}{=} \PY{n}{get\PYZus{}callbacks}\PY{p}{(}
                \PY{n}{checkpoint\PYZus{}path}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}weight\PYZus{}SGD.}\PY{l+s+si}{\PYZob{}epoch:02d\PYZcb{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+si}{\PYZob{}val\PYZus{}acc:.4f\PYZcb{}}\PY{l+s+s1}{.hdf5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                \PY{n}{patience}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Initialize the model neural networks architecture}
            \PY{n}{model} \PY{o}{=} \PY{n}{model\PYZus{}neural\PYZus{}network}\PY{p}{(}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Load network weights}
            \PY{k}{if} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading weights from previous run...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
                \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
            \PY{k}{else}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Weights not loaded.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Split the data in train \PYZam{} validation set}
            \PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
                \PY{n}{img}\PY{p}{,}
                \PY{n}{target}\PY{p}{,}
                \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                \PY{n}{train\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,}
                \PY{n}{stratify}\PY{o}{=}\PY{n}{target}\PY{p}{,}
                \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} To avoide overfitting, we need to create an image generator which will randomly rotate, zoom, shift and flip image}
            \PY{c+c1}{\PYZsh{} during the fitting of the model.}
            \PY{c+c1}{\PYZsh{} Define an ImageDataGenerator}
            \PY{n}{image\PYZus{}gen} \PY{o}{=} \PY{n}{ImageDataGenerator}\PY{p}{(}
                \PY{n}{rotation\PYZus{}range}\PY{o}{=}\PY{l+m+mf}{360.}\PY{p}{,}
                \PY{n}{width\PYZus{}shift\PYZus{}range}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,}
                \PY{n}{height\PYZus{}shift\PYZus{}range}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,}
                \PY{n}{zoom\PYZus{}range}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,}
                \PY{n}{horizontal\PYZus{}flip}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                \PY{n}{vertical\PYZus{}flip}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Fitting the model with the image generator \PYZam{} others}
            \PY{n}{model}\PY{o}{.}\PY{n}{fit\PYZus{}generator}\PY{p}{(}
                \PY{n}{image\PYZus{}gen}\PY{o}{.}\PY{n}{flow}\PY{p}{(}
                    \PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{n}{BATCH\PYZus{}SIZE}\PY{p}{)}\PY{p}{,}
                \PY{n}{steps\PYZus{}per\PYZus{}epoch}\PY{o}{=}\PY{l+m+mi}{10} \PY{o}{*} \PY{n+nb}{len}\PY{p}{(}\PY{n}{x\PYZus{}train}\PY{p}{)} \PY{o}{/} \PY{n}{BATCH\PYZus{}SIZE}\PY{p}{,}
                \PY{n}{epochs}\PY{o}{=}\PY{n}{EPOCHS}\PY{p}{,}
                \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}
                \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                \PY{n}{validation\PYZus{}data}\PY{o}{=}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{)}\PY{p}{,}
                \PY{n}{callbacks}\PY{o}{=}\PY{n}{callbacks\PYZus{}list}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} Training the model}
        
        
        \PY{k}{def} \PY{n+nf}{train\PYZus{}main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        
            \PY{k}{try}\PY{p}{:}
                \PY{n}{train\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                    \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                    \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading train \PYZam{} test dict...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train \PYZam{} Test Dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{train\PYZus{}dict}\PY{p}{)} \PY{o+ow}{and} \PY{p}{(}\PY{o+ow}{not} \PY{n}{test\PYZus{}dict}\PY{p}{)}\PY{p}{:}
                \PY{n}{train\PYZus{}dict}\PY{p}{,} \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{reader}\PY{p}{(}\PY{p}{)}
                \PY{c+c1}{\PYZsh{} Dumping dicts}
                \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{train\PYZus{}dict}\PY{p}{,}
                            \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{test\PYZus{}dict}\PY{p}{,}
                            \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        
            \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
            \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        
            \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}weight\PYZus{}SGD.05\PYZhy{}0.9526.hdf5}\PY{l+s+s1}{\PYZsq{}}
            \PY{n}{train}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
        
        \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
            \PY{n}{train\PYZus{}main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading train \& test dict{\ldots}
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
input\_1 (InputLayer)         (None, 51, 51, 3)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_1 (Conv2D)            (None, 49, 49, 64)        1792      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_1 (Batch (None, 49, 49, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_1 (LeakyReLU)    (None, 49, 49, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_2 (Conv2D)            (None, 47, 47, 64)        36928     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_2 (Batch (None, 47, 47, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_2 (LeakyReLU)    (None, 47, 47, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_1 (MaxPooling2 (None, 23, 23, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_3 (Conv2D)            (None, 21, 21, 128)       73856     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_3 (Batch (None, 21, 21, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_3 (LeakyReLU)    (None, 21, 21, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_4 (Conv2D)            (None, 19, 19, 128)       147584    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_4 (Batch (None, 19, 19, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_4 (LeakyReLU)    (None, 19, 19, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_2 (MaxPooling2 (None, 9, 9, 128)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_5 (Conv2D)            (None, 7, 7, 256)         295168    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_5 (Batch (None, 7, 7, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_5 (LeakyReLU)    (None, 7, 7, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_6 (Conv2D)            (None, 5, 5, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_6 (Batch (None, 5, 5, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_6 (LeakyReLU)    (None, 5, 5, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_7 (Conv2D)            (None, 3, 3, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_7 (Batch (None, 3, 3, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_7 (LeakyReLU)    (None, 3, 3, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_3 (MaxPooling2 (None, 1, 1, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
flatten\_1 (Flatten)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_1 (Dropout)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_1 (Dense)              (None, 128)               32896     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_8 (Batch (None, 128)               512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_1 (Activation)    (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_2 (Dropout)          (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_2 (Dense)              (None, 12)                1548      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_9 (Batch (None, 12)                48        
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_2 (Activation)    (None, 12)                0         
=================================================================
Total params: 1,775,100
Trainable params: 1,772,516
Non-trainable params: 2,584
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Loading weights from previous run{\ldots} model\_weight\_SGD.05-0.9526.hdf5
Epoch 1/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1436 - acc: 0.9488Epoch 00001: val\_acc improved from -inf to 0.94842, saving model to ./checkpoint/model\_weight\_SGD.01-0.9484.hdf5
2375/2375 [==============================] - 1342s 565ms/step - loss: 0.1436 - acc: 0.9488 - val\_loss: 0.1180 - val\_acc: 0.9484
Epoch 2/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1434 - acc: 0.9504Epoch 00002: val\_acc did not improve
2375/2375 [==============================] - 1255s 528ms/step - loss: 0.1434 - acc: 0.9504 - val\_loss: 0.1454 - val\_acc: 0.9432
Epoch 3/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1360 - acc: 0.9506Epoch 00003: val\_acc improved from 0.94842 to 0.96316, saving model to ./checkpoint/model\_weight\_SGD.03-0.9632.hdf5
2375/2375 [==============================] - 1296s 546ms/step - loss: 0.1360 - acc: 0.9506 - val\_loss: 0.0954 - val\_acc: 0.9632
Epoch 4/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1357 - acc: 0.9525Epoch 00004: val\_acc did not improve
2375/2375 [==============================] - 1299s 547ms/step - loss: 0.1357 - acc: 0.9525 - val\_loss: 0.2628 - val\_acc: 0.9000
Epoch 5/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1298 - acc: 0.9533Epoch 00007: val\_acc did not improve
2375/2375 [==============================] - 1327s 559ms/step - loss: 0.1298 - acc: 0.9533 - val\_loss: 0.2141 - val\_acc: 0.9200
Epoch 8/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1219 - acc: 0.9559Epoch 00010: val\_acc did not improve
2375/2375 [==============================] - 1330s 560ms/step - loss: 0.1219 - acc: 0.9559 - val\_loss: 0.2393 - val\_acc: 0.9105
Epoch 11/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.1209 - acc: 0.9567
Epoch 00011: reducing learning rate to 0.010000000149011612.
Epoch 00011: val\_acc did not improve
2375/2375 [==============================] - 1331s 560ms/step - loss: 0.1209 - acc: 0.9567 - val\_loss: 0.0733 - val\_acc: 0.9737
Epoch 12/16
2374/2375 [============================>.] - ETA: 0s - loss: 0.0948 - acc: 0.9660Epoch 00012: val\_acc improved from 0.97368 to 0.98316, saving model to ./checkpoint/model\_weight\_SGD.12-0.9832.hdf5
2375/2375 [==============================] - 1326s 558ms/step - loss: 0.0948 - acc: 0.9660 - val\_loss: 0.0594 - val\_acc: 0.9832
Epoch 13/16
1268/2375 [===============>{\ldots}] - ETA: 10:12 - loss: 0.0874 - acc: 0.9678
    \end{Verbatim}

    \hypertarget{evaluate-model}{%
\subsubsection{4.1.4 Evaluate Model}\label{evaluate-model}}

    \hypertarget{on-validation-set}{%
\paragraph{On Validation Set}\label{on-validation-set}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{c+c1}{\PYZsh{} Define Test method}
         
         
         \PY{k}{def} \PY{n+nf}{test\PYZus{}valid}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{:}
         
             \PY{c+c1}{\PYZsh{} Initialize the model neural networks architecture \PYZam{} load weights}
             \PY{n}{model} \PY{o}{=} \PY{n}{model\PYZus{}neural\PYZus{}network}\PY{p}{(}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Evaluate on train and valid set}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Train Set accuracy ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{train\PYZus{}acc} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}
                 \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}train}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Set accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{acc} \PY{o}{*} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{acc} \PY{o+ow}{in} \PY{n}{train\PYZus{}acc}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Valid Set accuracy ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{valid\PYZus{}acc} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}
                 \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}valid}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Valid Set accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{acc} \PY{o}{*} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{acc} \PY{o+ow}{in} \PY{n}{valid\PYZus{}acc}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Confusion Matrix \PYZam{} Classification Report ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} Predictions on the valid set}
             \PY{n}{prob} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{predictions} \PY{o}{=} \PY{n}{prob}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} True class label}
             \PY{n}{true} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}valid}\PY{p}{]}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Confusion matrix on the valid set.}
             \PY{n}{con\PYZus{}matrix} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{true}\PY{p}{,} \PY{n}{predictions}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Confusion matrix of the Seedlings Valid set}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{display}\PY{p}{(}
                 \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}
                     \PY{n}{con\PYZus{}matrix}\PY{p}{,} \PY{n}{columns}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Plot the confusion matrix}
             \PY{n}{plot\PYZus{}confusion\PYZus{}matrix}\PY{p}{(}
                 \PY{n}{con\PYZus{}matrix}\PY{p}{,}
                 \PY{n}{target\PYZus{}names}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                 \PY{n}{plt\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Seedlings\PYZus{}Con\PYZus{}Matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{n}{rootdir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{n}{save\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{save/con\PYZus{}matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Confusion matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                 \PY{n}{cmap}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{cm}\PY{o}{.}\PY{n}{Blues}\PY{p}{,}
                 \PY{n}{normalize}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Classification Report}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}
                 \PY{n}{classification\PYZus{}report}\PY{p}{(}
                     \PY{n}{true}\PY{p}{,} \PY{n}{predictions}\PY{p}{,} \PY{n}{target\PYZus{}names}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
         
         \PY{c+c1}{\PYZsh{} Testing the model on validation set}
         
         
         \PY{k}{def} \PY{n+nf}{valid\PYZus{}main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
         
             \PY{k}{try}\PY{p}{:}
                 \PY{n}{train\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                     \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                     \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading train \PYZam{} test dict...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train \PYZam{} Test Dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{train\PYZus{}dict}\PY{p}{)} \PY{o+ow}{and} \PY{p}{(}\PY{o+ow}{not} \PY{n}{test\PYZus{}dict}\PY{p}{)}\PY{p}{:}
                 \PY{n}{train\PYZus{}dict}\PY{p}{,} \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{reader}\PY{p}{(}\PY{p}{)}
                 \PY{c+c1}{\PYZsh{} Dumping dicts}
                 \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{train\PYZus{}dict}\PY{p}{,}
                             \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{test\PYZus{}dict}\PY{p}{,}
                             \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{img} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             \PY{n}{label} \PY{o}{=} \PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
             \PY{n}{target} \PY{o}{=} \PY{n}{train\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         
             \PY{c+c1}{\PYZsh{} Split the data in train \PYZam{} validation set}
             \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
                 \PY{n}{img}\PY{p}{,}
                 \PY{n}{target}\PY{p}{,}
                 \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                 \PY{n}{train\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.7}\PY{p}{,}
                 \PY{n}{stratify}\PY{o}{=}\PY{n}{target}\PY{p}{,}
                 \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} best\PYZus{}model = input(\PYZsq{}Enter the name of best model saved in ./logs dir: \PYZsq{})}
             \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{model\PYZus{}weight\PYZus{}SGD.12\PYZhy{}0.9832.hdf5}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{test\PYZus{}valid}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
         
         
         \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
             \PY{n}{valid\PYZus{}main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading train \& test dict{\ldots}
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
input\_12 (InputLayer)        (None, 51, 51, 3)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_78 (Conv2D)           (None, 49, 49, 64)        1792      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_100 (Bat (None, 49, 49, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_78 (LeakyReLU)   (None, 49, 49, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_79 (Conv2D)           (None, 47, 47, 64)        36928     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_101 (Bat (None, 47, 47, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_79 (LeakyReLU)   (None, 47, 47, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_34 (MaxPooling (None, 23, 23, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_80 (Conv2D)           (None, 21, 21, 128)       73856     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_102 (Bat (None, 21, 21, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_80 (LeakyReLU)   (None, 21, 21, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_81 (Conv2D)           (None, 19, 19, 128)       147584    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_103 (Bat (None, 19, 19, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_81 (LeakyReLU)   (None, 19, 19, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_35 (MaxPooling (None, 9, 9, 128)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_82 (Conv2D)           (None, 7, 7, 256)         295168    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_104 (Bat (None, 7, 7, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_82 (LeakyReLU)   (None, 7, 7, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_83 (Conv2D)           (None, 5, 5, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_105 (Bat (None, 5, 5, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_83 (LeakyReLU)   (None, 5, 5, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_84 (Conv2D)           (None, 3, 3, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_106 (Bat (None, 3, 3, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_84 (LeakyReLU)   (None, 3, 3, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_36 (MaxPooling (None, 1, 1, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
flatten\_12 (Flatten)         (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_23 (Dropout)         (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_23 (Dense)             (None, 128)               32896     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_107 (Bat (None, 128)               512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_23 (Activation)   (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_24 (Dropout)         (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_24 (Dense)             (None, 12)                1548      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_108 (Bat (None, 12)                48        
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_24 (Activation)   (None, 12)                0         
=================================================================
Total params: 1,775,100
Trainable params: 1,772,516
Non-trainable params: 2,584
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Calculating Train Set accuracy {\ldots}
3325/3325 [==============================] - 37s 11ms/step
Train Set accuracy: [3.57, 98.89]\%

Calculating Valid Set accuracy {\ldots}
1425/1425 [==============================] - 16s 11ms/step
Valid Set accuracy: [4.12, 98.74]\%

Calculating Confusion Matrix \& Classification Report {\ldots}
1425/1425 [==============================] - 16s 11ms/step


Confusion matrix of the Seedlings Valid set



    \end{Verbatim}

    
    \begin{verbatim}
                           Sugar beet  Cleavers  Scentless Mayweed  Fat Hen  \
Sugar beet                         70         0                  0        0   
Cleavers                            0       117                  0        0   
Scentless Mayweed                   0         0                 85        0   
Fat Hen                             0         0                  0      183   
Common Chickweed                    0         0                  0        0   
Loose Silky-bent                    0         0                  0        0   
Black-grass                         7         0                  0        0   
Charlock                            0         0                  0        0   
Maize                               0         0                  0        0   
Small-flowered Cranesbill           0         0                  0        0   
Common wheat                        0         0                  0        0   
Shepherds Purse                     0         0                  0        1   

                           Common Chickweed  Loose Silky-bent  Black-grass  \
Sugar beet                                0                 0            9   
Cleavers                                  0                 0            0   
Scentless Mayweed                         0                 0            1   
Fat Hen                                   0                 0            0   
Common Chickweed                         66                 0            0   
Loose Silky-bent                          0               143            0   
Black-grass                               0                 0          189   
Charlock                                  0                 0            0   
Maize                                     0                 0            0   
Small-flowered Cranesbill                 0                 0            0   
Common wheat                              0                 0            0   
Shepherds Purse                           0                 0            0   

                           Charlock  Maize  Small-flowered Cranesbill  \
Sugar beet                        0      0                          0   
Cleavers                          0      0                          0   
Scentless Mayweed                 0      0                          0   
Fat Hen                           0      0                          0   
Common Chickweed                  0      0                          0   
Loose Silky-bent                  0      0                          0   
Black-grass                       0      0                          0   
Charlock                         66      0                          0   
Maize                             0    155                          0   
Small-flowered Cranesbill         0      0                         69   
Common wheat                      0      0                          0   
Shepherds Purse                   0      0                          0   

                           Common wheat  Shepherds Purse  
Sugar beet                            0                0  
Cleavers                              0                0  
Scentless Mayweed                     0                0  
Fat Hen                               0                0  
Common Chickweed                      0                0  
Loose Silky-bent                      0                0  
Black-grass                           0                0  
Charlock                              0                0  
Maize                                 0                0  
Small-flowered Cranesbill             0                0  
Common wheat                        149                0  
Shepherds Purse                       0              115  
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]


Saving Confusion Matrices in the ./save/con\_matrix directory

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_139_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]


Classification Report
                           precision    recall  f1-score   support

               Sugar beet       0.91      0.89      0.90        79
                 Cleavers       1.00      1.00      1.00       117
        Scentless Mayweed       1.00      0.99      0.99        86
                  Fat Hen       0.99      1.00      1.00       183
         Common Chickweed       1.00      1.00      1.00        66
         Loose Silky-bent       1.00      1.00      1.00       143
              Black-grass       0.95      0.96      0.96       196
                 Charlock       1.00      1.00      1.00        66
                    Maize       1.00      1.00      1.00       155
Small-flowered Cranesbill       1.00      1.00      1.00        69
             Common wheat       1.00      1.00      1.00       149
          Shepherds Purse       1.00      0.99      1.00       116

              avg / total       0.99      0.99      0.99      1425


    \end{Verbatim}

    \hypertarget{submission-on-test-set}{%
\paragraph{Submission on Test Set}\label{submission-on-test-set}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{c+c1}{\PYZsh{} Define Test method}
        
        
        \PY{k}{def} \PY{n+nf}{test}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{label}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{:}
        
            \PY{c+c1}{\PYZsh{} Initialize the model neural networks architecture \PYZam{} load weights}
            \PY{n}{model} \PY{o}{=} \PY{n}{model\PYZus{}neural\PYZus{}network}\PY{p}{(}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Predictions}
            \PY{n}{prob} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{pred} \PY{o}{=} \PY{n}{prob}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
        
            \PY{n}{submission\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}
                \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{file}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{label}\PY{p}{,}
                \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{species}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{p}{[}\PY{n}{INV\PYZus{}CLASS}\PY{p}{[}\PY{n}{p}\PY{p}{]} \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{pred}\PY{p}{]}
            \PY{p}{\PYZcb{}}\PY{p}{)}
            \PY{n}{submission\PYZus{}df}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}
                \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{submission.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{header}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} Testing the model}
        
        
        \PY{k}{def} \PY{n+nf}{test\PYZus{}main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        
            \PY{k}{try}\PY{p}{:}
                \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}
                    \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}dict.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading dict...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Test Dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{k}{if} \PY{o+ow}{not} \PY{n}{test\PYZus{}dict}\PY{p}{:}
                \PY{n}{\PYZus{}}\PY{p}{,} \PY{n}{test\PYZus{}dict} \PY{o}{=} \PY{n}{reader}\PY{p}{(}\PY{p}{)}
        
            \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{test\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
            \PY{n}{label} \PY{o}{=} \PY{n}{test\PYZus{}dict}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        
            \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{n+nb}{input}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Enter the name of best model saved in ./logs dir: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{test}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{label}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
        
        \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
            \PY{n}{test\PYZus{}main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading dict{\ldots}

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Enter the name of best model saved in ./logs dir:  model\_weight\_SGD.12-0.9832.hdf5

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
input\_1 (InputLayer)         (None, 51, 51, 3)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_1 (Conv2D)            (None, 49, 49, 64)        1792      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_1 (Batch (None, 49, 49, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_1 (LeakyReLU)    (None, 49, 49, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_2 (Conv2D)            (None, 47, 47, 64)        36928     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_2 (Batch (None, 47, 47, 64)        256       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_2 (LeakyReLU)    (None, 47, 47, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_1 (MaxPooling2 (None, 23, 23, 64)        0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_3 (Conv2D)            (None, 21, 21, 128)       73856     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_3 (Batch (None, 21, 21, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_3 (LeakyReLU)    (None, 21, 21, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_4 (Conv2D)            (None, 19, 19, 128)       147584    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_4 (Batch (None, 19, 19, 128)       512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_4 (LeakyReLU)    (None, 19, 19, 128)       0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_2 (MaxPooling2 (None, 9, 9, 128)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_5 (Conv2D)            (None, 7, 7, 256)         295168    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_5 (Batch (None, 7, 7, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_5 (LeakyReLU)    (None, 7, 7, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_6 (Conv2D)            (None, 5, 5, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_6 (Batch (None, 5, 5, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_6 (LeakyReLU)    (None, 5, 5, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
conv2d\_7 (Conv2D)            (None, 3, 3, 256)         590080    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_7 (Batch (None, 3, 3, 256)         1024      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
leaky\_re\_lu\_7 (LeakyReLU)    (None, 3, 3, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
max\_pooling2d\_3 (MaxPooling2 (None, 1, 1, 256)         0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
flatten\_1 (Flatten)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_1 (Dropout)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_1 (Dense)              (None, 128)               32896     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_8 (Batch (None, 128)               512       
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_1 (Activation)    (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_2 (Dropout)          (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_2 (Dense)              (None, 12)                1548      
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
batch\_normalization\_9 (Batch (None, 12)                48        
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
activation\_2 (Activation)    (None, 12)                0         
=================================================================
Total params: 1,775,100
Trainable params: 1,772,516
Non-trainable params: 2,584
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
794/794 [==============================] - 10s 12ms/step

    \end{Verbatim}

    \hypertarget{transfer-learning-using-xception-vgg-imagenet}{%
\subsection{4.2 Transfer Learning using Xception, VGG,
ImageNet}\label{transfer-learning-using-xception-vgg-imagenet}}

    Use Keras Pretrained Models

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{o}{\PYZpc{}}\PY{k}{ls} ../../models/keras\PYZhy{}pretrained\PYZhy{}models
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
imagenet\_class\_index.json
inception\_resnet\_v2\_weights\_tf\_dim\_ordering\_tf\_kernels.h5
inception\_resnet\_v2\_weights\_tf\_dim\_ordering\_tf\_kernels\_notop.h5
inception\_v3\_weights\_tf\_dim\_ordering\_tf\_kernels.h5
inception\_v3\_weights\_tf\_dim\_ordering\_tf\_kernels\_notop.h5
Kuszma.JPG
resnet50\_weights\_tf\_dim\_ordering\_tf\_kernels.h5
resnet50\_weights\_tf\_dim\_ordering\_tf\_kernels\_notop.h5
vgg16\_weights\_tf\_dim\_ordering\_tf\_kernels\_notop.h5
xception\_weights\_tf\_dim\_ordering\_tf\_kernels.h5
xception\_weights\_tf\_dim\_ordering\_tf\_kernels\_notop.h5

    \end{Verbatim}

    \hypertarget{helper-functions-to-load-seedlings-data}{%
\paragraph{Helper Functions to load Seedlings
data}\label{helper-functions-to-load-seedlings-data}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}102}]:} \PY{c+c1}{\PYZsh{} Load test seedlings data \PYZam{} return images, labels, image\PYZus{}per\PYZus{}class}
          
          
          \PY{k}{def} \PY{n+nf}{load\PYZus{}seedlings\PYZus{}transfer}\PY{p}{(}\PY{n}{path}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                                      \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{299}\PY{p}{,} \PY{l+m+mi}{299}\PY{p}{)}\PY{p}{)}\PY{p}{:}
              \PY{n}{images} \PY{o}{=} \PY{p}{[}\PY{p}{]}
              \PY{n}{labels} \PY{o}{=} \PY{p}{[}\PY{p}{]}
              \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{defaultdict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{)}
          
              \PY{k}{for} \PY{n}{class\PYZus{}folder\PYZus{}name} \PY{o+ow}{in} \PY{n}{os}\PY{o}{.}\PY{n}{listdir}\PY{p}{(}\PY{n}{path}\PY{p}{)}\PY{p}{:}
                  \PY{n}{class\PYZus{}folder\PYZus{}path} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{path}\PY{p}{,} \PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
          
                  \PY{k}{for} \PY{n}{image\PYZus{}path} \PY{o+ow}{in} \PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}path}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{*.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                      \PY{c+c1}{\PYZsh{} Read an image}
                      \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{IMREAD\PYZus{}COLOR}\PY{p}{)}
          
                      \PY{c+c1}{\PYZsh{} Stats for each seedlings class}
                      \PY{n}{images\PYZus{}per\PYZus{}class}\PY{p}{[}\PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
          
                      \PY{c+c1}{\PYZsh{} Resize image to img\PYZus{}size pixels}
                      \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
          
                      \PY{n}{images}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                      \PY{n}{labels}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{class\PYZus{}folder\PYZus{}name}\PY{p}{)}
          
              \PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{images}\PY{p}{)}
              \PY{n}{labels} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
          
              \PY{k}{return} \PY{n}{images}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{images\PYZus{}per\PYZus{}class}
          
          
          \PY{c+c1}{\PYZsh{} Load test seedlings data \PYZam{} return images, ids}
          
          
          \PY{k}{def} \PY{n+nf}{load\PYZus{}seedlings\PYZus{}transfer\PYZus{}test}\PY{p}{(}\PY{n}{path}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{root\PYZus{}dir}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
                                           \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{299}\PY{p}{,} \PY{l+m+mi}{299}\PY{p}{)}\PY{p}{)}\PY{p}{:}
              \PY{n}{images} \PY{o}{=} \PY{p}{[}\PY{p}{]}
              \PY{n}{ids} \PY{o}{=} \PY{p}{[}\PY{p}{]}
          
              \PY{k}{for} \PY{n}{image\PYZus{}path} \PY{o+ow}{in} \PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{path}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{*.png}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                  \PY{c+c1}{\PYZsh{} Read an image}
                  \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{imread}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{,} \PY{n}{cv2}\PY{o}{.}\PY{n}{IMREAD\PYZus{}COLOR}\PY{p}{)}
          
                  \PY{c+c1}{\PYZsh{} Resize image to img\PYZus{}size pixels}
                  \PY{n}{image} \PY{o}{=} \PY{n}{cv2}\PY{o}{.}\PY{n}{resize}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{img\PYZus{}size}\PY{p}{,} \PY{n}{interpolation}\PY{o}{=}\PY{n}{cv2}\PY{o}{.}\PY{n}{INTER\PYZus{}AREA}\PY{p}{)}
          
                  \PY{n}{images}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{image}\PY{p}{)}
                  \PY{n}{ids}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{basename}\PY{p}{(}\PY{n}{image\PYZus{}path}\PY{p}{)}\PY{p}{)}
          
              \PY{n}{images} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{images}\PY{p}{)}
              \PY{n}{ids} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{ids}\PY{p}{)}
          
              \PY{k}{return} \PY{n}{images}\PY{p}{,} \PY{n}{ids}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}79}]:} \PY{n}{ls} \PY{n}{data}\PY{o}{/}\PY{n+nb}{all}\PY{o}{/}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
sample\_submission.csv  \textcolor{ansi-blue-intense}{\textbf{test}}/  \textcolor{ansi-red-intense}{\textbf{test.zip}}  \textcolor{ansi-blue-intense}{\textbf{train}}/  \textcolor{ansi-red-intense}{\textbf{train.zip}}

    \end{Verbatim}

    \hypertarget{xception-model}{%
\subsubsection{4.2.1 Xception Model}\label{xception-model}}

    \hypertarget{prepare-load-data}{%
\paragraph{4.2.1.1 Prepare \& Load Data}\label{prepare-load-data}}

    The \texttt{Xception} model \texttt{input} dimesions are
\texttt{299\ *\ 299\ *\ 3}. Hence we need to prepare images satisfying
the dimensional requirements.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{c+c1}{\PYZsh{} Constants}
        
        \PY{n}{input\PYZus{}dim} \PY{o}{=} \PY{l+m+mi}{299}
        \PY{n}{POOLING} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{images\PYZus{}xception} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
        
        \PY{k}{try}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Images \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{images\PYZus{}xception} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}xception.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
            \PY{n}{labels} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}xception.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images \PYZam{} Labels dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{k}{if} \PY{o+ow}{not} \PY{p}{(}\PY{n}{images\PYZus{}xception}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{:}
            \PY{n}{img\PYZus{}size} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{299}\PY{p}{,} \PY{l+m+mi}{299}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Running load\PYZus{}seedlings method with img\PYZus{}size }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ ...}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{img\PYZus{}size}\PY{p}{)}\PY{p}{)}
            \PY{n}{images\PYZus{}xception}\PY{p}{,} \PY{n}{labels}\PY{p}{,} \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{load\PYZus{}seedlings\PYZus{}transfer}\PY{p}{(}
                \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{n}{img\PYZus{}size}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping Images \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} Dumping dicts}
            \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}xception}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}xception.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
            \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{labels}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}xception.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images \PYZam{} Labels dict dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading Images, Labels \& images\_per\_class dict {\ldots}
Loading done.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{c+c1}{\PYZsh{} Type cast int to float for Xception model compatibility}
         
         \PY{n}{images\PYZus{}xception} \PY{o}{=} \PY{n}{images\PYZus{}xception}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{copy}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}xception}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}xception}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Labels Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labels}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Label Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labels}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Images Shape: (4750, 299, 299, 3)
Image Data Type: float32
Labels Shape: (4750,)
Label Data Type: <U10

    \end{Verbatim}

    \hypertarget{extract-xception-bottleneck-features}{%
\paragraph{4.2.1.2 Extract Xception Bottleneck
Features}\label{extract-xception-bottleneck-features}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{o}{\PYZpc{}}\PY{k}{time}
         
         \PY{c+c1}{\PYZsh{} Numpy array to store extracted features from Xception model}
         \PY{n}{images\PYZus{}xception\PYZus{}features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}
             \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{images\PYZus{}xception}\PY{p}{)}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Extract features with Xception model}
         \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n}{tqdm}\PY{p}{(}\PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{images\PYZus{}xception}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{x} \PY{o}{=} \PY{n}{xception}\PY{o}{.}\PY{n}{preprocess\PYZus{}input}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
             \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{x}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Images shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping images\PYZus{}xception\PYZus{}features ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}xception\PYZus{}features}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}xception\PYZus{}features.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}xception\PYZus{}features dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
126it [00:00, 1254.04it/s]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
CPU times: user 1 µs, sys: 1 µs, total: 2 µs
Wall time: 3.81 µs

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
4750it [00:02, 1652.94it/s]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Train Images shape: (4750, 299, 299, 3) size: 1,273,964,250

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{k}{del} \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{p}{,} \PY{n}{labels}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}49}]:} \PY{k}{try}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading images\PYZus{}xception\PYZus{}features \PYZam{} Labels ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{images\PYZus{}xception\PYZus{}features} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}xception\PYZus{}features.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{labels} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}xception.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZus{}xception\PYZus{}features \PYZam{} Labels does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         
         \PY{c+c1}{\PYZsh{} Split the data in train \PYZam{} validation set}
         \PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}
             \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{p}{,}
             \PY{n}{labels}\PY{p}{,}
             \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
             \PY{n}{train\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,}
             \PY{n}{stratify}\PY{o}{=}\PY{n}{labels}\PY{p}{,}
             \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}
         \PY{p}{)}
         
         \PY{k}{del} \PY{n}{images\PYZus{}xception\PYZus{}features}\PY{p}{,} \PY{n}{labels}
         
         \PY{c+c1}{\PYZsh{} Xception V1 model, with weights pre\PYZhy{}trained on ImageNet. On ImageNet, this model gets to}
         \PY{c+c1}{\PYZsh{} a top\PYZhy{}1 validation accuracy of 0.790 and a top\PYZhy{}5 validation accuracy of 0.945. Note that this}
         \PY{c+c1}{\PYZsh{} model only supports the data format \PYZsq{}channels\PYZus{}last\PYZsq{} (height, width, channels).}
         \PY{c+c1}{\PYZsh{} The default input size for this model is 299x299.}
         
         \PY{n}{xception\PYZus{}bottleneck} \PY{o}{=} \PY{n}{xception}\PY{o}{.}\PY{n}{Xception}\PY{p}{(}
             \PY{n}{weights}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{imagenet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{include\PYZus{}top}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{pooling}\PY{o}{=}\PY{n}{POOLING}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Calculating Xception train \PYZam{} valid set bottleneck features}
         \PY{n}{x\PYZus{}train\PYZus{}botf} \PY{o}{=} \PY{n}{xception\PYZus{}bottleneck}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{x\PYZus{}valid\PYZus{}botf} \PY{o}{=} \PY{n}{xception\PYZus{}bottleneck}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Xception train bottleneck features shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{x\PYZus{}train\PYZus{}botf}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{x\PYZus{}train\PYZus{}botf}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Xception valid bottleneck features shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{x\PYZus{}valid\PYZus{}botf}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{x\PYZus{}valid\PYZus{}botf}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Dumping Xception train \PYZam{} valid set bottleneck features}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{x\PYZus{}valid\PYZus{}botf}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}valid\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}valid\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping Xception train \PYZam{} valid set bottleneck features \PYZam{} labels done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading images\_xception\_features \& Labels {\ldots}
Loading done.
3800/3800 [==============================] - 1794s 472ms/step
950/950 [==============================] - 443s 467ms/step
Xception train bottleneck features shape: (3800, 2048) size: 7,782,400
Xception valid bottleneck features shape: (950, 2048) size: 1,945,600
Dumping Xception train \& valid set bottleneck features done.

    \end{Verbatim}

    \hypertarget{logistic-regression-on-xception-bottleneck-features}{%
\paragraph{4.2.1.3 Logistic Regression on Xception Bottleneck
Features}\label{logistic-regression-on-xception-bottleneck-features}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{} Logistic Regression classifier}
         
         \PY{n}{logreg} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}
             \PY{n}{multi\PYZus{}class}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{multinomial}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{solver}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lbfgs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
         \PY{n}{logreg}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
         
         \PY{n}{valid\PYZus{}probs} \PY{o}{=} \PY{n}{logreg}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{x\PYZus{}valid\PYZus{}botf}\PY{p}{)}
         \PY{n}{valid\PYZus{}preds} \PY{o}{=} \PY{n}{logreg}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}valid\PYZus{}botf}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Logistic Regression model Accuracy on valid set using Xception Bottleneck Features: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{valid\PYZus{}preds}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Logistic Regression model Accuracy on valid set using Xception Bottleneck Features: 87.26\%

    \end{Verbatim}

    \textbf{Confusion Matrix}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{con\PYZus{}matrix} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{valid\PYZus{}preds}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Plot confusion matrix using seaborn heatmap}
         
         \PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+m+mi}{15}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{ax} \PY{o}{=} \PY{n}{sns}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{con\PYZus{}matrix}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{cm}\PY{o}{.}\PY{n}{Oranges}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
         
         \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xticklabels}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
         \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}yticklabels}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
         
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Predicted class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Confusion Matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{n}{fig}\PY{o}{.}\PY{n}{savefig}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/con\PYZus{}matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                  \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Seedlings\PYZus{}logreg\PYZus{}Confusion\PYZus{}Matrix.png}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{300}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_162_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{classifier-comparison}{%
\paragraph{4.2.1.4 Classifier Comparison}\label{classifier-comparison}}

After fitting our train dataset on
\texttt{Xception\ Bottleneck\ Features}, you can run a general
Classifier Comparison module containing sklearn classifers with vanilla
configurations.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{o}{\PYZpc{}} \PY{o}{\PYZpc{}} \PY{n}{time}
         
         
         \PY{k}{def} \PY{n+nf}{classifier\PYZus{}comparison}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
             \PY{c+c1}{\PYZsh{} Classifier names \PYZam{} initializations}
             \PY{n}{names} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Nearest Neighbors}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gaussian Process}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                      \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Random Forest}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Neural Net}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AdaBoost}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{GradientBoost}\PY{l+s+s2}{\PYZdq{}}
                      \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Naive Bayes}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LDA}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{QDA}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGB Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
         
             \PY{n}{classifiers} \PY{o}{=} \PY{p}{[}
                 \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,}
                 \PY{n}{SVC}\PY{p}{(}\PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{p}{,}
                 \PY{n}{GaussianProcessClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{MLPClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{AdaBoostClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{GaussianNB}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{LinearDiscriminantAnalysis}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{QuadraticDiscriminantAnalysis}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                 \PY{n}{XGBClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{]}
         
             \PY{c+c1}{\PYZsh{} Split \PYZam{} shuffle data using Stratified K Fold}
             \PY{n}{kfold} \PY{o}{=} \PY{n}{StratifiedKFold}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{n}{n\PYZus{}splits}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{21}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Calculate accuracy over all splits, classifiers}
             \PY{n}{count} \PY{o}{=} \PY{l+m+mi}{0}
             \PY{n}{acc\PYZus{}dict} \PY{o}{=} \PY{n}{defaultdict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{)}
             \PY{k}{for} \PY{n}{train\PYZus{}index}\PY{p}{,} \PY{n}{test\PYZus{}index} \PY{o+ow}{in} \PY{n}{kfold}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}\PY{p}{:}
                 \PY{n}{xtrain}\PY{p}{,} \PY{n}{ytrain} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{[}\PY{n}{train\PYZus{}index}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{train\PYZus{}index}\PY{p}{]}
                 \PY{n}{xtest}\PY{p}{,} \PY{n}{ytest} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{[}\PY{n}{test\PYZus{}index}\PY{p}{]}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{[}\PY{n}{test\PYZus{}index}\PY{p}{]}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Iteration: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{count}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} iterate over classifiers}
                 \PY{k}{for} \PY{n}{clf} \PY{o+ow}{in} \PY{n}{classifiers}\PY{p}{:}
                     \PY{n}{clf\PYZus{}name} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n+nv+vm}{\PYZus{}\PYZus{}class\PYZus{}\PYZus{}}\PY{o}{.}\PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}}
                     \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{xtrain}\PY{p}{,} \PY{n}{ytrain}\PY{p}{)}
                     \PY{n}{predictions} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{xtest}\PY{p}{)}
                     \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{ytest}\PY{p}{,} \PY{n}{predictions}\PY{p}{)}
         
                     \PY{c+c1}{\PYZsh{} Append results in default dict of lists}
                     \PY{n}{acc\PYZus{}dict}\PY{p}{[}\PY{n}{clf\PYZus{}name}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{accuracy}\PY{p}{)}
         
                 \PY{n}{count} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
         
             \PY{k}{return} \PY{n}{acc\PYZus{}dict}
         
         
         \PY{c+c1}{\PYZsh{} Call the classifier\PYZus{}comparison module \PYZam{} save the results}
         \PY{n}{acc\PYZus{}dict} \PY{o}{=} \PY{n}{classifier\PYZus{}comparison}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Iteration:  0

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:442: UserWarning: The priors do not sum to 1. Renormalizing
  UserWarning)
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/preprocessing/label.py:151: DeprecationWarning: The truth value of an empty array is ambiguous. Returning False, but in future this will result in an error. Use `array.size > 0` to check that an array is not empty.
  if diff:

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Iteration:  1

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/preprocessing/label.py:151: DeprecationWarning: The truth value of an empty array is ambiguous. Returning False, but in future this will result in an error. Use `array.size > 0` to check that an array is not empty.
  if diff:

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Iteration:  2

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/discriminant\_analysis.py:682: UserWarning: Variables are collinear
  warnings.warn("Variables are collinear")

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
CPU times: user 55min 50s, sys: 6min 1s, total: 1h 1min 52s
Wall time: 50min 47s

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/sklearn/preprocessing/label.py:151: DeprecationWarning: The truth value of an empty array is ambiguous. Returning False, but in future this will result in an error. Use `array.size > 0` to check that an array is not empty.
  if diff:

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{c+c1}{\PYZsh{} Dataframe containing classifier name \PYZam{} accuracy score}
         \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{o}{.}\PY{n}{from\PYZus{}dict}\PY{p}{(}\PY{n}{acc\PYZus{}dict}\PY{p}{,} \PY{n}{orient}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{rename}\PY{p}{(}
             \PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1st Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2nd Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3rd Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Calculate average accuracy}
         \PY{n}{acc\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{p}{(}\PY{n}{acc\PYZus{}df}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}
         
         \PY{n}{sorted\PYZus{}acc\PYZus{}df} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
         \PY{n}{display}\PY{p}{(}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
                               1st Iteration  2nd Iteration  3rd Iteration  \
MLPClassifier                          86.14          87.29          85.27   
XGBClassifier                          77.17          79.48          78.78   
GradientBoostingClassifier             76.30          77.74          77.04   
GaussianProcessClassifier              74.57          77.43          74.58   
KNeighborsClassifier                   73.31          75.22          73.40   
LinearDiscriminantAnalysis             65.20          68.98          65.32   
RandomForestClassifier                 60.79          61.33          61.92   
SVC                                    59.53          61.09          60.49   
GaussianNB                             51.50          54.70          56.53   
DecisionTreeClassifier                 48.43          48.38          48.54   
AdaBoostClassifier                     33.86          35.91          43.63   
QuadraticDiscriminantAnalysis          13.23          13.50          12.51   

                               avg_acc  
MLPClassifier                    86.24  
XGBClassifier                    78.48  
GradientBoostingClassifier       77.03  
GaussianProcessClassifier        75.53  
KNeighborsClassifier             73.97  
LinearDiscriminantAnalysis       66.50  
RandomForestClassifier           61.34  
SVC                              60.37  
GaussianNB                       54.24  
DecisionTreeClassifier           48.45  
AdaBoostClassifier               37.80  
QuadraticDiscriminantAnalysis    13.08  
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}34}]:} \PY{c+c1}{\PYZsh{} Plot a barplot containing classifier name \PYZam{} accuracy score}
         
         \PY{n}{sns}\PY{o}{.}\PY{n}{barplot}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{data}\PY{o}{=}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Classifier Comparison based on Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}34}]:} Text(0.5,1,'Classifier Comparison based on Accuracy')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_166_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    It seems like simple neural network \texttt{MLP} performs much
\texttt{better} than others. Hence we can train a full blown
\texttt{Fully\ Connected\ networks} in keras.

    \hypertarget{training-a-keras-dense-model}{%
\paragraph{4.2.1.5 Training a Keras Dense
Model}\label{training-a-keras-dense-model}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{c+c1}{\PYZsh{} Dumping Xception train \PYZam{} valid set bottleneck features}
        
        \PY{n}{x\PYZus{}train\PYZus{}botf} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{x\PYZus{}valid\PYZus{}botf} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}valid\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        
        \PY{n}{y\PYZus{}train\PYZus{}botf} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{y\PYZus{}valid\PYZus{}botf} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}valid\PYZus{}botf.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Xception train \PYZam{} valid set bottleneck features \PYZam{} labels done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading Xception train \& valid set bottleneck features \& labels done.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{o}{\PYZpc{}} \PY{o}{\PYZpc{}} \PY{n}{time}
        
        \PY{n}{BATCH\PYZus{}SIZE} \PY{o}{=} \PY{l+m+mi}{16}
        \PY{n}{EPOCHS} \PY{o}{=} \PY{l+m+mi}{500}
        \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
        \PY{c+c1}{\PYZsh{} Fixing random seed}
        \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Reduce LR On Plateau}
        \PY{n}{lr\PYZus{}reduced} \PY{o}{=} \PY{n}{ReduceLROnPlateau}\PY{p}{(}
            \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{factor}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}5}\PY{p}{,} \PY{n}{patience}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Setting checkpoint \PYZam{} early stopping}
        \PY{n}{checkpoint\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint/Xception\PYZus{}ADAM\PYZus{}best\PYZus{}weights.}\PY{l+s+si}{\PYZob{}epoch:02d\PYZcb{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+si}{\PYZob{}acc:.4f\PYZcb{}}\PY{l+s+s1}{.hdf5}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{checkpoint} \PY{o}{=} \PY{n}{ModelCheckpoint}\PY{p}{(}
            \PY{n}{checkpoint\PYZus{}path}\PY{p}{,} \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{save\PYZus{}best\PYZus{}only}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} TensorBoard logs}
        \PY{n}{tensorboard} \PY{o}{=} \PY{n}{TensorBoard}\PY{p}{(}\PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./logs}\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{time}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                  \PY{n}{histogram\PYZus{}freq}\PY{o}{=}\PY{l+m+mi}{2000}\PY{p}{,} \PY{n}{write\PYZus{}graph}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{write\PYZus{}images}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Early Stopping}
        \PY{c+c1}{\PYZsh{} early\PYZus{}stop = EarlyStopping(monitor=\PYZsq{}val\PYZus{}acc\PYZsq{}, patience=5, mode=\PYZsq{}max\PYZsq{})}
        
        \PY{c+c1}{\PYZsh{} All callbacks}
        \PY{n}{callbacks\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{lr\PYZus{}reduced}\PY{p}{,} \PY{n}{checkpoint}\PY{p}{,} \PY{n}{tensorboard}\PY{p}{]}
        
        
        \PY{c+c1}{\PYZsh{} Model Neural Network Architecture}
        \PY{n}{inputs} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2048}\PY{p}{,}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 1st Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{2048}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{2048}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{inputs}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 2nd Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1024}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{1024}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.4}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 3rd Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{512}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{512}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.3}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 4th Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{256}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.2}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 5th Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding output layer}
        \PY{n}{outputs} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{softmax}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{n}{model} \PY{o}{=} \PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{n}{inputs}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{n}{outputs}\PY{p}{)}
        
        \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Xception\PYZus{}ADAM\PYZus{}best\PYZus{}weights.41\PYZhy{}0.9428.hdf5}\PY{l+s+s1}{\PYZsq{}}
        \PY{c+c1}{\PYZsh{} Load network weights}
        \PY{k}{if} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading weights from previous run...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Weights not loaded.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
        
        \PY{n}{mypotim} \PY{o}{=} \PY{n}{Adam}\PY{p}{(}\PY{n}{lr}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,} \PY{n}{beta\PYZus{}1}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{beta\PYZus{}2}\PY{o}{=}\PY{l+m+mf}{0.999}\PY{p}{,} \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}08}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} mypotim = SGD(lr=1 * 1e\PYZhy{}1, momentum=0.9, nesterov=True)}
        \PY{n}{model}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{categorical\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                      \PY{n}{optimizer}\PY{o}{=}\PY{n}{mypotim}\PY{p}{,}
                      \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} Model Summary}
        \PY{n}{model}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Convert categorical labels into one\PYZhy{}hot vector}
        \PY{n}{y\PYZus{}train\PYZus{}botf} \PY{o}{=} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}train\PYZus{}botf}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{The Best Model will be saved in the following dir }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{checkpoint\PYZus{}path}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Training of the model with Xception bottleneck features as inputs starts now ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Fit the model}
        \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf}\PY{p}{,} \PY{n}{y\PYZus{}train\PYZus{}botf}\PY{p}{,} \PY{n}{validation\PYZus{}split}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{n}{BATCH\PYZus{}SIZE}\PY{p}{,}
                  \PY{n}{epochs}\PY{o}{=}\PY{n}{EPOCHS}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{callbacks}\PY{o}{=}\PY{n}{callbacks\PYZus{}list}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading weights from previous run{\ldots} Xception\_ADAM\_best\_weights.41-0.9428.hdf5
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
input\_2 (InputLayer)         (None, 2048)              0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_7 (Dense)              (None, 2048)              4196352   
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_6 (Dropout)          (None, 2048)              0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_8 (Dense)              (None, 1024)              2098176   
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_7 (Dropout)          (None, 1024)              0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_9 (Dense)              (None, 512)               524800    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_8 (Dropout)          (None, 512)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_10 (Dense)             (None, 256)               131328    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_9 (Dropout)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_11 (Dense)             (None, 128)               32896     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_10 (Dropout)         (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_12 (Dense)             (None, 12)                1548      
=================================================================
Total params: 6,985,100
Trainable params: 6,985,100
Non-trainable params: 0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
The Best Model will be saved in the following dir  ./checkpoint/Xception\_ADAM\_best\_weights.\{epoch:02d\}-\{acc:.4f\}.hdf5
Training of the model with Xception bottleneck features as inputs starts now {\ldots}
Train on 2660 samples, validate on 1140 samples
Epoch 1/500
2660/2660 [==============================] - 5s 2ms/step - loss: 0.7543 - acc: 0.8654 - val\_loss: 0.6771 - val\_acc: 0.8579

Epoch 00001: val\_acc improved from -inf to 0.85789, saving model to ./checkpoint/Xception\_ADAM\_best\_weights.01-0.8654.hdf5
Epoch 2/500
2660/2660 [==============================] - 3s 991us/step - loss: 0.7839 - acc: 0.8470 - val\_loss: 0.7111 - val\_acc: 0.8412

Epoch 00002: val\_acc did not improve from 0.85789
Epoch 3/500
2660/2660 [==============================] - 3s 990us/step - loss: 1.0081 - acc: 0.7624 - val\_loss: 0.6560 - val\_acc: 0.8316

Epoch 00003: val\_acc did not improve from 0.85789
Epoch 4/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.7773 - acc: 0.8034 - val\_loss: 0.7376 - val\_acc: 0.8246

Epoch 00004: val\_acc did not improve from 0.85789
Epoch 5/500
2660/2660 [==============================] - 3s 1ms/step - loss: 1.0821 - acc: 0.7684 - val\_loss: 0.7291 - val\_acc: 0.8123

Epoch 00005: val\_acc did not improve from 0.85789
Epoch 6/500
2660/2660 [==============================] - 3s 1ms/step - loss: 1.2182 - acc: 0.7361 - val\_loss: 0.7179 - val\_acc: 0.7904

Epoch 00006: ReduceLROnPlateau reducing learning rate to 0.00020000000949949026.

Epoch 00006: val\_acc did not improve from 0.85789
Epoch 7/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.8562 - acc: 0.7628 - val\_loss: 0.6463 - val\_acc: 0.8140

Epoch 00007: val\_acc did not improve from 0.85789
Epoch 8/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.7347 - acc: 0.7962 - val\_loss: 0.6238 - val\_acc: 0.8140

Epoch 00008: val\_acc did not improve from 0.85789
Epoch 9/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.7336 - acc: 0.8117 - val\_loss: 0.5876 - val\_acc: 0.8289

Epoch 00009: val\_acc did not improve from 0.85789
Epoch 10/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.7027 - acc: 0.8135 - val\_loss: 0.5784 - val\_acc: 0.8377

Epoch 00010: val\_acc did not improve from 0.85789
Epoch 11/500
2660/2660 [==============================] - 3s 945us/step - loss: 0.6331 - acc: 0.8244 - val\_loss: 0.5804 - val\_acc: 0.8465

Epoch 00011: ReduceLROnPlateau reducing learning rate to 2.0000000949949027e-05.

Epoch 00011: val\_acc did not improve from 0.85789
Epoch 12/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5994 - acc: 0.8361 - val\_loss: 0.5749 - val\_acc: 0.8491

Epoch 00012: val\_acc did not improve from 0.85789
Epoch 13/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5580 - acc: 0.8357 - val\_loss: 0.5702 - val\_acc: 0.8509

Epoch 00013: val\_acc did not improve from 0.85789
Epoch 14/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5390 - acc: 0.8481 - val\_loss: 0.5712 - val\_acc: 0.8535

Epoch 00014: val\_acc did not improve from 0.85789
Epoch 15/500
2660/2660 [==============================] - 3s 991us/step - loss: 0.5731 - acc: 0.8436 - val\_loss: 0.5700 - val\_acc: 0.8553

Epoch 00015: val\_acc did not improve from 0.85789
Epoch 16/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5328 - acc: 0.8489 - val\_loss: 0.5694 - val\_acc: 0.8535

Epoch 00016: ReduceLROnPlateau reducing learning rate to 2.0000001313746906e-06.

Epoch 00016: val\_acc did not improve from 0.85789
Epoch 17/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5728 - acc: 0.8466 - val\_loss: 0.5688 - val\_acc: 0.8535

Epoch 00017: val\_acc did not improve from 0.85789
Epoch 18/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5688 - acc: 0.8455 - val\_loss: 0.5686 - val\_acc: 0.8535

Epoch 00018: val\_acc did not improve from 0.85789
Epoch 19/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5954 - acc: 0.8447 - val\_loss: 0.5685 - val\_acc: 0.8535

Epoch 00019: val\_acc did not improve from 0.85789
Epoch 20/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5790 - acc: 0.8432 - val\_loss: 0.5671 - val\_acc: 0.8535

Epoch 00020: val\_acc did not improve from 0.85789
Epoch 21/500
2660/2660 [==============================] - 3s 984us/step - loss: 0.5746 - acc: 0.8534 - val\_loss: 0.5668 - val\_acc: 0.8535

Epoch 00021: ReduceLROnPlateau reducing learning rate to 2.000000222324161e-07.

Epoch 00021: val\_acc did not improve from 0.85789
Epoch 22/500
2660/2660 [==============================] - 3s 989us/step - loss: 0.6100 - acc: 0.8365 - val\_loss: 0.5668 - val\_acc: 0.8535

Epoch 00022: val\_acc did not improve from 0.85789
Epoch 23/500
2660/2660 [==============================] - 3s 987us/step - loss: 0.5515 - acc: 0.8526 - val\_loss: 0.5668 - val\_acc: 0.8535

Epoch 00023: val\_acc did not improve from 0.85789
Epoch 24/500
2660/2660 [==============================] - 3s 997us/step - loss: 0.5334 - acc: 0.8553 - val\_loss: 0.5667 - val\_acc: 0.8535

Epoch 00024: val\_acc did not improve from 0.85789
Epoch 25/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5331 - acc: 0.8406 - val\_loss: 0.5667 - val\_acc: 0.8535

Epoch 00025: val\_acc did not improve from 0.85789
Epoch 26/500
2660/2660 [==============================] - 3s 997us/step - loss: 0.5203 - acc: 0.8489 - val\_loss: 0.5666 - val\_acc: 0.8544

Epoch 00026: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-08.

Epoch 00026: val\_acc did not improve from 0.85789
Epoch 27/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5851 - acc: 0.8481 - val\_loss: 0.5666 - val\_acc: 0.8544

Epoch 00027: val\_acc did not improve from 0.85789
Epoch 28/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5781 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8544

Epoch 00028: val\_acc did not improve from 0.85789
Epoch 29/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5328 - acc: 0.8466 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00029: val\_acc did not improve from 0.85789
Epoch 30/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5090 - acc: 0.8504 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00030: val\_acc did not improve from 0.85789
Epoch 31/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5649 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00031: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-09.

Epoch 00031: val\_acc did not improve from 0.85789
Epoch 32/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5755 - acc: 0.8376 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00032: val\_acc did not improve from 0.85789
Epoch 33/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5814 - acc: 0.8440 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00033: val\_acc did not improve from 0.85789
Epoch 34/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.4980 - acc: 0.8553 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00034: val\_acc did not improve from 0.85789
Epoch 35/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5822 - acc: 0.8474 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00035: val\_acc did not improve from 0.85789
Epoch 36/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5793 - acc: 0.8526 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00036: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-10.

Epoch 00036: val\_acc did not improve from 0.85789
Epoch 37/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5129 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00037: val\_acc did not improve from 0.85789
Epoch 38/500
2660/2660 [==============================] - 9s 3ms/step - loss: 0.5505 - acc: 0.8462 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00038: val\_acc did not improve from 0.85789
Epoch 39/500
2660/2660 [==============================] - 10s 4ms/step - loss: 0.5440 - acc: 0.8530 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00039: val\_acc did not improve from 0.85789
Epoch 40/500
2660/2660 [==============================] - 10s 4ms/step - loss: 0.5869 - acc: 0.8492 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00040: val\_acc did not improve from 0.85789
Epoch 41/500
2660/2660 [==============================] - 10s 4ms/step - loss: 0.5308 - acc: 0.8466 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00041: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-11.

Epoch 00041: val\_acc did not improve from 0.85789
Epoch 42/500
2660/2660 [==============================] - 10s 4ms/step - loss: 0.5506 - acc: 0.8414 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00042: val\_acc did not improve from 0.85789
Epoch 43/500
2660/2660 [==============================] - 10s 4ms/step - loss: 0.5205 - acc: 0.8523 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00043: val\_acc did not improve from 0.85789
Epoch 44/500
2660/2660 [==============================] - 12s 4ms/step - loss: 0.5301 - acc: 0.8508 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00044: val\_acc did not improve from 0.85789
Epoch 45/500
2660/2660 [==============================] - 6s 2ms/step - loss: 0.5297 - acc: 0.8508 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00045: val\_acc did not improve from 0.85789
Epoch 46/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5424 - acc: 0.8538 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00046: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-12.

Epoch 00046: val\_acc did not improve from 0.85789
Epoch 47/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5723 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00047: val\_acc did not improve from 0.85789
Epoch 48/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5579 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00048: val\_acc did not improve from 0.85789
Epoch 49/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5272 - acc: 0.8511 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00049: val\_acc did not improve from 0.85789
Epoch 50/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5562 - acc: 0.8477 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00050: val\_acc did not improve from 0.85789
Epoch 51/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.5624 - acc: 0.8470 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00051: ReduceLROnPlateau reducing learning rate to 2.000000208848829e-13.

Epoch 00051: val\_acc did not improve from 0.85789
Epoch 52/500
2660/2660 [==============================] - 3s 1ms/step - loss: 0.4917 - acc: 0.8455 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00052: val\_acc did not improve from 0.85789
Epoch 53/500
2660/2660 [==============================] - 3s 997us/step - loss: 0.5349 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00053: val\_acc did not improve from 0.85789
Epoch 54/500
2660/2660 [==============================] - 3s 959us/step - loss: 0.5540 - acc: 0.8530 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00054: val\_acc did not improve from 0.85789
Epoch 55/500
2660/2660 [==============================] - 3s 955us/step - loss: 0.6032 - acc: 0.8376 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00055: val\_acc did not improve from 0.85789
Epoch 56/500
2660/2660 [==============================] - 3s 955us/step - loss: 0.5838 - acc: 0.8402 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00056: ReduceLROnPlateau reducing learning rate to 2.0000002359538835e-14.

Epoch 00056: val\_acc did not improve from 0.85789
Epoch 57/500
2660/2660 [==============================] - 3s 947us/step - loss: 0.5665 - acc: 0.8492 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00057: val\_acc did not improve from 0.85789
Epoch 58/500
2660/2660 [==============================] - 3s 947us/step - loss: 0.5727 - acc: 0.8481 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00058: val\_acc did not improve from 0.85789
Epoch 59/500
2660/2660 [==============================] - 2s 935us/step - loss: 0.5632 - acc: 0.8523 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00059: val\_acc did not improve from 0.85789
Epoch 60/500
2660/2660 [==============================] - 2s 931us/step - loss: 0.5225 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00060: val\_acc did not improve from 0.85789
Epoch 61/500
2660/2660 [==============================] - 2s 935us/step - loss: 0.5565 - acc: 0.8530 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00061: ReduceLROnPlateau reducing learning rate to 2.000000303716519e-15.

Epoch 00061: val\_acc did not improve from 0.85789
Epoch 62/500
2660/2660 [==============================] - 2s 927us/step - loss: 0.5534 - acc: 0.8470 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00062: val\_acc did not improve from 0.85789
Epoch 63/500
2660/2660 [==============================] - 2s 924us/step - loss: 0.5479 - acc: 0.8477 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00063: val\_acc did not improve from 0.85789
Epoch 64/500
2660/2660 [==============================] - 2s 923us/step - loss: 0.5292 - acc: 0.8526 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00064: val\_acc did not improve from 0.85789
Epoch 65/500
2660/2660 [==============================] - 2s 922us/step - loss: 0.5189 - acc: 0.8658 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00065: val\_acc did not improve from 0.85789
Epoch 66/500
2660/2660 [==============================] - 2s 920us/step - loss: 0.5443 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00066: ReduceLROnPlateau reducing learning rate to 2.0000002190132243e-16.

Epoch 00066: val\_acc did not improve from 0.85789
Epoch 67/500
2660/2660 [==============================] - 2s 920us/step - loss: 0.5621 - acc: 0.8425 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00067: val\_acc did not improve from 0.85789
Epoch 68/500
2660/2660 [==============================] - 2s 917us/step - loss: 0.5185 - acc: 0.8451 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00068: val\_acc did not improve from 0.85789
Epoch 69/500
2660/2660 [==============================] - 2s 915us/step - loss: 0.5744 - acc: 0.8444 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00108: val\_acc did not improve from 0.85789
Epoch 109/500
2660/2660 [==============================] - 2s 911us/step - loss: 0.5310 - acc: 0.8496 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00109: val\_acc did not improve from 0.85789
Epoch 110/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.4942 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00110: val\_acc did not improve from 0.85789
Epoch 111/500
2660/2660 [==============================] - 2s 914us/step - loss: 0.5106 - acc: 0.8481 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00111: ReduceLROnPlateau reducing learning rate to 2.0000002362981892e-25.

Epoch 00111: val\_acc did not improve from 0.85789
Epoch 112/500
2660/2660 [==============================] - 2s 915us/step - loss: 0.5191 - acc: 0.8508 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00112: val\_acc did not improve from 0.85789
Epoch 113/500
2660/2660 [==============================] - 2s 912us/step - loss: 0.5474 - acc: 0.8594 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00113: val\_acc did not improve from 0.85789
Epoch 114/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5541 - acc: 0.8541 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00114: val\_acc did not improve from 0.85789
Epoch 115/500
2660/2660 [==============================] - 2s 915us/step - loss: 0.5431 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00115: val\_acc did not improve from 0.85789
Epoch 116/500
2660/2660 [==============================] - 2s 913us/step - loss: 0.4922 - acc: 0.8560 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00116: ReduceLROnPlateau reducing learning rate to 2.0000002856019956e-26.

Epoch 00116: val\_acc did not improve from 0.85789
Epoch 117/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5649 - acc: 0.8541 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00117: val\_acc did not improve from 0.85789
Epoch 118/500
2660/2660 [==============================] - 2s 913us/step - loss: 0.4859 - acc: 0.8617 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00118: val\_acc did not improve from 0.85789
Epoch 119/500
2660/2660 [==============================] - 2s 920us/step - loss: 0.6096 - acc: 0.8451 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00119: val\_acc did not improve from 0.85789
Epoch 120/500
2660/2660 [==============================] - 2s 912us/step - loss: 0.5509 - acc: 0.8474 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00120: val\_acc did not improve from 0.85789
Epoch 121/500
2660/2660 [==============================] - 2s 912us/step - loss: 0.5289 - acc: 0.8553 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00121: ReduceLROnPlateau reducing learning rate to 2.000000285601996e-27.

Epoch 00121: val\_acc did not improve from 0.85789
Epoch 122/500
2660/2660 [==============================] - 2s 911us/step - loss: 0.5482 - acc: 0.8549 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00122: val\_acc did not improve from 0.85789
Epoch 123/500
2660/2660 [==============================] - 2s 913us/step - loss: 0.6003 - acc: 0.8451 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00123: val\_acc did not improve from 0.85789
Epoch 124/500
2660/2660 [==============================] - 2s 916us/step - loss: 0.5770 - acc: 0.8477 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00124: val\_acc did not improve from 0.85789
Epoch 125/500
2660/2660 [==============================] - 2s 912us/step - loss: 0.5179 - acc: 0.8549 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00125: val\_acc did not improve from 0.85789
Epoch 126/500
2660/2660 [==============================] - 2s 918us/step - loss: 0.5478 - acc: 0.8451 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00126: ReduceLROnPlateau reducing learning rate to 2.0000002470833968e-28.

Epoch 00126: val\_acc did not improve from 0.85789
Epoch 127/500
2660/2660 [==============================] - 3s 964us/step - loss: 0.4957 - acc: 0.8553 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00127: val\_acc did not improve from 0.85789
Epoch 128/500
2660/2660 [==============================] - 3s 966us/step - loss: 0.5311 - acc: 0.8538 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00128: val\_acc did not improve from 0.85789
Epoch 129/500
2660/2660 [==============================] - 3s 957us/step - loss: 0.4982 - acc: 0.8598 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00129: val\_acc did not improve from 0.85789
Epoch 130/500
2660/2660 [==============================] - 3s 947us/step - loss: 0.5219 - acc: 0.8455 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00130: val\_acc did not improve from 0.85789
Epoch 131/500
2660/2660 [==============================] - 3s 946us/step - loss: 0.5765 - acc: 0.8451 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00131: ReduceLROnPlateau reducing learning rate to 2.000000247083397e-29.

Epoch 00131: val\_acc did not improve from 0.85789
Epoch 132/500
2660/2660 [==============================] - 3s 941us/step - loss: 0.5290 - acc: 0.8508 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00132: val\_acc did not improve from 0.85789
Epoch 133/500
2660/2660 [==============================] - 2s 933us/step - loss: 0.5343 - acc: 0.8568 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00133: val\_acc did not improve from 0.85789
Epoch 134/500
2660/2660 [==============================] - 2s 933us/step - loss: 0.5333 - acc: 0.8538 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00134: val\_acc did not improve from 0.85789
Epoch 135/500
2660/2660 [==============================] - 2s 934us/step - loss: 0.5600 - acc: 0.8477 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00135: val\_acc did not improve from 0.85789
Epoch 136/500
2660/2660 [==============================] - 2s 925us/step - loss: 0.5413 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00136: ReduceLROnPlateau reducing learning rate to 2.0000003072687078e-30.

Epoch 00136: val\_acc did not improve from 0.85789
Epoch 137/500
2660/2660 [==============================] - 2s 924us/step - loss: 0.5478 - acc: 0.8470 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00137: val\_acc did not improve from 0.85789
Epoch 138/500
2660/2660 [==============================] - 2s 924us/step - loss: 0.5027 - acc: 0.8579 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00138: val\_acc did not improve from 0.85789
Epoch 139/500
2660/2660 [==============================] - 2s 922us/step - loss: 0.5657 - acc: 0.8398 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00139: val\_acc did not improve from 0.85789
Epoch 140/500
2660/2660 [==============================] - 2s 921us/step - loss: 0.5822 - acc: 0.8504 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00140: val\_acc did not improve from 0.85789
Epoch 141/500
2660/2660 [==============================] - 2s 918us/step - loss: 0.5448 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00141: ReduceLROnPlateau reducing learning rate to 2.000000382500346e-31.

Epoch 00141: val\_acc did not improve from 0.85789
Epoch 142/500
2660/2660 [==============================] - 2s 922us/step - loss: 0.5287 - acc: 0.8474 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00142: val\_acc did not improve from 0.85789
Epoch 143/500
2660/2660 [==============================] - 2s 915us/step - loss: 0.5774 - acc: 0.8429 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00143: val\_acc did not improve from 0.85789
Epoch 144/500
2660/2660 [==============================] - 2s 917us/step - loss: 0.5995 - acc: 0.8436 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00144: val\_acc did not improve from 0.85789
Epoch 145/500
2660/2660 [==============================] - 2s 915us/step - loss: 0.5568 - acc: 0.8496 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00145: val\_acc did not improve from 0.85789
Epoch 146/500
2660/2660 [==============================] - 2s 914us/step - loss: 0.5683 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00146: ReduceLROnPlateau reducing learning rate to 2.0000004295201202e-32.

Epoch 00146: val\_acc did not improve from 0.85789
Epoch 147/500
2660/2660 [==============================] - 2s 913us/step - loss: 0.5838 - acc: 0.8511 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00147: val\_acc did not improve from 0.85789
Epoch 148/500
2660/2660 [==============================] - 2s 913us/step - loss: 0.4909 - acc: 0.8511 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00148: val\_acc did not improve from 0.85789
Epoch 149/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5371 - acc: 0.8515 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00149: val\_acc did not improve from 0.85789
Epoch 150/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5497 - acc: 0.8462 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00150: val\_acc did not improve from 0.85789
Epoch 151/500
2660/2660 [==============================] - 2s 911us/step - loss: 0.5448 - acc: 0.8376 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00151: ReduceLROnPlateau reducing learning rate to 2.0000004882948376e-33.

Epoch 00151: val\_acc did not improve from 0.85789
Epoch 152/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5277 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00152: val\_acc did not improve from 0.85789
Epoch 153/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5754 - acc: 0.8402 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00153: val\_acc did not improve from 0.85789
Epoch 154/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.4831 - acc: 0.8519 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00154: val\_acc did not improve from 0.85789
Epoch 155/500
2660/2660 [==============================] - 2s 906us/step - loss: 0.6051 - acc: 0.8402 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00155: val\_acc did not improve from 0.85789
Epoch 156/500
2660/2660 [==============================] - 2s 904us/step - loss: 0.5019 - acc: 0.8530 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00156: ReduceLROnPlateau reducing learning rate to 2.0000004148264407e-34.

Epoch 00156: val\_acc did not improve from 0.85789
Epoch 157/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5291 - acc: 0.8496 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00157: val\_acc did not improve from 0.85789
Epoch 158/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5106 - acc: 0.8620 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00158: val\_acc did not improve from 0.85789
Epoch 159/500
2660/2660 [==============================] - 2s 906us/step - loss: 0.5123 - acc: 0.8470 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00159: val\_acc did not improve from 0.85789
Epoch 160/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5790 - acc: 0.8383 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00160: val\_acc did not improve from 0.85789
Epoch 161/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.5944 - acc: 0.8466 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00161: ReduceLROnPlateau reducing learning rate to 2.0000003229909445e-35.

Epoch 00161: val\_acc did not improve from 0.85789
Epoch 162/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.5315 - acc: 0.8575 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00162: val\_acc did not improve from 0.85789
Epoch 163/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.5166 - acc: 0.8590 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00163: val\_acc did not improve from 0.85789
Epoch 164/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.4863 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00164: val\_acc did not improve from 0.85789
Epoch 165/500
2660/2660 [==============================] - 2s 904us/step - loss: 0.5309 - acc: 0.8444 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00165: val\_acc did not improve from 0.85789
Epoch 166/500
2660/2660 [==============================] - 2s 901us/step - loss: 0.5248 - acc: 0.8462 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00166: ReduceLROnPlateau reducing learning rate to 2.0000003229909445e-36.

Epoch 00166: val\_acc did not improve from 0.85789
Epoch 167/500
2660/2660 [==============================] - 2s 901us/step - loss: 0.5492 - acc: 0.8545 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00167: val\_acc did not improve from 0.85789
Epoch 168/500
2660/2660 [==============================] - 2s 904us/step - loss: 0.5754 - acc: 0.8432 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00168: val\_acc did not improve from 0.85789
Epoch 169/500
2660/2660 [==============================] - 2s 905us/step - loss: 0.5302 - acc: 0.8500 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00169: val\_acc did not improve from 0.85789
Epoch 170/500
2660/2660 [==============================] - 2s 904us/step - loss: 0.5318 - acc: 0.8553 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00170: val\_acc did not improve from 0.85789
Epoch 171/500
2660/2660 [==============================] - 2s 902us/step - loss: 0.5397 - acc: 0.8515 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00171: ReduceLROnPlateau reducing learning rate to 2.0000002512444633e-37.

Epoch 00171: val\_acc did not improve from 0.85789
Epoch 172/500
2660/2660 [==============================] - 2s 902us/step - loss: 0.5032 - acc: 0.8511 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00172: val\_acc did not improve from 0.85789
Epoch 173/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.4960 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00173: val\_acc did not improve from 0.85789
Epoch 174/500
2660/2660 [==============================] - 2s 902us/step - loss: 0.5531 - acc: 0.8474 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00174: val\_acc did not improve from 0.85789
Epoch 175/500
2660/2660 [==============================] - 2s 903us/step - loss: 0.4824 - acc: 0.8530 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00175: val\_acc did not improve from 0.85789
Epoch 176/500
2660/2660 [==============================] - 2s 907us/step - loss: 0.5340 - acc: 0.8462 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00176: ReduceLROnPlateau reducing learning rate to 2.0000002064029123e-38.

Epoch 00176: val\_acc did not improve from 0.85789
Epoch 177/500
2660/2660 [==============================] - 2s 907us/step - loss: 0.5473 - acc: 0.8496 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00177: val\_acc did not improve from 0.85789
Epoch 178/500
1680/2660 [=================>{\ldots}] - ETA: 0s - loss: 0.5777 - acc: 0.8476
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
IOPub message rate exceeded.
The notebook server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--NotebookApp.iopub\_msg\_rate\_limit`.

Current values:
NotebookApp.iopub\_msg\_rate\_limit=1000.0 (msgs/sec)
NotebookApp.rate\_limit\_window=3.0 (secs)


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
2660/2660 [==============================] - 2s 921us/step - loss: 0.5263 - acc: 0.8481 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00201: ReduceLROnPlateau reducing learning rate to 1.9996529085915142e-43.

Epoch 00201: val\_acc did not improve from 0.85789
Epoch 202/500
2660/2660 [==============================] - 2s 911us/step - loss: 0.5118 - acc: 0.8556 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00202: val\_acc did not improve from 0.85789
Epoch 203/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5742 - acc: 0.8523 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00203: val\_acc did not improve from 0.85789
Epoch 204/500
2660/2660 [==============================] - 2s 909us/step - loss: 0.5323 - acc: 0.8485 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00204: val\_acc did not improve from 0.85789
Epoch 205/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5631 - acc: 0.8402 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00205: val\_acc did not improve from 0.85789
Epoch 206/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5282 - acc: 0.8541 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00206: ReduceLROnPlateau reducing learning rate to 2.0038568039844885e-44.

Epoch 00206: val\_acc did not improve from 0.85789
Epoch 207/500
2660/2660 [==============================] - 2s 908us/step - loss: 0.5462 - acc: 0.8444 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00207: val\_acc did not improve from 0.85789
Epoch 208/500
2660/2660 [==============================] - 2s 910us/step - loss: 0.5333 - acc: 0.8526 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00208: val\_acc did not improve from 0.85789
Epoch 209/500
2660/2660 [==============================] - 2s 911us/step - loss: 0.5293 - acc: 0.8534 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00209: val\_acc did not improve from 0.85789
Epoch 210/500
2660/2660 [==============================] - 2s 916us/step - loss: 0.5427 - acc: 0.8511 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00210: val\_acc did not improve from 0.85789
Epoch 211/500
2660/2660 [==============================] - 2s 917us/step - loss: 0.4599 - acc: 0.8624 - val\_loss: 0.5666 - val\_acc: 0.8553

Epoch 00211: ReduceLROnPlateau reducing learning rate to 1.961817850054744e-45.

Epoch 00211: val\_acc did not improve from 0.85789
Epoch 212/500
 592/2660 [=====>{\ldots}] - ETA: 1s - loss: 0.6624 - acc: 0.8530
    \end{Verbatim}

    \hypertarget{vgg-model}{%
\subsubsection{4.2.2 VGG Model}\label{vgg-model}}

    \hypertarget{prepare-load-data}{%
\paragraph{4.2.2.1 Prepare \& Load Data}\label{prepare-load-data}}

    The \texttt{VGG} model \texttt{input} dimesions are
\texttt{224\ *\ 224\ *\ 3}. Hence we need to prepare images satisfying
the dimensional requirements.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{n}{images\PYZus{}vgg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
         
         \PY{k}{try}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading VGG Images \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{images\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{labels\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG Images \PYZam{} Labels dict does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{images\PYZus{}vgg}\PY{o}{.}\PY{n}{size} \PY{o+ow}{or} \PY{o+ow}{not} \PY{n}{labels\PYZus{}vgg}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{:}
             \PY{n}{img\PYZus{}size} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{224}\PY{p}{,} \PY{l+m+mi}{224}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Running load\PYZus{}seedlings method with img\PYZus{}size }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ ...}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{img\PYZus{}size}\PY{p}{)}\PY{p}{)}
             \PY{n}{images\PYZus{}vgg}\PY{p}{,} \PY{n}{labels\PYZus{}vgg}\PY{p}{,} \PY{n}{images\PYZus{}per\PYZus{}class} \PY{o}{=} \PY{n}{load\PYZus{}seedlings\PYZus{}transfer}\PY{p}{(}
                 \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{n}{img\PYZus{}size}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping VGG Images \PYZam{} Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{c+c1}{\PYZsh{} Dumping dicts}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{labels\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{labels\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG Images \PYZam{} Labels dict dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading VGG Images, Labels \& images\_per\_class dict {\ldots}
Stacktrace [Errno 2] No such file or directory: './save/pickles/images-vgg.pickle'
VGG Images, Labels or images\_per\_class dict does not exist.
Running load\_seedlings method with img\_size (224, 224) {\ldots}
Dumping VGG Images, Labels \& images\_per\_class dict {\ldots}
VGG Images, Labels or images\_per\_class dict dumping done.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{c+c1}{\PYZsh{} Type cast int to float for VGG16 model compatibility}
         
         \PY{n}{images\PYZus{}vgg} \PY{o}{=} \PY{n}{images\PYZus{}vgg}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{copy}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}vgg}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Labels Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labels\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Label Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labels\PYZus{}vgg}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Images Shape: (4750, 224, 224, 3)
Image Data Type: float32
Labels Shape: (4750,)
Label Data Type: <U10

    \end{Verbatim}

    \hypertarget{extract-vgg-bottleneck-features}{%
\paragraph{4.2.2.2 Extract VGG Bottleneck
Features}\label{extract-vgg-bottleneck-features}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{o}{\PYZpc{}}\PY{k}{time}
         
         \PY{n}{input\PYZus{}dim} \PY{o}{=} \PY{l+m+mi}{224}
         \PY{n}{POOLING} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
         
         \PY{c+c1}{\PYZsh{} Numpy array to store extracted features from VGG model}
         \PY{n}{images\PYZus{}vgg\PYZus{}features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}
             \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{images\PYZus{}vgg}\PY{p}{)}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Extract features with Xception model}
         \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n}{tqdm}\PY{p}{(}\PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{images\PYZus{}vgg}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{images\PYZus{}vgg\PYZus{}features}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{vgg16}\PY{o}{.}\PY{n}{preprocess\PYZus{}input}\PY{p}{(}
                 \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Images shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{images\PYZus{}vgg\PYZus{}features}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{images\PYZus{}vgg\PYZus{}features}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
109it [00:00, 1087.22it/s]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
CPU times: user 0 ns, sys: 10 µs, total: 10 µs
Wall time: 19.1 µs

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
4750it [00:02, 1954.69it/s]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Train Images shape: (4750, 224, 224, 3) size: 715,008,000

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]


    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{} Split the data in train \PYZam{} validation set}
         \PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}\PY{n}{images\PYZus{}vgg\PYZus{}features}\PY{p}{,}
                                                               \PY{n}{labels\PYZus{}vgg}\PY{p}{,}
                                                               \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}
                                                               \PY{n}{train\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,}
                                                               \PY{n}{stratify}\PY{o}{=}\PY{n}{labels\PYZus{}vgg}\PY{p}{,}
                                                               \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{n}{RANDOM\PYZus{}STATE}
                                                               \PY{p}{)}
         
         \PY{k}{del} \PY{n}{images\PYZus{}vgg\PYZus{}features}\PY{p}{,} \PY{n}{labels\PYZus{}vgg}
         
         \PY{c+c1}{\PYZsh{} VGG16 model, with weights pre\PYZhy{}trained on ImageNet. This model can be built both with}
         \PY{c+c1}{\PYZsh{} \PYZsq{}channels\PYZus{}first\PYZsq{} data format (channels, height, width) or \PYZsq{}channels\PYZus{}last\PYZsq{} data format (height, width, channels).}
         \PY{c+c1}{\PYZsh{} The default input size for this model is 224x224.}
         
         \PY{n}{vgg\PYZus{}bottleneck} \PY{o}{=} \PY{n}{vgg16}\PY{o}{.}\PY{n}{VGG16}\PY{p}{(}
             \PY{n}{weights}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{imagenet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{include\PYZus{}top}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{pooling}\PY{o}{=}\PY{n}{POOLING}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Calculating VGG train \PYZam{} valid set bottleneck features}
         \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{vgg\PYZus{}bottleneck}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{vgg\PYZus{}bottleneck}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         
         \PY{k}{del} \PY{n}{x\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG train bottleneck features shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG valid bottleneck features shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
             \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} Dumping VGG train \PYZam{} valid set bottleneck features}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping VGG train \PYZam{} valid set bottleneck features \PYZam{} labels done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
3800/3800 [==============================] - 74s 20ms/step
950/950 [==============================] - 13s 14ms/step
VGG train bottleneck features shape: (3800, 512) size: 1,945,600
VGG valid bottleneck features shape: (950, 512) size: 486,400
Dumping VGG train \& valid set bottleneck features \& labels done.

    \end{Verbatim}

    \hypertarget{training-a-keras-dense-model}{%
\paragraph{4.2.2.3 Training a Keras Dense
Model}\label{training-a-keras-dense-model}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading VGG Images, Labels dict ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        
        \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading VGG train \PYZam{} valid set bottleneck features \PYZam{} labels done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading VGG Images, Labels \& images\_per\_class dict {\ldots}
Loading VGG train \& valid set bottleneck features \& labels done.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{c+c1}{\PYZsh{} Define Model Neural Network Architecture}
        
        
        \PY{k}{def} \PY{n+nf}{model\PYZus{}neural\PYZus{}network\PYZus{}vgg}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        
            \PY{c+c1}{\PYZsh{} Model Neural Network Architecture}
            \PY{n}{inputs} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{512}\PY{p}{,}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Adding 1st Fully connected, output layer \PYZam{} Dropout}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{512}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{512}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{inputs}\PY{p}{)}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.3}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Adding 2nd Fully connected, output layer \PYZam{} Dropout}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{256}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.2}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Adding 3rd Fully connected, output layer \PYZam{} Dropout}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
            \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Adding output layer}
            \PY{n}{outputs} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{softmax}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
            \PY{n}{model} \PY{o}{=} \PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{n}{inputs}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{n}{outputs}\PY{p}{)}
        
            \PY{n}{mypotim} \PY{o}{=} \PY{n}{Adam}\PY{p}{(}\PY{n}{lr}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,} \PY{n}{beta\PYZus{}1}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{beta\PYZus{}2}\PY{o}{=}\PY{l+m+mf}{0.999}\PY{p}{,} \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}08}\PY{p}{)}
            \PY{c+c1}{\PYZsh{}mypotim = SGD(lr=1 * 1e\PYZhy{}1, momentum=0.9, nesterov=True)}
            \PY{n}{model}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{categorical\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{n}{optimizer}\PY{o}{=}\PY{n}{mypotim}\PY{p}{,}
                          \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
            \PY{c+c1}{\PYZsh{} Model Summary}
            \PY{c+c1}{\PYZsh{} model.summary()}
        
            \PY{k}{return} \PY{n}{model}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{o}{\PYZpc{}} \PY{o}{\PYZpc{}} \PY{n}{time}
        
        \PY{n}{BATCH\PYZus{}SIZE} \PY{o}{=} \PY{l+m+mi}{16}
        \PY{n}{EPOCHS} \PY{o}{=} \PY{l+m+mi}{500}
        \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
        \PY{c+c1}{\PYZsh{} Fixing random seed}
        \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{n}{RANDOM\PYZus{}STATE}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Reduce LR On Plateau}
        \PY{n}{lr\PYZus{}reduced} \PY{o}{=} \PY{n}{ReduceLROnPlateau}\PY{p}{(}
            \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{factor}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}5}\PY{p}{,} \PY{n}{patience}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Setting checkpoint \PYZam{} early stopping}
        \PY{n}{checkpoint\PYZus{}path} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint/VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.}\PY{l+s+si}{\PYZob{}epoch:02d\PYZcb{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+si}{\PYZob{}acc:.4f\PYZcb{}}\PY{l+s+s1}{.hdf5}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{checkpoint} \PY{o}{=} \PY{n}{ModelCheckpoint}\PY{p}{(}
            \PY{n}{checkpoint\PYZus{}path}\PY{p}{,} \PY{n}{monitor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{val\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{save\PYZus{}best\PYZus{}only}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{mode}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} TensorBoard logs}
        \PY{n}{tensorboard} \PY{o}{=} \PY{n}{TensorBoard}\PY{p}{(}
            \PY{n}{log\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./logs}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{histogram\PYZus{}freq}\PY{o}{=}\PY{l+m+mi}{2000}\PY{p}{,} \PY{n}{write\PYZus{}graph}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{write\PYZus{}images}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Early Stopping}
        \PY{c+c1}{\PYZsh{} early\PYZus{}stop = EarlyStopping(monitor=\PYZsq{}val\PYZus{}acc\PYZsq{}, patience=5, mode=\PYZsq{}max\PYZsq{})}
        
        \PY{c+c1}{\PYZsh{} All callbacks}
        \PY{n}{callbacks\PYZus{}list} \PY{o}{=} \PY{p}{[}\PY{n}{lr\PYZus{}reduced}\PY{p}{,} \PY{n}{checkpoint}\PY{p}{,} \PY{n}{tensorboard}\PY{p}{]}
        
        
        \PY{c+c1}{\PYZsh{} Model Neural Network Architecture}
        \PY{n}{inputs} \PY{o}{=} \PY{n}{Input}\PY{p}{(}\PY{n}{shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{512}\PY{p}{,}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 1st Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{512}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{512}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{inputs}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.3}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 2nd Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{256}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{256}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.2}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding 3rd Fully connected, output layer \PYZam{} Dropout}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{input\PYZus{}shape}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{128}\PY{p}{,}\PY{p}{)}\PY{p}{,} \PY{n}{units}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        \PY{n}{fc} \PY{o}{=} \PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.1}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Adding output layer}
        \PY{n}{outputs} \PY{o}{=} \PY{n}{Dense}\PY{p}{(}\PY{n}{units}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{softmax}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{(}\PY{n}{fc}\PY{p}{)}
        
        \PY{n}{model} \PY{o}{=} \PY{n}{Model}\PY{p}{(}\PY{n}{inputs}\PY{o}{=}\PY{n}{inputs}\PY{p}{,} \PY{n}{outputs}\PY{o}{=}\PY{n}{outputs}\PY{p}{)}
        
        
        \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.24\PYZhy{}0.9872.hdf5}\PY{l+s+s1}{\PYZsq{}}
        \PY{c+c1}{\PYZsh{} Load network weights}
        \PY{k}{if} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading weights from previous run...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Weights not loaded.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
        
        \PY{n}{mypotim} \PY{o}{=} \PY{n}{Adam}\PY{p}{(}\PY{n}{lr}\PY{o}{=}\PY{l+m+mi}{2} \PY{o}{*} \PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,} \PY{n}{beta\PYZus{}1}\PY{o}{=}\PY{l+m+mf}{0.9}\PY{p}{,} \PY{n}{beta\PYZus{}2}\PY{o}{=}\PY{l+m+mf}{0.999}\PY{p}{,} \PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1e\PYZhy{}08}\PY{p}{)}
        \PY{c+c1}{\PYZsh{}mypotim = SGD(lr=1 * 1e\PYZhy{}1, momentum=0.9, nesterov=True)}
        \PY{n}{model}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{categorical\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                      \PY{n}{optimizer}\PY{o}{=}\PY{n}{mypotim}\PY{p}{,}
                      \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} Model Summary}
        \PY{n}{model}\PY{o}{.}\PY{n}{summary}\PY{p}{(}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Convert categorical labels into one\PYZhy{}hot vector}
        \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}train}\PY{p}{]}\PY{p}{)}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Fit the model}
        \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{validation\PYZus{}split}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{n}{BATCH\PYZus{}SIZE}\PY{p}{,}
                  \PY{n}{epochs}\PY{o}{=}\PY{n}{EPOCHS}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{callbacks}\PY{o}{=}\PY{n}{callbacks\PYZus{}list}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
/home/indiano/miniconda3/envs/tf/lib/python3.5/site-packages/keras/callbacks.py:999: UserWarning: `epsilon` argument is deprecated and will be removed, use `min\_delta` instead.
  warnings.warn('`epsilon` argument is deprecated and '

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Loading weights from previous run{\ldots} VGG\_ADAM\_best\_weights.24-0.9872.hdf5
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Layer (type)                 Output Shape              Param \#   
=================================================================
input\_1 (InputLayer)         (None, 512)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_1 (Dense)              (None, 512)               262656    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_1 (Dropout)          (None, 512)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_2 (Dense)              (None, 256)               131328    
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_2 (Dropout)          (None, 256)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_3 (Dense)              (None, 128)               32896     
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dropout\_3 (Dropout)          (None, 128)               0         
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
dense\_4 (Dense)              (None, 12)                1548      
=================================================================
Total params: 428,428
Trainable params: 428,428
Non-trainable params: 0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

Epoch 00001: val\_acc improved from -inf to 0.84035, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.01-0.9447.hdf5

Epoch 00002: val\_acc did not improve from 0.84035

Epoch 00003: val\_acc did not improve from 0.84035

Epoch 00004: val\_acc improved from 0.84035 to 0.84561, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.04-0.9316.hdf5

Epoch 00005: val\_acc did not improve from 0.84561

Epoch 00006: val\_acc did not improve from 0.84561

Epoch 00007: val\_acc did not improve from 0.84561

Epoch 00008: val\_acc did not improve from 0.84561

Epoch 00009: ReduceLROnPlateau reducing learning rate to 0.00020000000949949026.

Epoch 00009: val\_acc did not improve from 0.84561

Epoch 00010: val\_acc improved from 0.84561 to 0.86140, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.10-0.9602.hdf5

Epoch 00011: val\_acc improved from 0.86140 to 0.86491, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.11-0.9741.hdf5

Epoch 00012: val\_acc improved from 0.86491 to 0.86754, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.12-0.9805.hdf5

Epoch 00013: val\_acc improved from 0.86754 to 0.86842, saving model to ./checkpoint/VGG\_ADAM\_best\_weights.13-0.9786.hdf5

Epoch 00014: val\_acc did not improve from 0.86842

Epoch 00015: val\_acc did not improve from 0.86842

Epoch 00016: val\_acc did not improve from 0.86842

Epoch 00017: val\_acc did not improve from 0.86842

Epoch 00018: ReduceLROnPlateau reducing learning rate to 2.0000000949949027e-05.

Epoch 00018: val\_acc did not improve from 0.86842

Epoch 00019: val\_acc did not improve from 0.86842

Epoch 00020: val\_acc did not improve from 0.86842

Epoch 00021: val\_acc did not improve from 0.86842

Epoch 00022: val\_acc did not improve from 0.86842

Epoch 00023: ReduceLROnPlateau reducing learning rate to 2.0000001313746906e-06.

Epoch 00023: val\_acc did not improve from 0.86842

Epoch 00024: val\_acc did not improve from 0.86842

Epoch 00025: val\_acc did not improve from 0.86842

Epoch 00026: val\_acc did not improve from 0.86842

Epoch 00027: val\_acc did not improve from 0.86842

Epoch 00028: ReduceLROnPlateau reducing learning rate to 2.000000222324161e-07.

Epoch 00028: val\_acc did not improve from 0.86842

Epoch 00029: val\_acc did not improve from 0.86842

Epoch 00030: val\_acc did not improve from 0.86842

Epoch 00031: val\_acc did not improve from 0.86842

Epoch 00032: val\_acc did not improve from 0.86842

Epoch 00033: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-08.

Epoch 00033: val\_acc did not improve from 0.86842

Epoch 00034: val\_acc did not improve from 0.86842

Epoch 00035: val\_acc did not improve from 0.86842

Epoch 00036: val\_acc did not improve from 0.86842

Epoch 00037: val\_acc did not improve from 0.86842

Epoch 00038: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-09.

Epoch 00038: val\_acc did not improve from 0.86842

Epoch 00039: val\_acc did not improve from 0.86842

Epoch 00040: val\_acc did not improve from 0.86842

Epoch 00041: val\_acc did not improve from 0.86842

Epoch 00042: val\_acc did not improve from 0.86842

Epoch 00043: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-10.

Epoch 00043: val\_acc did not improve from 0.86842

Epoch 00044: val\_acc did not improve from 0.86842

Epoch 00045: val\_acc did not improve from 0.86842

Epoch 00046: val\_acc did not improve from 0.86842

Epoch 00047: val\_acc did not improve from 0.86842

Epoch 00048: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-11.

Epoch 00048: val\_acc did not improve from 0.86842

Epoch 00049: val\_acc did not improve from 0.86842

Epoch 00050: val\_acc did not improve from 0.86842

Epoch 00051: val\_acc did not improve from 0.86842

Epoch 00052: val\_acc did not improve from 0.86842

Epoch 00053: ReduceLROnPlateau reducing learning rate to 2.000000165480742e-12.

Epoch 00053: val\_acc did not improve from 0.86842

Epoch 00054: val\_acc did not improve from 0.86842

Epoch 00055: val\_acc did not improve from 0.86842

Epoch 00056: val\_acc did not improve from 0.86842

Epoch 00057: val\_acc did not improve from 0.86842

Epoch 00058: ReduceLROnPlateau reducing learning rate to 2.000000208848829e-13.

Epoch 00058: val\_acc did not improve from 0.86842

Epoch 00059: val\_acc did not improve from 0.86842

Epoch 00060: val\_acc did not improve from 0.86842

Epoch 00061: val\_acc did not improve from 0.86842

Epoch 00062: val\_acc did not improve from 0.86842

Epoch 00063: ReduceLROnPlateau reducing learning rate to 2.0000002359538835e-14.

Epoch 00063: val\_acc did not improve from 0.86842

Epoch 00064: val\_acc did not improve from 0.86842

Epoch 00065: val\_acc did not improve from 0.86842

Epoch 00066: val\_acc did not improve from 0.86842

Epoch 00067: val\_acc did not improve from 0.86842

Epoch 00068: ReduceLROnPlateau reducing learning rate to 2.000000303716519e-15.

Epoch 00068: val\_acc did not improve from 0.86842

Epoch 00069: val\_acc did not improve from 0.86842

Epoch 00070: val\_acc did not improve from 0.86842

Epoch 00071: val\_acc did not improve from 0.86842

Epoch 00072: val\_acc did not improve from 0.86842

Epoch 00073: ReduceLROnPlateau reducing learning rate to 2.0000002190132243e-16.

Epoch 00073: val\_acc did not improve from 0.86842

Epoch 00074: val\_acc did not improve from 0.86842

Epoch 00075: val\_acc did not improve from 0.86842

Epoch 00076: val\_acc did not improve from 0.86842

Epoch 00077: val\_acc did not improve from 0.86842

Epoch 00078: ReduceLROnPlateau reducing learning rate to 2.0000001660736652e-17.

Epoch 00078: val\_acc did not improve from 0.86842

Epoch 00079: val\_acc did not improve from 0.86842

Epoch 00080: val\_acc did not improve from 0.86842

Epoch 00081: val\_acc did not improve from 0.86842

Epoch 00082: val\_acc did not improve from 0.86842

Epoch 00083: ReduceLROnPlateau reducing learning rate to 2.0000001329864408e-18.

Epoch 00083: val\_acc did not improve from 0.86842

Epoch 00084: val\_acc did not improve from 0.86842

Epoch 00085: val\_acc did not improve from 0.86842

Epoch 00086: val\_acc did not improve from 0.86842

Epoch 00087: val\_acc did not improve from 0.86842

Epoch 00088: ReduceLROnPlateau reducing learning rate to 2.00000009162741e-19.

Epoch 00088: val\_acc did not improve from 0.86842

Epoch 00089: val\_acc did not improve from 0.86842

Epoch 00090: val\_acc did not improve from 0.86842

Epoch 00091: val\_acc did not improve from 0.86842

Epoch 00092: val\_acc did not improve from 0.86842

Epoch 00093: ReduceLROnPlateau reducing learning rate to 2.000000065778016e-20.

Epoch 00093: val\_acc did not improve from 0.86842

Epoch 00094: val\_acc did not improve from 0.86842

Epoch 00095: val\_acc did not improve from 0.86842

Epoch 00096: val\_acc did not improve from 0.86842

Epoch 00097: val\_acc did not improve from 0.86842

Epoch 00098: ReduceLROnPlateau reducing learning rate to 2.0000000980897586e-21.

Epoch 00098: val\_acc did not improve from 0.86842

Epoch 00099: val\_acc did not improve from 0.86842

Epoch 00100: val\_acc did not improve from 0.86842

Epoch 00101: val\_acc did not improve from 0.86842

Epoch 00102: val\_acc did not improve from 0.86842

Epoch 00103: ReduceLROnPlateau reducing learning rate to 2.000000138479437e-22.

Epoch 00103: val\_acc did not improve from 0.86842

Epoch 00104: val\_acc did not improve from 0.86842

Epoch 00105: val\_acc did not improve from 0.86842

Epoch 00106: val\_acc did not improve from 0.86842

Epoch 00107: val\_acc did not improve from 0.86842

Epoch 00108: ReduceLROnPlateau reducing learning rate to 2.000000188966535e-23.

Epoch 00108: val\_acc did not improve from 0.86842

Epoch 00109: val\_acc did not improve from 0.86842

Epoch 00110: val\_acc did not improve from 0.86842

Epoch 00111: val\_acc did not improve from 0.86842

Epoch 00112: val\_acc did not improve from 0.86842

Epoch 00113: ReduceLROnPlateau reducing learning rate to 2.000000157412099e-24.

Epoch 00113: val\_acc did not improve from 0.86842

Epoch 00114: val\_acc did not improve from 0.86842

Epoch 00115: val\_acc did not improve from 0.86842

Epoch 00116: val\_acc did not improve from 0.86842

Epoch 00117: val\_acc did not improve from 0.86842

Epoch 00118: ReduceLROnPlateau reducing learning rate to 2.0000002362981892e-25.

Epoch 00118: val\_acc did not improve from 0.86842

Epoch 00119: val\_acc did not improve from 0.86842

Epoch 00120: val\_acc did not improve from 0.86842

Epoch 00121: val\_acc did not improve from 0.86842

Epoch 00122: val\_acc did not improve from 0.86842

Epoch 00123: ReduceLROnPlateau reducing learning rate to 2.0000002856019956e-26.

Epoch 00123: val\_acc did not improve from 0.86842

Epoch 00124: val\_acc did not improve from 0.86842

Epoch 00125: val\_acc did not improve from 0.86842

Epoch 00126: val\_acc did not improve from 0.86842

Epoch 00127: val\_acc did not improve from 0.86842

Epoch 00128: ReduceLROnPlateau reducing learning rate to 2.000000285601996e-27.

Epoch 00128: val\_acc did not improve from 0.86842

Epoch 00129: val\_acc did not improve from 0.86842

Epoch 00130: val\_acc did not improve from 0.86842

Epoch 00131: val\_acc did not improve from 0.86842

Epoch 00132: val\_acc did not improve from 0.86842

Epoch 00133: ReduceLROnPlateau reducing learning rate to 2.0000002470833968e-28.

Epoch 00133: val\_acc did not improve from 0.86842

Epoch 00134: val\_acc did not improve from 0.86842

Epoch 00135: val\_acc did not improve from 0.86842

Epoch 00136: val\_acc did not improve from 0.86842

Epoch 00137: val\_acc did not improve from 0.86842

Epoch 00138: ReduceLROnPlateau reducing learning rate to 2.000000247083397e-29.

Epoch 00138: val\_acc did not improve from 0.86842

Epoch 00139: val\_acc did not improve from 0.86842

Epoch 00140: val\_acc did not improve from 0.86842

Epoch 00141: val\_acc did not improve from 0.86842

Epoch 00142: val\_acc did not improve from 0.86842

Epoch 00143: ReduceLROnPlateau reducing learning rate to 2.0000003072687078e-30.

Epoch 00143: val\_acc did not improve from 0.86842

Epoch 00144: val\_acc did not improve from 0.86842

Epoch 00145: val\_acc did not improve from 0.86842

Epoch 00146: val\_acc did not improve from 0.86842

Epoch 00147: val\_acc did not improve from 0.86842

Epoch 00148: ReduceLROnPlateau reducing learning rate to 2.000000382500346e-31.

Epoch 00148: val\_acc did not improve from 0.86842

Epoch 00149: val\_acc did not improve from 0.86842

Epoch 00150: val\_acc did not improve from 0.86842

Epoch 00151: val\_acc did not improve from 0.86842

Epoch 00152: val\_acc did not improve from 0.86842

Epoch 00153: ReduceLROnPlateau reducing learning rate to 2.0000004295201202e-32.

Epoch 00153: val\_acc did not improve from 0.86842

Epoch 00154: val\_acc did not improve from 0.86842

Epoch 00155: val\_acc did not improve from 0.86842

Epoch 00156: val\_acc did not improve from 0.86842

Epoch 00157: val\_acc did not improve from 0.86842

Epoch 00158: ReduceLROnPlateau reducing learning rate to 2.0000004882948376e-33.

Epoch 00158: val\_acc did not improve from 0.86842

Epoch 00159: val\_acc did not improve from 0.86842

Epoch 00160: val\_acc did not improve from 0.86842

Epoch 00161: val\_acc did not improve from 0.86842

Epoch 00162: val\_acc did not improve from 0.86842

Epoch 00163: ReduceLROnPlateau reducing learning rate to 2.0000004148264407e-34.

Epoch 00163: val\_acc did not improve from 0.86842

Epoch 00164: val\_acc did not improve from 0.86842

Epoch 00165: val\_acc did not improve from 0.86842

Epoch 00166: val\_acc did not improve from 0.86842

Epoch 00167: val\_acc did not improve from 0.86842

Epoch 00168: ReduceLROnPlateau reducing learning rate to 2.0000003229909445e-35.

Epoch 00168: val\_acc did not improve from 0.86842

Epoch 00169: val\_acc did not improve from 0.86842

Epoch 00170: val\_acc did not improve from 0.86842

Epoch 00171: val\_acc did not improve from 0.86842

Epoch 00172: val\_acc did not improve from 0.86842

Epoch 00173: ReduceLROnPlateau reducing learning rate to 2.0000003229909445e-36.

Epoch 00173: val\_acc did not improve from 0.86842

Epoch 00174: val\_acc did not improve from 0.86842

Epoch 00175: val\_acc did not improve from 0.86842

Epoch 00176: val\_acc did not improve from 0.86842

Epoch 00177: val\_acc did not improve from 0.86842

Epoch 00178: ReduceLROnPlateau reducing learning rate to 2.0000002512444633e-37.

Epoch 00178: val\_acc did not improve from 0.86842

Epoch 00179: val\_acc did not improve from 0.86842

Epoch 00180: val\_acc did not improve from 0.86842

Epoch 00181: val\_acc did not improve from 0.86842

Epoch 00182: val\_acc did not improve from 0.86842

Epoch 00183: ReduceLROnPlateau reducing learning rate to 2.0000002064029123e-38.

Epoch 00183: val\_acc did not improve from 0.86842

Epoch 00184: val\_acc did not improve from 0.86842

Epoch 00185: val\_acc did not improve from 0.86842

Epoch 00186: val\_acc did not improve from 0.86842

Epoch 00187: val\_acc did not improve from 0.86842

Epoch 00188: ReduceLROnPlateau reducing learning rate to 2.0000001503509737e-39.

Epoch 00188: val\_acc did not improve from 0.86842

Epoch 00189: val\_acc did not improve from 0.86842

Epoch 00190: val\_acc did not improve from 0.86842

Epoch 00191: val\_acc did not improve from 0.86842

Epoch 00192: val\_acc did not improve from 0.86842

Epoch 00193: ReduceLROnPlateau reducing learning rate to 2.0000004306106668e-40.

Epoch 00193: val\_acc did not improve from 0.86842

Epoch 00194: val\_acc did not improve from 0.86842

Epoch 00195: val\_acc did not improve from 0.86842

Epoch 00196: val\_acc did not improve from 0.86842

Epoch 00197: val\_acc did not improve from 0.86842

Epoch 00198: ReduceLROnPlateau reducing learning rate to 2.0000032332075952e-41.

Epoch 00198: val\_acc did not improve from 0.86842

Epoch 00199: val\_acc did not improve from 0.86842

Epoch 00200: val\_acc did not improve from 0.86842

Epoch 00201: val\_acc did not improve from 0.86842

Epoch 00202: val\_acc did not improve from 0.86842

Epoch 00203: ReduceLROnPlateau reducing learning rate to 1.999933168284379e-42.

Epoch 00203: val\_acc did not improve from 0.86842

Epoch 00204: val\_acc did not improve from 0.86842

Epoch 00205: val\_acc did not improve from 0.86842

Epoch 00206: val\_acc did not improve from 0.86842

Epoch 00207: val\_acc did not improve from 0.86842

Epoch 00208: ReduceLROnPlateau reducing learning rate to 1.9996529085915142e-43.

Epoch 00208: val\_acc did not improve from 0.86842

Epoch 00209: val\_acc did not improve from 0.86842

Epoch 00210: val\_acc did not improve from 0.86842

Epoch 00211: val\_acc did not improve from 0.86842

Epoch 00212: val\_acc did not improve from 0.86842

Epoch 00213: ReduceLROnPlateau reducing learning rate to 2.0038568039844885e-44.

Epoch 00213: val\_acc did not improve from 0.86842

Epoch 00214: val\_acc did not improve from 0.86842

Epoch 00215: val\_acc did not improve from 0.86842

Epoch 00216: val\_acc did not improve from 0.86842

Epoch 00217: val\_acc did not improve from 0.86842

Epoch 00218: ReduceLROnPlateau reducing learning rate to 1.961817850054744e-45.

Epoch 00218: val\_acc did not improve from 0.86842

Epoch 00219: val\_acc did not improve from 0.86842

Epoch 00220: val\_acc did not improve from 0.86842

Epoch 00221: val\_acc did not improve from 0.86842

Epoch 00222: val\_acc did not improve from 0.86842

Epoch 00223: ReduceLROnPlateau reducing learning rate to 1.4012984643248171e-46.

Epoch 00223: val\_acc did not improve from 0.86842

Epoch 00224: val\_acc did not improve from 0.86842

Epoch 00225: val\_acc did not improve from 0.86842

Epoch 00226: val\_acc did not improve from 0.86842

Epoch 00227: val\_acc did not improve from 0.86842

Epoch 00228: val\_acc did not improve from 0.86842

Epoch 00229: val\_acc did not improve from 0.86842

Epoch 00230: val\_acc did not improve from 0.86842

Epoch 00231: val\_acc did not improve from 0.86842

Epoch 00232: val\_acc did not improve from 0.86842

Epoch 00233: val\_acc did not improve from 0.86842

Epoch 00234: val\_acc did not improve from 0.86842

Epoch 00235: val\_acc did not improve from 0.86842

Epoch 00236: val\_acc did not improve from 0.86842

Epoch 00237: val\_acc did not improve from 0.86842

Epoch 00238: val\_acc did not improve from 0.86842

Epoch 00239: val\_acc did not improve from 0.86842

Epoch 00240: val\_acc did not improve from 0.86842

Epoch 00241: val\_acc did not improve from 0.86842

Epoch 00242: val\_acc did not improve from 0.86842

Epoch 00243: val\_acc did not improve from 0.86842

Epoch 00244: val\_acc did not improve from 0.86842

Epoch 00245: val\_acc did not improve from 0.86842

Epoch 00246: val\_acc did not improve from 0.86842

Epoch 00247: val\_acc did not improve from 0.86842

Epoch 00248: val\_acc did not improve from 0.86842

Epoch 00249: val\_acc did not improve from 0.86842

Epoch 00250: val\_acc did not improve from 0.86842

Epoch 00251: val\_acc did not improve from 0.86842

Epoch 00252: val\_acc did not improve from 0.86842

Epoch 00253: val\_acc did not improve from 0.86842

Epoch 00254: val\_acc did not improve from 0.86842

Epoch 00255: val\_acc did not improve from 0.86842

Epoch 00256: val\_acc did not improve from 0.86842

Epoch 00257: val\_acc did not improve from 0.86842

Epoch 00258: val\_acc did not improve from 0.86842

Epoch 00259: val\_acc did not improve from 0.86842

Epoch 00260: val\_acc did not improve from 0.86842

Epoch 00261: val\_acc did not improve from 0.86842

Epoch 00262: val\_acc did not improve from 0.86842

Epoch 00263: val\_acc did not improve from 0.86842

Epoch 00264: val\_acc did not improve from 0.86842

Epoch 00265: val\_acc did not improve from 0.86842

Epoch 00266: val\_acc did not improve from 0.86842

Epoch 00267: val\_acc did not improve from 0.86842

Epoch 00268: val\_acc did not improve from 0.86842

Epoch 00269: val\_acc did not improve from 0.86842

Epoch 00270: val\_acc did not improve from 0.86842

Epoch 00271: val\_acc did not improve from 0.86842

Epoch 00272: val\_acc did not improve from 0.86842

Epoch 00273: val\_acc did not improve from 0.86842

Epoch 00274: val\_acc did not improve from 0.86842

Epoch 00275: val\_acc did not improve from 0.86842

Epoch 00276: val\_acc did not improve from 0.86842

Epoch 00277: val\_acc did not improve from 0.86842

Epoch 00278: val\_acc did not improve from 0.86842

Epoch 00279: val\_acc did not improve from 0.86842

Epoch 00280: val\_acc did not improve from 0.86842

Epoch 00281: val\_acc did not improve from 0.86842

Epoch 00282: val\_acc did not improve from 0.86842

Epoch 00283: val\_acc did not improve from 0.86842

Epoch 00284: val\_acc did not improve from 0.86842

Epoch 00285: val\_acc did not improve from 0.86842

Epoch 00286: val\_acc did not improve from 0.86842

Epoch 00287: val\_acc did not improve from 0.86842

Epoch 00288: val\_acc did not improve from 0.86842

Epoch 00289: val\_acc did not improve from 0.86842

Epoch 00290: val\_acc did not improve from 0.86842

Epoch 00291: val\_acc did not improve from 0.86842

Epoch 00292: val\_acc did not improve from 0.86842

Epoch 00293: val\_acc did not improve from 0.86842

Epoch 00294: val\_acc did not improve from 0.86842

Epoch 00295: val\_acc did not improve from 0.86842

Epoch 00296: val\_acc did not improve from 0.86842

Epoch 00297: val\_acc did not improve from 0.86842

Epoch 00298: val\_acc did not improve from 0.86842

Epoch 00299: val\_acc did not improve from 0.86842

Epoch 00300: val\_acc did not improve from 0.86842

Epoch 00301: val\_acc did not improve from 0.86842

Epoch 00302: val\_acc did not improve from 0.86842

Epoch 00303: val\_acc did not improve from 0.86842

Epoch 00304: val\_acc did not improve from 0.86842

Epoch 00305: val\_acc did not improve from 0.86842

Epoch 00306: val\_acc did not improve from 0.86842

Epoch 00307: val\_acc did not improve from 0.86842

Epoch 00308: val\_acc did not improve from 0.86842

Epoch 00309: val\_acc did not improve from 0.86842

Epoch 00310: val\_acc did not improve from 0.86842

Epoch 00311: val\_acc did not improve from 0.86842

Epoch 00312: val\_acc did not improve from 0.86842

Epoch 00313: val\_acc did not improve from 0.86842

Epoch 00314: val\_acc did not improve from 0.86842

Epoch 00315: val\_acc did not improve from 0.86842

Epoch 00316: val\_acc did not improve from 0.86842

Epoch 00317: val\_acc did not improve from 0.86842

Epoch 00318: val\_acc did not improve from 0.86842

Epoch 00319: val\_acc did not improve from 0.86842

Epoch 00320: val\_acc did not improve from 0.86842

Epoch 00321: val\_acc did not improve from 0.86842

Epoch 00322: val\_acc did not improve from 0.86842

Epoch 00323: val\_acc did not improve from 0.86842

Epoch 00324: val\_acc did not improve from 0.86842

Epoch 00325: val\_acc did not improve from 0.86842

Epoch 00326: val\_acc did not improve from 0.86842

Epoch 00327: val\_acc did not improve from 0.86842

Epoch 00328: val\_acc did not improve from 0.86842

Epoch 00329: val\_acc did not improve from 0.86842

Epoch 00330: val\_acc did not improve from 0.86842

Epoch 00331: val\_acc did not improve from 0.86842

Epoch 00332: val\_acc did not improve from 0.86842

Epoch 00333: val\_acc did not improve from 0.86842

Epoch 00334: val\_acc did not improve from 0.86842

Epoch 00335: val\_acc did not improve from 0.86842

Epoch 00336: val\_acc did not improve from 0.86842

Epoch 00337: val\_acc did not improve from 0.86842

Epoch 00338: val\_acc did not improve from 0.86842

Epoch 00339: val\_acc did not improve from 0.86842

Epoch 00340: val\_acc did not improve from 0.86842

Epoch 00341: val\_acc did not improve from 0.86842

Epoch 00342: val\_acc did not improve from 0.86842

Epoch 00343: val\_acc did not improve from 0.86842

Epoch 00344: val\_acc did not improve from 0.86842

Epoch 00345: val\_acc did not improve from 0.86842

Epoch 00346: val\_acc did not improve from 0.86842

Epoch 00347: val\_acc did not improve from 0.86842

Epoch 00348: val\_acc did not improve from 0.86842

Epoch 00349: val\_acc did not improve from 0.86842

Epoch 00350: val\_acc did not improve from 0.86842

Epoch 00351: val\_acc did not improve from 0.86842

Epoch 00352: val\_acc did not improve from 0.86842

Epoch 00353: val\_acc did not improve from 0.86842

Epoch 00354: val\_acc did not improve from 0.86842

Epoch 00355: val\_acc did not improve from 0.86842

Epoch 00356: val\_acc did not improve from 0.86842

Epoch 00357: val\_acc did not improve from 0.86842

Epoch 00358: val\_acc did not improve from 0.86842

Epoch 00359: val\_acc did not improve from 0.86842

Epoch 00360: val\_acc did not improve from 0.86842

Epoch 00361: val\_acc did not improve from 0.86842

Epoch 00362: val\_acc did not improve from 0.86842

Epoch 00363: val\_acc did not improve from 0.86842

Epoch 00364: val\_acc did not improve from 0.86842

Epoch 00365: val\_acc did not improve from 0.86842

Epoch 00366: val\_acc did not improve from 0.86842

Epoch 00367: val\_acc did not improve from 0.86842

Epoch 00368: val\_acc did not improve from 0.86842

Epoch 00369: val\_acc did not improve from 0.86842

Epoch 00370: val\_acc did not improve from 0.86842

Epoch 00371: val\_acc did not improve from 0.86842

Epoch 00372: val\_acc did not improve from 0.86842

Epoch 00373: val\_acc did not improve from 0.86842

Epoch 00374: val\_acc did not improve from 0.86842

Epoch 00375: val\_acc did not improve from 0.86842

Epoch 00376: val\_acc did not improve from 0.86842

Epoch 00377: val\_acc did not improve from 0.86842

Epoch 00378: val\_acc did not improve from 0.86842

Epoch 00379: val\_acc did not improve from 0.86842

Epoch 00380: val\_acc did not improve from 0.86842

Epoch 00381: val\_acc did not improve from 0.86842

Epoch 00382: val\_acc did not improve from 0.86842

Epoch 00383: val\_acc did not improve from 0.86842

Epoch 00384: val\_acc did not improve from 0.86842

Epoch 00385: val\_acc did not improve from 0.86842

Epoch 00386: val\_acc did not improve from 0.86842

Epoch 00387: val\_acc did not improve from 0.86842

Epoch 00388: val\_acc did not improve from 0.86842

Epoch 00389: val\_acc did not improve from 0.86842

Epoch 00390: val\_acc did not improve from 0.86842

Epoch 00391: val\_acc did not improve from 0.86842

Epoch 00392: val\_acc did not improve from 0.86842

Epoch 00393: val\_acc did not improve from 0.86842

Epoch 00394: val\_acc did not improve from 0.86842

Epoch 00395: val\_acc did not improve from 0.86842

Epoch 00396: val\_acc did not improve from 0.86842

Epoch 00397: val\_acc did not improve from 0.86842

Epoch 00398: val\_acc did not improve from 0.86842

Epoch 00399: val\_acc did not improve from 0.86842

Epoch 00400: val\_acc did not improve from 0.86842

Epoch 00401: val\_acc did not improve from 0.86842

Epoch 00402: val\_acc did not improve from 0.86842

Epoch 00403: val\_acc did not improve from 0.86842

Epoch 00404: val\_acc did not improve from 0.86842

Epoch 00405: val\_acc did not improve from 0.86842

Epoch 00406: val\_acc did not improve from 0.86842

Epoch 00407: val\_acc did not improve from 0.86842

Epoch 00408: val\_acc did not improve from 0.86842

Epoch 00409: val\_acc did not improve from 0.86842

Epoch 00410: val\_acc did not improve from 0.86842

Epoch 00411: val\_acc did not improve from 0.86842

Epoch 00412: val\_acc did not improve from 0.86842

Epoch 00413: val\_acc did not improve from 0.86842

Epoch 00414: val\_acc did not improve from 0.86842

Epoch 00415: val\_acc did not improve from 0.86842

Epoch 00416: val\_acc did not improve from 0.86842

Epoch 00417: val\_acc did not improve from 0.86842

Epoch 00418: val\_acc did not improve from 0.86842

Epoch 00419: val\_acc did not improve from 0.86842

Epoch 00420: val\_acc did not improve from 0.86842

Epoch 00421: val\_acc did not improve from 0.86842

Epoch 00422: val\_acc did not improve from 0.86842

Epoch 00423: val\_acc did not improve from 0.86842

Epoch 00424: val\_acc did not improve from 0.86842

Epoch 00425: val\_acc did not improve from 0.86842

Epoch 00426: val\_acc did not improve from 0.86842

Epoch 00427: val\_acc did not improve from 0.86842

Epoch 00428: val\_acc did not improve from 0.86842

Epoch 00429: val\_acc did not improve from 0.86842

Epoch 00430: val\_acc did not improve from 0.86842

Epoch 00431: val\_acc did not improve from 0.86842

Epoch 00432: val\_acc did not improve from 0.86842

Epoch 00433: val\_acc did not improve from 0.86842

Epoch 00434: val\_acc did not improve from 0.86842

Epoch 00435: val\_acc did not improve from 0.86842

Epoch 00436: val\_acc did not improve from 0.86842

Epoch 00437: val\_acc did not improve from 0.86842

Epoch 00438: val\_acc did not improve from 0.86842

Epoch 00439: val\_acc did not improve from 0.86842

Epoch 00440: val\_acc did not improve from 0.86842

Epoch 00441: val\_acc did not improve from 0.86842

Epoch 00442: val\_acc did not improve from 0.86842

Epoch 00443: val\_acc did not improve from 0.86842

Epoch 00444: val\_acc did not improve from 0.86842

Epoch 00445: val\_acc did not improve from 0.86842

Epoch 00446: val\_acc did not improve from 0.86842

Epoch 00447: val\_acc did not improve from 0.86842

Epoch 00448: val\_acc did not improve from 0.86842

Epoch 00449: val\_acc did not improve from 0.86842

Epoch 00450: val\_acc did not improve from 0.86842

Epoch 00451: val\_acc did not improve from 0.86842

Epoch 00452: val\_acc did not improve from 0.86842

Epoch 00453: val\_acc did not improve from 0.86842

Epoch 00454: val\_acc did not improve from 0.86842

Epoch 00455: val\_acc did not improve from 0.86842

Epoch 00456: val\_acc did not improve from 0.86842

Epoch 00457: val\_acc did not improve from 0.86842

Epoch 00458: val\_acc did not improve from 0.86842

Epoch 00459: val\_acc did not improve from 0.86842

Epoch 00460: val\_acc did not improve from 0.86842

Epoch 00461: val\_acc did not improve from 0.86842

Epoch 00462: val\_acc did not improve from 0.86842

Epoch 00463: val\_acc did not improve from 0.86842

Epoch 00464: val\_acc did not improve from 0.86842

Epoch 00465: val\_acc did not improve from 0.86842

Epoch 00466: val\_acc did not improve from 0.86842

Epoch 00467: val\_acc did not improve from 0.86842

Epoch 00468: val\_acc did not improve from 0.86842

Epoch 00469: val\_acc did not improve from 0.86842

Epoch 00470: val\_acc did not improve from 0.86842

Epoch 00471: val\_acc did not improve from 0.86842

Epoch 00472: val\_acc did not improve from 0.86842

Epoch 00473: val\_acc did not improve from 0.86842

Epoch 00474: val\_acc did not improve from 0.86842

Epoch 00475: val\_acc did not improve from 0.86842

Epoch 00476: val\_acc did not improve from 0.86842

Epoch 00477: val\_acc did not improve from 0.86842

Epoch 00478: val\_acc did not improve from 0.86842

Epoch 00479: val\_acc did not improve from 0.86842

Epoch 00480: val\_acc did not improve from 0.86842

Epoch 00481: val\_acc did not improve from 0.86842

Epoch 00482: val\_acc did not improve from 0.86842

Epoch 00483: val\_acc did not improve from 0.86842

Epoch 00484: val\_acc did not improve from 0.86842

Epoch 00485: val\_acc did not improve from 0.86842

Epoch 00486: val\_acc did not improve from 0.86842

Epoch 00487: val\_acc did not improve from 0.86842

Epoch 00488: val\_acc did not improve from 0.86842

Epoch 00489: val\_acc did not improve from 0.86842

Epoch 00490: val\_acc did not improve from 0.86842

Epoch 00491: val\_acc did not improve from 0.86842

Epoch 00492: val\_acc did not improve from 0.86842

Epoch 00493: val\_acc did not improve from 0.86842

Epoch 00494: val\_acc did not improve from 0.86842

Epoch 00495: val\_acc did not improve from 0.86842

Epoch 00496: val\_acc did not improve from 0.86842

Epoch 00497: val\_acc did not improve from 0.86842

Epoch 00498: val\_acc did not improve from 0.86842

Epoch 00499: val\_acc did not improve from 0.86842

Epoch 00500: val\_acc did not improve from 0.86842
CPU times: user 6min 8s, sys: 40.1 s, total: 6min 48s
Wall time: 4min 1s

    \end{Verbatim}

    \hypertarget{evaluate-model-on-validation-set}{%
\paragraph{4.2.2.4 Evaluate Model On Validation
Set}\label{evaluate-model-on-validation-set}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}67}]:} \PY{c+c1}{\PYZsh{} Define Test method}
         
         
         \PY{k}{def} \PY{n+nf}{test\PYZus{}valid}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{,} \PY{n}{stats}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{:}
         
             \PY{c+c1}{\PYZsh{} Initialize the model neural networks architecture \PYZam{} load weights}
             \PY{n}{model} \PY{o}{=} \PY{n}{model\PYZus{}neural\PYZus{}network\PYZus{}vgg}\PY{p}{(}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Evaluate on train and valid set}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Train Set accuracy ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{train\PYZus{}acc} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{to\PYZus{}categorical}\PY{p}{(}
                 \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}train}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Set accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{acc}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{acc} \PY{o+ow}{in} \PY{n}{train\PYZus{}acc}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Valid Set accuracy ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{valid\PYZus{}acc} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{to\PYZus{}categorical}\PY{p}{(}
                 \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}valid}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Valid Set accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{p}{[}\PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{acc}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)} \PY{k}{for} \PY{n}{acc} \PY{o+ow}{in} \PY{n}{valid\PYZus{}acc}\PY{p}{]}\PY{p}{)}\PY{p}{)}
         
             \PY{k}{if} \PY{n}{stats}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Calculating Confusion Matrix \PYZam{} Classification Report ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{c+c1}{\PYZsh{} Predictions on the valid set}
                 \PY{n}{prob} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x\PYZus{}valid}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
                 \PY{n}{predictions} \PY{o}{=} \PY{n}{prob}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} True class label}
                 \PY{n}{true} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{n}{CLASS}\PY{p}{[}\PY{n}{l}\PY{p}{]} \PY{k}{for} \PY{n}{l} \PY{o+ow}{in} \PY{n}{y\PYZus{}valid}\PY{p}{]}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} Confusion matrix on the valid set.}
                 \PY{n}{con\PYZus{}matrix} \PY{o}{=} \PY{n}{confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{true}\PY{p}{,} \PY{n}{predictions}\PY{p}{)}
         
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Confusion matrix of the Seedlings Valid set}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{display}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{con\PYZus{}matrix}\PY{p}{,} \PY{n}{columns}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}
                     \PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
                 \PY{c+c1}{\PYZsh{} Plot the confusion matrix}
                 \PY{n}{plot\PYZus{}confusion\PYZus{}matrix}\PY{p}{(}\PY{n}{con\PYZus{}matrix}\PY{p}{,}
                                       \PY{n}{target\PYZus{}names}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,}
                                       \PY{n}{plt\PYZus{}name}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Seedlings\PYZus{}Con\PYZus{}Matrix\PYZus{}VGG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                       \PY{n}{rootdir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                       \PY{n}{save\PYZus{}dir}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{save/con\PYZus{}matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                       \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Confusion matrix}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                                       \PY{n}{cmap}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{cm}\PY{o}{.}\PY{n}{Blues}\PY{p}{,}
                                       \PY{n}{normalize}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
         
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Classification Report}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{n}{classification\PYZus{}report}\PY{p}{(}\PY{n}{true}\PY{p}{,} \PY{n}{predictions}\PY{p}{,}
                                             \PY{n}{target\PYZus{}names}\PY{o}{=}\PY{n+nb}{list}\PY{p}{(}\PY{n}{CLASS}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{True vs Prediction of the Seedlings Valid set}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{predictions\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}
                     \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{n}{x} \PY{k}{for} \PY{n}{x} \PY{o+ow}{in} \PY{n}{x\PYZus{}valid}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{true}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{predictions}\PY{p}{\PYZcb{}}\PY{p}{)}
         
                 \PY{n}{plot\PYZus{}missclassified} \PY{o}{=} \PY{k+kc}{True}
                 \PY{k}{if} \PY{n}{plot\PYZus{}missclassified}\PY{p}{:}
                     \PY{n}{missclassified} \PY{o}{=} \PY{n}{predictions\PYZus{}df}\PY{p}{[}\PY{n}{predictions\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
                                                     \PY{o}{!=} \PY{n}{predictions\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Top 10 missclassified results.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{display}\PY{p}{(}\PY{n}{HTML}\PY{p}{(}\PY{n}{missclassified}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{to\PYZus{}html}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}\PY{p}{)}\PY{p}{)}
                     \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                     \PY{n}{grid\PYZus{}plot\PYZus{}for\PYZus{}class}\PY{p}{(}\PY{n}{missclassified}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
         
             \PY{k}{return} \PY{n}{valid\PYZus{}acc}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
         
         
         \PY{c+c1}{\PYZsh{} Testing the model on validation set}
         
         \PY{k}{def} \PY{n+nf}{valid\PYZus{}main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
         
             \PY{k}{try}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading VGG Images \PYZam{} Labels for validation set ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                 \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}train\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n}{y\PYZus{}valid} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                     \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y\PYZus{}valid\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading VGG train \PYZam{} valid set bottleneck features \PYZam{} labels done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG Images \PYZam{} Labels for validation set does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{c+c1}{\PYZsh{} Best of 3 iterations}
             \PY{c+c1}{\PYZsh{} The best validation accuracy: 0.8621052634088616}
             \PY{c+c1}{\PYZsh{} Model name: ./checkpoint/VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.46\PYZhy{}0.8728.hdf5}
         
             \PY{c+c1}{\PYZsh{} The best validation accuracy: 0.8621052634088616}
             \PY{c+c1}{\PYZsh{} Model name: ./checkpoint/VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.46\PYZhy{}0.8728.hdf5}
         
             \PY{c+c1}{\PYZsh{} The best validation accuracy: 0.8621052634088616}
             \PY{c+c1}{\PYZsh{} Model name: ./checkpoint/VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.46\PYZhy{}0.8728.hdf5}
         
             \PY{c+c1}{\PYZsh{} best\PYZus{}model = input(\PYZsq{}Enter the name of best model saved in ./logs dir: \PYZsq{})}
             \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.46\PYZhy{}0.8728.hdf5}\PY{l+s+s1}{\PYZsq{}}
         
             \PY{n}{run\PYZus{}all\PYZus{}saved\PYZus{}model} \PY{o}{=} \PY{k+kc}{False}
             \PY{c+c1}{\PYZsh{} Run all the saved models \PYZam{} find one with best validation accuracy}
             \PY{k}{if} \PY{n}{run\PYZus{}all\PYZus{}saved\PYZus{}model}\PY{p}{:}
                 \PY{n}{best\PYZus{}valid\PYZus{}acc} \PY{o}{=} \PY{l+m+mf}{0.0}
                 \PY{k}{for} \PY{n}{saved\PYZus{}model} \PY{o+ow}{in} \PY{n}{glob}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{*.hdf5}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                     \PY{k}{if} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{basename}\PY{p}{(}\PY{n}{saved\PYZus{}model}\PY{p}{)}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:}
                         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{*}\PY{l+s+s1}{\PYZsq{}}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}
                         \PY{n}{valid\PYZus{}acc} \PY{o}{=} \PY{n}{test\PYZus{}valid}\PY{p}{(}
                             \PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{basename}\PY{p}{(}\PY{n}{saved\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
                         \PY{k}{if} \PY{p}{(}\PY{n}{valid\PYZus{}acc} \PY{o}{\PYZgt{}} \PY{n}{best\PYZus{}valid\PYZus{}acc}\PY{p}{)}\PY{p}{:}
                             \PY{n}{best\PYZus{}valid\PYZus{}acc} \PY{o}{=} \PY{n}{valid\PYZus{}acc}
                             \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{n}{saved\PYZus{}model}
                             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{New best validation accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{ Model name: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                                 \PY{n}{best\PYZus{}valid\PYZus{}acc}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{The best validation accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{ Model name: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                     \PY{n}{best\PYZus{}valid\PYZus{}acc}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
             \PY{n}{valid\PYZus{}acc} \PY{o}{=} \PY{n}{test\PYZus{}valid}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{x\PYZus{}valid\PYZus{}botf\PYZus{}vgg}\PY{p}{,}
                                    \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}valid}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{basename}\PY{p}{(}\PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{,} \PY{n}{stats}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{The best validation accuracy: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Model name: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                 \PY{n}{np}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{n}{valid\PYZus{}acc}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
         
         
         \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
             \PY{n}{valid\PYZus{}main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading VGG Images \& Labels for validation set {\ldots}
Loading VGG train \& valid set bottleneck features \& labels done.

Calculating Train Set accuracy {\ldots}
3800/3800 [==============================] - 0s 80us/step
Train Set accuracy: [18.84, 95.95]\%

Calculating Valid Set accuracy {\ldots}
950/950 [==============================] - 0s 76us/step
Valid Set accuracy: [58.72, 86.21]\%

Calculating Confusion Matrix \& Classification Report {\ldots}
950/950 [==============================] - 0s 209us/step


Confusion matrix of the Seedlings Valid set



    \end{Verbatim}

    
    \begin{verbatim}
                           Sugar beet  Scentless Mayweed  Fat Hen  Charlock  \
Sugar beet                         24                  0        0         0   
Scentless Mayweed                   0                 77        0         0   
Fat Hen                             0                  0       53         1   
Charlock                            0                  1        0       109   
Shepherds Purse                     2                  0        0         0   
Loose Silky-bent                    1                  0        1         4   
Maize                              10                  0        0         0   
Cleavers                            0                  0        0         0   
Black-grass                         0                  0        0         2   
Small-flowered Cranesbill           0                  1        0         3   
Common wheat                        1                  0        0         3   
Common Chickweed                    1                  0        0         1   

                           Shepherds Purse  Loose Silky-bent  Maize  Cleavers  \
Sugar beet                               3                 0     25         0   
Scentless Mayweed                        0                 1      0         0   
Fat Hen                                  0                 1      0         0   
Charlock                                 1                 1      0         0   
Shepherds Purse                         36                 1      3         0   
Loose Silky-bent                         2                80      0         0   
Maize                                    0                 1    117         0   
Cleavers                                 0                 0      0        43   
Black-grass                              0                 1      4         0   
Small-flowered Cranesbill                0                 0      0         0   
Common wheat                             0                 0      0         0   
Common Chickweed                         3                 7      0         1   

                           Black-grass  Small-flowered Cranesbill  \
Sugar beet                           1                          0   
Scentless Mayweed                    0                          0   
Fat Hen                              0                          3   
Charlock                             2                          2   
Shepherds Purse                      2                          0   
Loose Silky-bent                     2                          0   
Maize                                3                          0   
Cleavers                             0                          0   
Black-grass                         94                          2   
Small-flowered Cranesbill            8                         32   
Common wheat                         0                          1   
Common Chickweed                     4                          0   

                           Common wheat  Common Chickweed  
Sugar beet                            0                 0  
Scentless Mayweed                     0                 0  
Fat Hen                               0                 0  
Charlock                              6                 0  
Shepherds Purse                       0                 0  
Loose Silky-bent                      0                 5  
Maize                                 0                 0  
Cleavers                              0                 1  
Black-grass                           0                 0  
Small-flowered Cranesbill             2                 0  
Common wheat                         94                 0  
Common Chickweed                      0                60  
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]


Saving Confusion Matrices in the ./save/con\_matrix directory

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_184_3.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]


Classification Report
                           precision    recall  f1-score   support

               Sugar beet       0.62      0.45      0.52        53
        Scentless Mayweed       0.97      0.99      0.98        78
                  Fat Hen       0.98      0.91      0.95        58
                 Charlock       0.89      0.89      0.89       122
          Shepherds Purse       0.80      0.82      0.81        44
         Loose Silky-bent       0.86      0.84      0.85        95
                    Maize       0.79      0.89      0.84       131
                 Cleavers       0.98      0.98      0.98        44
              Black-grass       0.81      0.91      0.86       103
Small-flowered Cranesbill       0.80      0.70      0.74        46
             Common wheat       0.92      0.95      0.94        99
         Common Chickweed       0.91      0.78      0.84        77

              avg / total       0.86      0.86      0.86       950



True vs Prediction of the Seedlings Valid set


Top 10 missclassified results.

    \end{Verbatim}

    
    \begin{verbatim}
<IPython.core.display.HTML object>
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]



    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_184_7.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]


The best validation accuracy: 86.21\% 
Model name: VGG\_ADAM\_best\_weights.46-0.8728.hdf5

    \end{Verbatim}

    \hypertarget{submission-on-test-set-using-vgg-bottleneck-features-extraction}{%
\paragraph{Submission on Test Set using VGG Bottleneck Features
extraction}\label{submission-on-test-set-using-vgg-bottleneck-features-extraction}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{input\PYZus{}dim} \PY{o}{=} \PY{l+m+mi}{224}
        \PY{n}{POOLING} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{RANDOM\PYZus{}STATE} \PY{o}{=} \PY{l+m+mi}{21}
        
        \PY{c+c1}{\PYZsh{} Define Test method}
        
        
        \PY{k}{def} \PY{n+nf}{test}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{label}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{:}
        
            \PY{c+c1}{\PYZsh{} Initialize the model neural networks architecture \PYZam{} load weights}
            \PY{n}{model} \PY{o}{=} \PY{n}{model\PYZus{}neural\PYZus{}network\PYZus{}vgg}\PY{p}{(}\PY{p}{)}
            \PY{n}{model}\PY{o}{.}\PY{n}{load\PYZus{}weights}\PY{p}{(}\PY{n}{filepath}\PY{o}{=}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./checkpoint}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Predictions}
            \PY{n}{prob} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{img}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{pred} \PY{o}{=} \PY{n}{prob}\PY{o}{.}\PY{n}{argmax}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
        
            \PY{n}{submission\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{file}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{label}\PY{p}{,}
                                          \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{species}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{p}{[}\PY{n}{INV\PYZus{}CLASS}\PY{p}{[}\PY{n}{p}\PY{p}{]} \PY{k}{for} \PY{n}{p} \PY{o+ow}{in} \PY{n}{pred}\PY{p}{]}\PY{p}{\PYZcb{}}\PY{p}{)}
            \PY{n}{submission\PYZus{}df}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{submission\PYZus{}vgg.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{header}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        
        
        \PY{c+c1}{\PYZsh{} Testing the model}
        
        \PY{k}{def} \PY{n+nf}{test\PYZus{}main}\PY{p}{(}\PY{p}{)}\PY{p}{:}
        
            \PY{c+c1}{\PYZsh{} Load Seedlings Test set}
            \PY{n}{images\PYZus{}test\PYZus{}vgg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{p}{]}\PY{p}{)}
        
            \PY{k}{try}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Seedlings Test set ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{images\PYZus{}test\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}test\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n}{ids\PYZus{}test\PYZus{}vgg} \PY{o}{=} \PY{n}{joblib}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ids\PYZhy{}test\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading Seedlings Test set done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{k}{except} \PY{n+ne}{Exception} \PY{k}{as} \PY{n}{e}\PY{p}{:}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stacktrace}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{e}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Seedlings Test set VGG Images does not exist.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{k}{if} \PY{p}{(}\PY{o+ow}{not} \PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{size} \PY{o+ow}{or} \PY{o+ow}{not} \PY{n}{ids\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{:}
                \PY{n}{img\PYZus{}size} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{224}\PY{p}{,} \PY{l+m+mi}{224}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Running load\PYZus{}seedlings method with img\PYZus{}size }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ ...}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{img\PYZus{}size}\PY{p}{)}\PY{p}{)}
                \PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{p}{,} \PY{n}{ids\PYZus{}test\PYZus{}vgg} \PY{o}{=} \PY{n}{load\PYZus{}seedlings\PYZus{}transfer\PYZus{}test}\PY{p}{(}
                    \PY{n}{img\PYZus{}size}\PY{o}{=}\PY{n}{img\PYZus{}size}\PY{p}{)}
        
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dumping Seedlings Test set ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{c+c1}{\PYZsh{} Dumping files}
                \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{images\PYZhy{}test\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{ids\PYZus{}test\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ids\PYZhy{}test\PYZhy{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
                \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Seedlings Test set dumping done.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Type cast int to float for VGG16 model compatibility}
            \PY{n}{images\PYZus{}test\PYZus{}vgg} \PY{o}{=} \PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{copy}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Images Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Image Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Labels Shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ids\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Label Data Type:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ids\PYZus{}test\PYZus{}vgg}\PY{o}{.}\PY{n}{dtype}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} VGG Preprocssing input}
            \PY{c+c1}{\PYZsh{} Numpy array to store extracted features from VGG model}
            \PY{n}{images\PYZus{}test\PYZus{}vgg\PYZus{}features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}
                \PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{p}{)}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{p}{,} \PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Extract features with VGG model}
            \PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{image} \PY{o+ow}{in} \PY{n}{tqdm}\PY{p}{(}\PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{images\PYZus{}test\PYZus{}vgg}\PY{p}{)}\PY{p}{)}\PY{p}{:}
                \PY{n}{images\PYZus{}test\PYZus{}vgg\PYZus{}features}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{vgg16}\PY{o}{.}\PY{n}{preprocess\PYZus{}input}\PY{p}{(}
                    \PY{n}{np}\PY{o}{.}\PY{n}{expand\PYZus{}dims}\PY{p}{(}\PY{n}{image}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}
        
            \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Train Images shape: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ size: }\PY{l+s+si}{\PYZob{}:,\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}
                \PY{n}{images\PYZus{}test\PYZus{}vgg\PYZus{}features}\PY{o}{.}\PY{n}{shape}\PY{p}{,} \PY{n}{images\PYZus{}test\PYZus{}vgg\PYZus{}features}\PY{o}{.}\PY{n}{size}\PY{p}{)}\PY{p}{)}
        
            \PY{k}{del} \PY{n}{images\PYZus{}test\PYZus{}vgg}
        
            \PY{c+c1}{\PYZsh{} VGG Bottleneck Features extraction}
            \PY{n}{vgg\PYZus{}bottleneck} \PY{o}{=} \PY{n}{vgg16}\PY{o}{.}\PY{n}{VGG16}\PY{p}{(}
                \PY{n}{weights}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{imagenet}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{include\PYZus{}top}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{pooling}\PY{o}{=}\PY{n}{POOLING}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{} Calculating VGG train \PYZam{} valid set bottleneck features}
            \PY{n}{x\PYZus{}test\PYZus{}botf\PYZus{}vgg} \PY{o}{=} \PY{n}{vgg\PYZus{}bottleneck}\PY{o}{.}\PY{n}{predict}\PY{p}{(}
                \PY{n}{images\PYZus{}test\PYZus{}vgg\PYZus{}features}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{32}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{joblib}\PY{o}{.}\PY{n}{dump}\PY{p}{(}\PY{n}{x\PYZus{}test\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}
                \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{./save/pickles}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}test\PYZus{}botf\PYZus{}vgg.pickle}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
        
            \PY{n}{best\PYZus{}model} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{VGG\PYZus{}ADAM\PYZus{}best\PYZus{}weights.46\PYZhy{}0.8728.hdf5}\PY{l+s+s1}{\PYZsq{}}
            \PY{n}{test}\PY{p}{(}\PY{n}{x\PYZus{}test\PYZus{}botf\PYZus{}vgg}\PY{p}{,} \PY{n}{ids\PYZus{}test\PYZus{}vgg}\PY{p}{,} \PY{n}{best\PYZus{}model}\PY{p}{)}
        
        
        \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}
            \PY{n}{test\PYZus{}main}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading Seedlings Test set {\ldots}
Loading Seedlings Test set done.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
152it [00:00, 1515.21it/s]
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Images Shape: (794, 224, 224, 3)
Image Data Type: float32
Labels Shape: (794,)
Label Data Type: <U13

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
794it [00:00, 1668.95it/s]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
Train Images shape: (794, 224, 224, 3) size: 119,519,232
794/794 [==============================] - 290s 365ms/step
794/794 [==============================] - 0s 67us/step

    \end{Verbatim}

    \hypertarget{xgb}{%
\subsection{4.3 XGB}\label{xgb}}

    \hypertarget{prepare-load-data}{%
\subsubsection{Prepare \& Load Data}\label{prepare-load-data}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}164}]:} \PY{n}{display}\PY{p}{(}\PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
      area  height     label  largest_contour_area  no_of_countours  width
0  24198.5     360  Cleavers               12418.0                3    360
1   8176.0     149  Cleavers                8176.0                1    149
2  12717.0     225  Cleavers               12717.0                1    225
3  35139.0     404  Cleavers               21444.0                5    404
4  20688.0     315  Cleavers                9436.0               12    315
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}167}]:} \PY{c+c1}{\PYZsh{} Select the numeric features, drop NA values}
          
          \PY{n}{x\PYZus{}train\PYZus{}features} \PY{o}{=}\PY{err}{`} \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{[}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{height}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{width}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{largest\PYZus{}contour\PYZus{}area}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{]}
          \PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{area\PYZus{}per\PYZus{}contour}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}
                                                                 \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{area}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{/} \PY{n}{features\PYZus{}df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{no\PYZus{}of\PYZus{}countours}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
          
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Displaying Null rows/columns ...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{display}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{[}\PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{isnull}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{any}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{]}\PY{p}{)}
          
          \PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
          \PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{n}{drop}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Pop out labels}
          
          \PY{n}{labels} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{pop}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{label}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Scale using MinMaxScaler}
          
          \PY{n}{x\PYZus{}train\PYZus{}features\PYZus{}scaled} \PY{o}{=} \PY{n}{MinMaxScaler}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{)}
          \PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{]} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}features\PYZus{}scaled}
          
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{Top 10 rows}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{x\PYZus{}train\PYZus{}features}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Displaying Null rows/columns {\ldots}

    \end{Verbatim}

    
    \begin{verbatim}
      height  width  largest_contour_area             label  area_per_contour
1769     131    131                   0.0  Loose Silky-bent               NaN
2381     114    114                   0.0      Common wheat               NaN
3951      91     91                   0.0       Black-grass               NaN
4592      63     63                   0.0  Common Chickweed               NaN
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]

Top 10 rows

    \end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}167}]:}      height     width  largest\_contour\_area  area\_per\_contour
          0  0.091256  0.078894              0.005999          0.016947
          1  0.029343  0.025368              0.003949          0.017178
          2  0.051643  0.044647              0.006143          0.026718
          3  0.104167  0.090056              0.010360          0.014765
          4  0.078052  0.067478              0.004558          0.003622
\end{Verbatim}
            
    \hypertarget{encode-labels-using-labelencoder}{%
\subsubsection{Encode labels using
LabelEncoder}\label{encode-labels-using-labelencoder}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}168}]:} \PY{c+c1}{\PYZsh{} Encode labels and create classes}
          
          \PY{n}{le} \PY{o}{=} \PY{n}{LabelEncoder}\PY{p}{(}\PY{p}{)}
          \PY{n}{le}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
          \PY{n}{labels\PYZus{}encoded} \PY{o}{=} \PY{n}{le}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{labels}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Classes: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{le}\PY{o}{.}\PY{n}{classes\PYZus{}}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Convert labels into categorical values}
          \PY{n}{labels\PYZus{}onehot} \PY{o}{=} \PY{n}{to\PYZus{}categorical}\PY{p}{(}\PY{n}{labels\PYZus{}encoded}\PY{p}{)}
          \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Number of One Hot encoded class labels: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{labels\PYZus{}onehot}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]


Classes:  ['Black-grass' 'Charlock' 'Cleavers' 'Common Chickweed' 'Common wheat'
 'Fat Hen' 'Loose Silky-bent' 'Maize' 'Scentless Mayweed'
 'Shepherds Purse' 'Small-flowered Cranesbill' 'Sugar beet']

Number of One Hot encoded class labels:  12

    \end{Verbatim}

    \hypertarget{classifier-comparison}{%
\subsubsection{Classifier Comparison}\label{classifier-comparison}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}169}]:} \PY{o}{\PYZpc{}} \PY{o}{\PYZpc{}} \PY{n}{time}
          
          \PY{n}{x\PYZus{}train\PYZus{}features} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{)}
          \PY{n}{labels\PYZus{}encoded} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{labels\PYZus{}encoded}\PY{p}{)}
          
          
          \PY{k}{def} \PY{n+nf}{classifier\PYZus{}comparison}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
              \PY{c+c1}{\PYZsh{} Classifier names \PYZam{} initializations}
              \PY{n}{names} \PY{o}{=} \PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Nearest Neighbors}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SVM}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Gaussian Process}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}
                       \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Decision Tree}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Random Forest}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Neural Net}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{AdaBoost}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{GradientBoost}\PY{l+s+s2}{\PYZdq{}}
                       \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Naive Bayes}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{LDA}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{QDA}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{XGB Classifier}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
          
              \PY{n}{classifiers} \PY{o}{=} \PY{p}{[}
                  \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{,}
                  \PY{n}{SVC}\PY{p}{(}\PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{p}{,}
                  \PY{n}{GaussianProcessClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{MLPClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{AdaBoostClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{GaussianNB}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{LinearDiscriminantAnalysis}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{QuadraticDiscriminantAnalysis}\PY{p}{(}\PY{p}{)}\PY{p}{,}
                  \PY{n}{XGBClassifier}\PY{p}{(}\PY{p}{)}\PY{p}{]}
          
              \PY{c+c1}{\PYZsh{} Split \PYZam{} shuffle data using Stratified K Fold}
              \PY{n}{kfold} \PY{o}{=} \PY{n}{StratifiedKFold}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{n}{n\PYZus{}splits}\PY{p}{,} \PY{n}{shuffle}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{21}\PY{p}{)}
          
              \PY{c+c1}{\PYZsh{} Calculate accuracy over all splits, classifiers}
              \PY{n}{count} \PY{o}{=} \PY{l+m+mi}{0}
              \PY{n}{acc\PYZus{}dict} \PY{o}{=} \PY{n}{defaultdict}\PY{p}{(}\PY{n+nb}{list}\PY{p}{)}
              \PY{k}{for} \PY{n}{train\PYZus{}index}\PY{p}{,} \PY{n}{test\PYZus{}index} \PY{o+ow}{in} \PY{n}{kfold}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{,} \PY{n}{labels\PYZus{}encoded}\PY{p}{)}\PY{p}{:}
                  \PY{n}{xtrain}\PY{p}{,} \PY{n}{ytrain} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{[}\PY{n}{train\PYZus{}index}\PY{p}{]}\PY{p}{,} \PY{n}{labels\PYZus{}encoded}\PY{p}{[}\PY{n}{train\PYZus{}index}\PY{p}{]}
                  \PY{n}{xtest}\PY{p}{,} \PY{n}{ytest} \PY{o}{=} \PY{n}{x\PYZus{}train\PYZus{}features}\PY{p}{[}\PY{n}{test\PYZus{}index}\PY{p}{]}\PY{p}{,} \PY{n}{labels\PYZus{}encoded}\PY{p}{[}\PY{n}{test\PYZus{}index}\PY{p}{]}
                  \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Iteration: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{count}\PY{p}{)}
          
                  \PY{c+c1}{\PYZsh{} iterate over classifiers}
                  \PY{k}{for} \PY{n}{clf} \PY{o+ow}{in} \PY{n}{classifiers}\PY{p}{:}
                      \PY{n}{clf\PYZus{}name} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n+nv+vm}{\PYZus{}\PYZus{}class\PYZus{}\PYZus{}}\PY{o}{.}\PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}}
                      \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{xtrain}\PY{p}{,} \PY{n}{ytrain}\PY{p}{)}
                      \PY{n}{predictions} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{xtest}\PY{p}{)}
                      \PY{n}{accuracy} \PY{o}{=} \PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{ytest}\PY{p}{,} \PY{n}{predictions}\PY{p}{)}
          
                      \PY{c+c1}{\PYZsh{} Append results in default dict of lists}
                      \PY{n}{acc\PYZus{}dict}\PY{p}{[}\PY{n}{clf\PYZus{}name}\PY{p}{]}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{accuracy}\PY{p}{)}
          
                  \PY{n}{count} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
          
              \PY{k}{return} \PY{n}{acc\PYZus{}dict}
          
          
          \PY{c+c1}{\PYZsh{} Call the classifier\PYZus{}comparison module \PYZam{} save the results}
          \PY{n}{acc\PYZus{}dict} \PY{o}{=} \PY{n}{classifier\PYZus{}comparison}\PY{p}{(}\PY{n}{n\PYZus{}splits}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Iteration:  0
Iteration:  1
Iteration:  2
CPU times: user 8min 42s, sys: 5min 57s, total: 14min 40s
Wall time: 4min 56s

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}170}]:} \PY{c+c1}{\PYZsh{} Dataframe containing classifier name \PYZam{} accuracy score}
          \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{o}{.}\PY{n}{from\PYZus{}dict}\PY{p}{(}\PY{n}{acc\PYZus{}dict}\PY{p}{,} \PY{n}{orient}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{rename}\PY{p}{(}
              \PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+m+mi}{0}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{1st Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2nd Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{:} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{3rd Iteration}\PY{l+s+s1}{\PYZsq{}}\PY{p}{\PYZcb{}}\PY{p}{)}
          
          \PY{c+c1}{\PYZsh{} Calculate average accuracy}
          \PY{n}{acc\PYZus{}df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
          \PY{n}{acc\PYZus{}df} \PY{o}{=} \PY{p}{(}\PY{n}{acc\PYZus{}df}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}\PY{o}{.}\PY{n}{round}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{)}
          
          \PY{n}{sorted\PYZus{}acc\PYZus{}df} \PY{o}{=} \PY{n}{acc\PYZus{}df}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{n}{by}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
          \PY{n}{display}\PY{p}{(}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{p}{)}
\end{Verbatim}


    
    \begin{verbatim}
                               1st Iteration  2nd Iteration  3rd Iteration  \
XGBClassifier                          47.64          48.45          47.78   
GradientBoostingClassifier             47.76          48.64          47.21   
RandomForestClassifier                 44.93          44.97          45.18   
KNeighborsClassifier                   40.33          42.00          39.23   
DecisionTreeClassifier                 40.64          40.10          39.42   
MLPClassifier                          37.49          35.67          36.69   
AdaBoostClassifier                     17.64          23.66          26.68   
LinearDiscriminantAnalysis             22.56          23.85          21.23   
GaussianNB                             20.48          23.28          21.55   
GaussianProcessClassifier              20.86          20.94          19.07   
QuadraticDiscriminantAnalysis          19.41          14.10          19.07   
SVC                                    17.01          17.90          17.43   

                               avg_acc  
XGBClassifier                    47.96  
GradientBoostingClassifier       47.87  
RandomForestClassifier           45.03  
KNeighborsClassifier             40.52  
DecisionTreeClassifier           40.05  
MLPClassifier                    36.62  
AdaBoostClassifier               22.66  
LinearDiscriminantAnalysis       22.54  
GaussianNB                       21.77  
GaussianProcessClassifier        20.29  
QuadraticDiscriminantAnalysis    17.53  
SVC                              17.45  
    \end{verbatim}

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}171}]:} \PY{c+c1}{\PYZsh{} Plot a barplot containing classifier name \PYZam{} accuracy score}
          
          \PY{n}{sns}\PY{o}{.}\PY{n}{barplot}\PY{p}{(}\PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{avg\PYZus{}acc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{data}\PY{o}{=}\PY{n}{sorted\PYZus{}acc\PYZus{}df}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
          \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Classifier Comparison based on Accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}171}]:} Text(0.5,1,'Classifier Comparison based on Accuracy')
\end{Verbatim}
            
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_196_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    It seems like simple \texttt{XGB} performs much \texttt{better} than
others but accuracy is very less in comparison to a full blown
\texttt{CNN\ networks}.

    \hypertarget{deployment}{%
\section{5. Deployment}\label{deployment}}

    Deployment in this context means publishing the resulting prediction
from the model to the Kaggle leaderboard. To do this do the following:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  select the cell below and run it by pressing the play button.
\item
  Press the \texttt{Publish} button in top right corner.
\item
  Select \texttt{Output} on the notebook menubar
\item
  Select the result dataset and press \texttt{Submit\ to\ Competition}
  button
\end{enumerate}

    \hypertarget{further-improvements}{%
\section{6. Further Improvements}\label{further-improvements}}

    It's now time for you to get your hands even dirtier and go at it all by
yourself in a \texttt{challenge}!

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Try to use the creative data preprocessing steps, promising models,
  ensemble of them, different algorithms and compare their result

  \begin{itemize}
  \tightlist
  \item
    Experiment with stacking different input features in different ways
    (combinations) to understand their impact on the accuracy
  \item
    Do this by optimizing hyperparameters
  \end{itemize}
\item
  Try adding new features
\end{enumerate}

\textbf{The winner is the one to get the highest scoring model for the
validation set.}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
